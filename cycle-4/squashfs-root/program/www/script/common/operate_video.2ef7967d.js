Config.Encode=function(v){var c,m,h,C,S,n={},d={},t={StreamID:["ID"],IsEnable:["Enabled"],EncodeFmt:["VideoEncodeInfo","EncodeFormat"],BitRate:["VideoEncodeInfo","BitRate"],FrameRate:["VideoEncodeInfo","FrameRate"],GopType:["VideoEncodeInfo","GOPType"],IInterval:["VideoEncodeInfo","IFrameInterval"],Quality:["VideoEncodeInfo","ImageQuality"],EncMode:["VideoEncodeInfo","BitRateType"],SmoothValue:["VideoEncodeInfo","SmoothLevel"],Width:["VideoEncodeInfo","Resolution","Width"],Hight:["VideoEncodeInfo","Resolution","Height"],SvcMode:["VideoEncodeInfo","SVCMode"],UCodeMode:["VideoEncodeInfo","SmartEncodeMode"]},f=!1,M=Capinfo.maxStreamNum,I=["1","3","5","6","8","10","12","15","20","25","30","50","60"],g=["IP","IBP","IBBP","I"],y=[],b=0,l=2,p=16384,E={},P={},T={Hight:["Resolution","Height"],Width:["Resolution","Width"],FrameRate:["FrameRate"]},R={},u={},F={},V={},U={JPEGSize:["JPEGSize"],SyntJPEGSize:["SyntJPEGSize"],SyntQuality:["SyntQuality"],ProcJPEGSize:["ProcJPEGSize"],ProcQuality:["ProcQuality"],TGSyntJPEGSize:["TGSyntJPEGSize"],TGSyntQuality:["TGSyntQuality"],single_closeUp_width:["CloseupResolution","Width"],single_closeUp_height:["CloseupResolution","Height"]},A=[{streamType:"MainStream",encodeBility:0,data:{}}],B=["FirstPTZStream","SecondPTZStream","ThirdPTZStream","ForthPTZStream","PanoramaStream"],z={},x={},G={},Q={"1920*1200":"WUXGA","1920*1080":"1080P","1280*960":"960P","1280*720":"720P","720*576":"D1","352*288":"CIF","1600*1200":"UXGA","2048*1536":"3MP","2592*2048":"5MP","704*288":"2CIF","1280*1024":"SXGA","3840*2160":"8MP","4000*3000":"12MP","2592*1520":"4MP","704*576":"4CIF"},L=[],_=!1,J=Capinfo.MaxJPEGSize,D=Capinfo.MaxSyntJPEGSize;return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initUCodeLang(),this.initEvent(),this.initData(),Utils.afterDataLoad()},initPage:function(){Capinfo.isSupportBNC&&v("#BNCfieldset").removeClass("hidden");var e,a=0,t=(l=Capinfo.capInfoMap.VinMode)?l.length:0,i="";for(Capinfo.isModuleVin&&(delete Q["2592*2048"],Q["3072*1728"]="5M",Q["3072*2048"]="6M");a<t;a++){var o,n=l[a].split("*");o=n[0]+"*"+n[1],o=Q[o]?"D1"==Q[o]||"CIF"==Q[o]?"PAL":(n=n[2],(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(n=12==n?12.5:n),Q[o]+"@"+n):l[a],v("#VinMode").append("<option value='"+l[a]+"'>"+o+"</option>")}if(d=Utils.LAPI_GetCfgData(LAPI_URL.VideoInMode,P),Utils.changeMapToMapByMapping(P,T,E,0),d){if(v("#VinMode").val(E.Width+"*"+E.Hight+"*"+E.FrameRate),Capinfo.isSupportSingleCloseUp&&IVAMode.ILLEGAL!=Frame.IVAType)for(v("#pictrueType_single_closeUp").removeClass("hidden"),t=(l=Capinfo.capInfoMap.Resolution_closeup)?l.length:0,a=0;a<t;a++)i="",o=l[a].split("*"),parseInt(o[0])*parseInt(o[1])<=parseInt(E.Width)*parseInt(E.Hight)&&(o=Q[l[a]]||l[a],i="<option value='"+l[a]+"'>"+o+"</option>",v("#single_closeUp_picSize").append(i));var d="Framerate_"+E.Width+"x"+E.Hight+"x"+E.FrameRate;for(a=0,t=(I="undefined"!=typeof Capinfo.capInfoMap[d]?Capinfo.capInfoMap[d]:I).length;a<t;a++){var r=parseInt(I[a]);if(E.FrameRate<r)break;(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(r=12==r?12.5:r),v("#MainStreamFrameRate").append("<option value='"+parseInt(r)+"'>"+r+"</option>")}var s=Capinfo.capInfoMap.IgnoreResolutionLimit,l=Capinfo.capInfoMap.Resolution;for("undefined"!=typeof Capinfo.capInfoMap.Resolution1&&(l=l.concat(Capinfo.capInfoMap.Resolution1)),"undefined"!=typeof Capinfo.capInfoMap.Resolution2&&(l=l.concat(Capinfo.capInfoMap.Resolution2)),t=(l=this.arrDelete(l))?l.length:0,a=0;a<t;a++)o=l[a].split("*"),(s||parseInt(o[0])*parseInt(o[1])<=parseInt(E.Width)*parseInt(E.Hight))&&(o=Q[l[a]]||l[a],i="<option value='"+l[a]+"'>"+o+"</option>",v("#MainStreamPictureSize").append(i));if(a=0,null!=(l=Capinfo.capInfoMap.EncodeFormat)&&0<l.length)for(var p=v("#MainStreamEncodeFmt").find("option"),t=p.length;a<t;a++){var u=p[a];this.isContain(l,v(u).attr("cap"))||v(u).remove()}Capinfo.isSupportSVC&&v("#MainStreamSvcModeTR").removeClass("hidden"),Capinfo.isSupportUCODE&&(v("#MainStreamUCCodeModeTR").removeClass("hidden"),Utils.parseCapOptions("MainStreamUCCodeMode",Capinfo.UCODEMode,"mode"));var c,m=v("#MainStreamTbl"),h=m.html();if(1<M&&(A.push({streamType:"AuxStream",encodeBility:0,data:{}}),S=h.replace(/MainStream/g,"AuxStream"),v("#AuxStreamTbl").append(S),v("#AuxStream").removeClass("hidden"),Capinfo.isSupportHorizontalMenu&&v("#AuxStreamUCCodeModeTR").addClass("hidden-visible"),Capinfo.isSupport4KFishEye&&v("#AuxStreamUCCodeModeTR").removeClass("hidden-visible"),"undefined"!=typeof Capinfo.capInfoMap.Resolution1&&this.changePicsizeAndFrameRate(1)),2<M&&(A.push({streamType:"ThirdStream",encodeBility:0,data:{}}),c=(h=m.html()).replace(/MainStream/g,"ThirdStream"),v("#ThirdStreamTbl").append(c),v("#ThirdStream").removeClass("hidden"),(Capinfo.isSupportHorizontalMenu||Capinfo.isSupport4KFishEye)&&v("#ThirdStreamUCCodeModeTR").addClass("hidden-visible"),"undefined"!=typeof Capinfo.capInfoMap.Resolution2&&this.changePicsizeAndFrameRate(2)),Capinfo.isSupport4KFishEye&&7<M){for(A.push({streamType:"FirstPTZStream",encodeBility:0,data:{}}),A.push({streamType:"SecondPTZStream",encodeBility:0,data:{}}),A.push({streamType:"ThirdPTZStream",encodeBility:0,data:{}}),A.push({streamType:"ForthPTZStream",encodeBility:0,data:{}}),A.push({streamType:"PanoramaStream",encodeBility:0,data:{}}),a=0;a<5;a++){var C=(h=m.html()).replace(/MainStream/g,B[a]);v("#"+B[a]+"Tbl").append(C),v("#"+B[a]+"UCCodeModeTR").addClass("hidden-visible")}if(v("#lensModeTab").removeClass("hidden"),v("#streamForm").addClass("fishFormClass clearfix"),"undefined"!=typeof Capinfo.capInfoMap.ResolutionPTZ)for(a=0;a<4;a++)this.changePTZStream(a+3);"undefined"!=typeof Capinfo.capInfoMap.ResolutionPanorama&&this.changePTZStream(7),v("#AuxStreamIsEnable").addClass("hidden"),v("#AuxStreamIsEnable").next().remove(),v("#ThirdStreamIsEnable").addClass("hidden"),v("#ThirdStreamIsEnable").next().remove()}if(Capinfo.capInfoMap.NoModifyMainPicSize&&v("#MainStreamPictureSize").prop("disabled",!0),Capinfo.isSupportsystemSetUpLink&&!Capinfo.isSupportIpcCapture&&v("#passRecord").addClass("hidden"),(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(A.push({streamType:"JpegStream",encodeBility:0,data:{}}),Capinfo.isSupportTrafficFlow||Capinfo.isSupport4KFishEye||v("#JpegStream").removeClass("hidden"),Capinfo.isSupportDeviceCombinePic&&v("#syntPassRecord").removeClass("hidden"),Capinfo.isSupportIllegalParam&&v("#peccancyRecord").removeClass("hidden"),(Capinfo.isSupportDeviceCombinePic||Capinfo.isSupportIllegalParam)&&v("#peccancySyntRecord").removeClass("hidden"),IVAMode.ILLEGAL==Frame.IVAType&&(v("#JpegStream").css({"float":"none",clear:"both"}),v("#peccancySyntRecord").css("margin-bottom","0px"),v("#passRecord").addClass("hidden"),v("#syntPassRecord").addClass("hidden")),"undefined"!=typeof Capinfo.capInfoMap.Resolution_jpeg)){for(t=(l=Capinfo.capInfoMap.Resolution_jpeg)?l.length:0,a=0;a<t;a++)o=l[a].split("*"),parseInt(o[0])*parseInt(o[1])<=parseInt(E.Width)*parseInt(E.Hight)&&(o=Q[l[a]]||l[a],i="<option value='"+l[a]+"'>"+o+"</option>",v("#JpegStreamPictureSize").append(i));v("#JpegStreamPicSizeTR").removeClass("hidden")}if(S="<td>"+v.lang.pub.imageQuality+"</td><td></td><td><div class='slider3' id='JpegStreamQuaSlider'><div class='bar3' id='JpegStreamQuaBar'></div></div> <input type='text' name='Quality' id='JpegStreamQuality' name='Quality' class='shortTxt' size='1' maxlength='3' onKeyPress='Utils.onPicKeyPress(this);'/></td>",c="<tr><td colspan='3'>"+v.lang.pub.OnlyEffective+"</td></tr>",Capinfo.isSupportOnlyEncodeQuality?(v("#OnlyEncodeQuality").removeClass("hidden"),v("#imageQualityTR").append(S),v("#imageQualityTR").after(c),v("#passVehicleQuaSlider").parent().parent().addClass("hidden"),v("#procQuaSlider").parent().parent().addClass("hidden"),v("#syntQuaSlider").parent().parent().addClass("hidden")):v("#JpegStreamQualityTR").removeClass("hidden").append(S),0<(e=(y=Capinfo.GopTypeArr).length)){var S=m.find("select[name='GopType']");S.empty();var f="";for(a=0;a<e;a++)f+="<option value='"+y[a]+"'>"+g[a]+"</option>";S.append(f),this.ChangeMainStreamPicSize()}v("#JPEGSizeRange,#ProcJPEGSizeRange").text("1-"+J),v("#TGSyntJPEGSizeRange,#SyntJPEGSizeRange").text("1-"+D)}else this.disablePage()},initData:function(){var e,a,t=0;if(this.getEncodeData()){Utils.LAPI_GetCfgData(LAPI_URL.AcceptanceMode,z);for(var i,o=v("#VinMode").val().split("*")[2],n=0;n<M;n++){var d=A[n],r=d.data,s=v("#"+d.streamType+"FrameRate option"),l=parseInt(r.FrameRate);if(0==v("#"+d.streamType+"FrameRate option[value='"+l+"']").length){for(t=0;t<s.length;t++)if(Number(s[t].value)>l){v(s[t]).before("<option value='"+l+"'>"+l+"</option>");break}if(v("#"+d.streamType+"FrameRate").val(l),Utils.isContainsElement(l,I)<0)for(t=0;t<I.length;t++)if(Number(I[t])>l){I.splice(t,0,l);break}}Capinfo.isSupport4KFishEye?(0==r.IsEnable&&L.push(n),v("#"+d.streamType+"IsEnable").prop("checked",!0),d.encodeBility=this.getEncodeBility(r.Width,r.Hight,r.FrameRate),this.streamEnable(n),v("#"+d.streamType+"BitRate").val(r.BitRate)):1==r.IsEnable&&(d.encodeBility=this.getEncodeBility(r.Width,r.Hight,r.FrameRate),this.streamEnable(n),v("#"+d.streamType+"BitRate").val(r.BitRate)),this.changeEncodeMode(d.streamType),this.enableConfig(d.streamType),this.changeEncodeFmt(d.streamType),a="MainStream"==d.streamType&&z.Mode?z.MinBiteRate:128,v("#"+d.streamType+"BitRateUnit").html("["+a+"~"+p+"]"),(r=v("#"+d.streamType+"BitRate")).attr("maxlength",p.toString().length),r.attr("minBitRate",a),r.attr("maxBitRate",p)}if(30<(o=v("#VinMode").val().split("*")[2])&&v("#"+d.streamType+"UCCodeMode").val(0),Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture){if(!Utils.LAPI_GetCfgData(LAPI_URL.PicQuality,F))return Utils.disableAll(),!1;V=Utils.objectClone(F),Utils.changeMapToMapByMapping(F,U,R,0),u=Utils.objectClone(R),R.ProcJPEGSize/=1e3,R.SyntJPEGSize/=1e3,R.JPEGSize/=1e3,R.TGSyntJPEGSize/=1e3,Utils.cfgToForm(R,"JpegStream"),Capinfo.isSupportIpcCapture||(h.SetValue(R.SyntQuality),C.SetValue(R.ProcQuality),S.SetValue(R.TGSyntQuality)),IVAMode.ILLEGAL!=Frame.IVAType&&(i=R.single_closeUp_width+"*"+R.single_closeUp_height,v("#single_closeUp_picSize").val(i))}Capinfo.isSupportBNC&&(Utils.LAPI_GetCfgData(LAPI_URL.AnalogoutFormat,x),G=Utils.objectClone(x),v("#AnalogoutFormat").val(x.AnalogoutFormat)),0<y.length&&this.ChangeMainStreamPicSize(),Capinfo.isSupport4KFishEye&&this.enableConfig("AuxStream"),Capinfo.isSupport4KFishEye&&Capinfo.isSupportUCODE&&(30<o?v("#AuxStreamUCCodeMode").val(0):v("#AuxStreamUCCodeMode").removeClass("hidden-visible"),b==v("#AuxStreamEncodeFmt").val()&&(v("#AuxStreamUCCodeMode").prop("disabled",!0),v("#AuxStreamEncodeMode").prop("disabled",!0)),30<o&&v("#AuxStreamUCCodeMode").prop("disabled",!0),Utils.parseCapOptions("AuxStreamUCCodeMode",Capinfo.UCODEMode,"mode"),e=v("#MainStreamUCCodeMode").val(),i=v("#AuxStreamUCCodeMode").val(),0==e&&0!=i||30<o?v("#MainStreamUCCodeMode").prop("disabled",!0):(0!=e&&0==i||30<o)&&v("#AuxStreamUCCodeMode").prop("disabled",!0))}},initEvent:function(){var s=this,e=v("#MainStream"),a=v("#AuxStream"),t=v("#ThirdStream"),i=v("#FirstPTZStream"),o=v("#SecondPTZStream"),n=v("#ThirdPTZStream"),d=v("#ForthPTZStream"),r=v("#PanoramaStream");v("#VinMode").change(function(){s.changeVinMode(),s.setVinMode()&&s.disablePage()});for(var l=0;l<M;l++){var p=A[l].streamType;(c=new Slider(p+"Slider",p+"Bar",{onMove:function(){var e;f||(e=Math.round(this.GetValue()),v("#"+this.textId).val(e))},onDragStop:function(){}})).textId=p+"SmoothValue",c.MinValue=1,c.MaxValue=9,A[l].sld=c,(m=new Slider(p+"QuaSlider",p+"QuaBar",{onMove:function(){var e;f||(e=Math.round(this.GetValue()),v("#"+this.textId).val(e))},onDragStop:function(){}})).textId=p+"Quality",m.MinValue=1,m.MaxValue=9,A[l].quaSld=m;var u=v("#"+p+"PictureSize");u.attr("streamId",l),u.attr("isFreshed",0),u.bind("mouseover",function(){var e,a,t,i,o,n=parseInt(v(this).attr("streamId"));parseInt(v(this).attr("isFreshed"))||(e=this.id.replace("PictureSize",""),t=(a=v("#"+e+"PictureSize")).val(),o=(i=v("#"+e+"FrameRate")).val(),n<3?s.changePicsizeAndFrameRate(n):s.changePTZStream(n),0<v("#"+e+"PictureSize option[value='"+t+"']").length?a.val(t):(a.first().attr("selected",!0),a.attr("defaultValue",a.val())),v("#"+e+"Hight").val(a.val().split("*")[1]),v("#"+e+"Width").val(a.val().split("*")[0]),s.changeFrameRateByPicSize(e),0<v("#"+e+"FrameRate option[value='"+o+"']").length?i.val(o):(i.last().attr("selected",!0),i.attr("defaultValue",i.val())),v(this).attr("isFreshed",1),i.attr("isFreshed",1))}),u.change(function(){var e=parseInt(v(this).attr("streamId")),a=this.id.replace("PictureSize",""),t=this.value.split("*"),i=v("#"+a+"Width");i.val(t[0]);var o=v("#"+a+"Hight");o.val(t[1]),s.changeFrameRateByPicSize(a);var n=s.enableStreamByStreamId(e),d=v("#"+a+"FrameRate");if(EncodeRetCode.Successed!=n){if(!confirm(v.lang.tip.tipCloseFollowStream))return v(this).val(v(this).attr("defaultValue")),t=this.value.split("*"),i.val(t[0]),o.val(t[1]),s.changeFrameRateByPicSize(a),d.val(parseInt(d.attr("defaultValue"))),void s.calculateByStreamId(e);t=n.split(","),s.showStreamCfg(t[1],t[0])}else e<M-1&&v("#"+A[e+1].streamType+"IsEnable").prop("disabled",!1),s.showStreamCfg(e,n);v(this).attr("defaultValue",this.value),d.attr("defaultValue",d.val()),s.ChangeBitRate(a);for(var r=e+1;r<M;r++)v("#"+A[r].streamType+"PictureSize").attr("isFreshed",0),v("#"+A[r].streamType+"FrameRate").attr("isFreshed",0);0<y.length&&s.ChangeMainStreamPicSize()});u=v("#"+p+"FrameRate");u.attr("streamId",l),u.attr("isFreshed",0),u.bind("mouseover",function(){var e,a,t,i,o,n=parseInt(v(this).attr("streamId"));parseInt(v(this).attr("isFreshed"))||(e=this.id.replace("FrameRate",""),t=(a=v("#"+e+"PictureSize")).val(),o=(i=v("#"+e+"FrameRate")).val(),n<3?s.changePicsizeAndFrameRate(n):s.changePTZStream(n),0<v("#"+e+"PictureSize option[value='"+t+"']").length?a.val(t):(a.first().attr("selected",!0),a.attr("defaultValue",a.val())),v("#"+e+"Hight").val(a.val().split("*")[1]),v("#"+e+"Width").val(a.val().split("*")[0]),s.changeFrameRateByPicSize(e),0<v("#"+e+"FrameRate option[value='"+o+"']").length?i.val(o):(i.last().attr("selected",!0),i.attr("defaultValue",i.val())),v(this).attr("isFreshed",1),a.attr("isFreshed",1))}),u.change(function(){var e=this.id.replace("FrameRate",""),a=parseInt(v(this).attr("streamId")),t=s.enableStreamByStreamId(a);if(EncodeRetCode.Successed!=t){if(!confirm(v.lang.tip.tipCloseFollowStream))return void v(this).val(parseInt(v(this).attr("defaultValue")));var i=t.split(",");s.showStreamCfg(i[1],i[0])}else a<M-1&&v("#"+A[a+1].streamType+"IsEnable").prop("disabled",!1),s.showStreamCfg(a,t);v(this).attr("defaultValue",this.value);for(var o=a+1;o<M;o++)v("#"+A[o].streamType+"PictureSize").attr("isFreshed",0),v("#"+A[o].streamType+"FrameRate").attr("isFreshed",0);s.ChangeBitRate(e)}),v("#"+p+"EncodeMode").change(function(){s.changeEncodeMode(this.id.replace("EncodeMode",""))}),v("#"+p+"EncodeFmt").change(function(){var e=this.id.replace("EncodeFmt","");s.changeEncodeFmt(e),s.ChangeBitRate(e);var a=v("#"+e+"PictureSize");a.attr("isFreshed",0);var t=v("#"+e+"FrameRate");t.attr("isFreshed",0),a.mouseover(),b==v(this).val()?(t.val(1),v("#"+e+"SvcModeTR").find("input").prop("disabled","true")):v("#"+e+"SvcModeTR").find("input").removeAttr("disabled")}),v("#"+p+"UCCodeMode").change(function(){_=!0;var e,a=this.id.replace("UCCodeMode",""),t=v("#VinMode").val().split("*")[2];s.enableConfig(a),s.ChangeBitRate(a),Capinfo.isSupport4KFishEye&&(e=v("#MainStreamUCCodeMode").val(),a=v("#AuxStreamUCCodeMode").val(),0==e&&0!=a||30<t?v("#MainStreamUCCodeMode").prop("disabled",!0):0!=e&&0==a||30<t?v("#AuxStreamUCCodeMode").prop("disabled",!0):t<=30&&(b!=v("#MainStreamEncodeFmt").val()&&v("#MainStreamUCCodeMode").prop("disabled",!1),b!=v("#AuxStreamEncodeFmt").val()&&v("#AuxStreamUCCodeMode").prop("disabled",!1)))})}(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(p=A[M].streamType,(m=new Slider(p+"QuaSlider",p+"QuaBar",{onMove:function(){var e,a;f||(e=Math.round(this.GetValue()),(a=v("#"+this.textId)).val(e),a[0].setAttribute("defaultValue",e))}})).textId=p+"Quality",m.MinValue=0,m.MaxValue=100,A[M].quaSld=m,v("#"+p+"Quality").bind("change",function(){Utils.validNumber(this,0,100,v.lang.tip.tipVideoImgQualityScopeErr)&&(A[M].quaSld.SetValue(v(this).val()),this.setAttribute("defaultValue",this.value))}),v("#JPEGSize").bind("change",function(){Utils.validNumber(this,1,J,v.lang.tip.tipVideoJPEGSizeScopeErr)&&this.setAttribute("defaultValue",this.value)}),v("#"+p+"PictureSize").change(function(){var e=this.id.replace("PictureSize",""),a=this.value.split("*");v("#"+e+"Width").val(a[0]),v("#"+e+"Hight").val(a[1])}),(h=new Slider("syntQuaSlider","syntQuaBar",{onMove:function(){var e,a;f||(e=Math.round(this.GetValue()),(a=v("#"+this.textId)).val(e),a[0].setAttribute("defaultValue",e)),R.SyntQuality=e}})).textId="SyntQuality",h.MinValue=0,h.MaxValue=100,v("#SyntQuality").bind("change",function(){Utils.validNumber(this,0,100,v.lang.tip.tipVideoImgQualityScopeErr)&&(h.SetValue(v(this).val()),this.setAttribute("defaultValue",this.value)),R.SyntQuality=this.value}),v("#SyntJPEGSize").bind("change",function(){Utils.validNumber(this,1,D,v.lang.tip.tipVideoJPEGSizeScopeErr)&&this.setAttribute("defaultValue",this.value)}),(C=new Slider("procQuaSlider","procQuaBar",{onMove:function(){var e,a;f||(e=Math.round(this.GetValue()),(a=v("#"+this.textId)).val(e),a[0].setAttribute("defaultValue",e)),R.ProcQuality=e}})).textId="ProcQuality",C.MinValue=0,C.MaxValue=100,v("#ProcQuality").bind("change",function(){Utils.validNumber(this,0,100,v.lang.tip.tipVideoImgQualityScopeErr)&&(C.SetValue(v(this).val()),this.setAttribute("defaultValue",this.value)),R.ProcQuality=this.value}),v("#ProcJPEGSize").bind("change",function(){Utils.validNumber(this,1,J,v.lang.tip.tipVideoJPEGSizeScopeErr)&&this.setAttribute("defaultValue",this.value)}),(S=new Slider("passVehicleQuaSlider","passVehicleQuaBar",{onMove:function(){var e,a;f||(e=Math.round(this.GetValue()),(a=v("#"+this.textId)).val(e),a[0].setAttribute("defaultValue",e)),R.TGSyntQuality=e}})).textId="TGSyntQuality",S.MinValue=0,S.MaxValue=100,v("#TGSyntQuality").bind("change",function(){Utils.validNumber(this,0,100,v.lang.tip.tipVideoImgQualityScopeErr)&&(S.SetValue(v(this).val()),this.setAttribute("defaultValue",this.value)),R.TGSyntQuality=this.value}),v("#TGSyntJPEGSize").bind("change",function(){Utils.validNumber(this,1,D,v.lang.tip.tipVideoJPEGSizeScopeErr)&&this.setAttribute("defaultValue",this.value)})),v("#original").bind("click",function(){Utils.stopBubble(),v(".tab_selected").removeClass("tab_selected"),v("#original").addClass("tab_selected"),d.hasClass("hidden")?r.addClass("hidden"):(i.addClass("hidden"),o.addClass("hidden"),n.addClass("hidden"),d.addClass("hidden")),e.removeClass("hidden"),a.removeClass("hidden"),t.removeClass("hidden"),s.setSliderAllValue()}),v("#fish_left_4PTZ").bind("click",function(){Utils.stopBubble(),v(".tab_selected").removeClass("tab_selected"),v("#fish_left_4PTZ").addClass("tab_selected"),e.hasClass("hidden")?r.addClass("hidden"):(e.addClass("hidden"),a.addClass("hidden"),t.addClass("hidden")),i.removeClass("hidden"),o.removeClass("hidden"),n.removeClass("hidden"),d.removeClass("hidden"),s.setSliderAllValue()}),v("#panorama").bind("click",function(){Utils.stopBubble(),v(".tab_selected").removeClass("tab_selected"),v("#panorama").addClass("tab_selected"),d.hasClass("hidden")?(e.addClass("hidden"),a.addClass("hidden"),t.addClass("hidden")):(i.addClass("hidden"),o.addClass("hidden"),n.addClass("hidden"),d.addClass("hidden")),r.removeClass("hidden"),s.setSliderAllValue()})},submitF:function(){var e,a=!0,t="",o=Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture?M+1:M;if(Capinfo.isSupportBNC&&(x.AnalogoutFormat=Number(v("#AnalogoutFormat").val()),Utils.isObjectEquals(x,G)||Utils.LAPI_SetCfgData(LAPI_URL.AnalogoutFormat,x)&&(G=Utils.objectClone(x))),Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture){for(t in IVAMode.ILLEGAL!=Frame.IVAType&&Capinfo.isSupportSingleCloseUp&&(e=v("#single_closeUp_picSize").val(),R.single_closeUp_width=e.split("*")[0],R.single_closeUp_height=e.split("*")[1]),R.ProcJPEGSize=1e3*v("#ProcJPEGSize").val(),R.SyntJPEGSize=1e3*v("#SyntJPEGSize").val(),R.JPEGSize=1e3*v("#JPEGSize").val(),R.TGSyntJPEGSize=1e3*v("#TGSyntJPEGSize").val(),R)isNaN(R[t])&&(R[t]=u[t]);Utils.changeMapToMapByMapping(F,U,R,1),Utils.isObjectEquals(F,V)||(a=Utils.LAPI_SetCfgData(LAPI_URL.PicQuality,F))&&(V=Utils.objectClone(F))}if(a){if(this.encodeListToJsonMap(o),Capinfo.isSupport4KFishEye)for(i=0;i<L.length;i++)n.VideoStreamInfos[L[i]].Enabled=0;Utils.isObjectEquals(n,d)||Utils.LAPI_SetCfgData(LAPI_URL.VideoEncode,n)&&(d=Utils.objectClone(n))}},release:function(){},setSliderAllValue:function(){for(var e=0;e<A.length;e++)f=!0,"undefined"!=typeof A[e].sld&&A[e].sld.SetValue(A[e].data.SmoothValue),A[e].quaSld.SetValue(A[e].data.Quality),f=!1},paraseJsonMap:function(){for(var e=0;e<A.length;e++)Utils.changeMapToMapByMapping(n.VideoStreamInfos[e],t,A[e].data,0),A[e].data.PictureSize=A[e].data.Width+"*"+A[e].data.Hight,Utils.cfgToForm(A[e].data,A[e].streamType),f=!0,"undefined"!=typeof A[e].sld&&A[e].sld.SetValue(A[e].data.SmoothValue),e<M&&v("#"+A[e].streamType+"Quality").val(A[e].data.Quality),A[e].quaSld.SetValue(A[e].data.Quality),f=!1},encodeListToJsonMap:function(e){for(var a=0;a<e;a++)Utils.formToCfg(A[a].streamType,A[a].data),Utils.changeMapToMapByMapping(n.VideoStreamInfos[a],t,A[a].data,1),n.VideoStreamInfos[a].VideoEncodeInfo.ImageQuality=n.VideoStreamInfos[a].VideoEncodeInfo.ImageQuality},getEncodeBility:function(e,a,t){return(parseInt(e)+15&-16)*(parseInt(a)+15&-16)*parseInt(t)},calculateByStreamId:function(e){var a,t=A[e],i=t.streamType,o=v("#"+i+"PictureSize"),n=o.val(),o=(n=""==n?o.first().val():n).split("*"),n=v("#"+i+"FrameRate").val(),n=this.getEncodeBility(o[0],o[1],n);3<=e?(n=16*parseInt(Capinfo.capInfoMap.CorrectALONE[0])*16-parseInt(A[1].encodeBility),7!=e&&(n/=4),b==v("#"+i+"EncodeFmt").val()&&(a=Capinfo.capInfoMap.CorrectALONE[0].split(":"),n=n*parseInt(a[0])/parseInt(a[1]))):b==v("#"+i+"EncodeFmt").val()&&(a=Capinfo.capInfoMap.CONV[0].split(":"),n=n*parseInt(a[0])/parseInt(a[1])),t.encodeBility=n},enableStreamByStreamId:function(e){var a=EncodeRetCode.Successed,t=0;this.calculateByStreamId(e);for(var i=16*parseInt(Capinfo.capInfoMap.ALONE[0])*16,o=0;o<=e;o++)t+=A[o].encodeBility;for(;o<M;o++){var n=A[o].streamType;if(Capinfo.isSupport4KFishEye&&3<=o)break;var d,r=v("#"+n+"IsEnable");if(r.is(":checked")&&(d=v("#"+A[o-1].streamType+"PictureSize").val().split("*"),n=v("#"+n+"PictureSize").val().split("*"),parseInt(n[0])*parseInt(n[1])>parseInt(d[0])*parseInt(d[1])?a=EncodeRetCode.Close:(this.calculateByStreamId(o),A[o].encodeBility>i-t?a=EncodeRetCode.Close:t+=A[o].encodeBility)),!r.is(":checked")||EncodeRetCode.Close==a){for(var s=0,l=Capinfo.capInfoMap.Resolution.length;s<l;s++){var p=Capinfo.capInfoMap.Resolution[s].split("*");if(this.getEncodeBility(p[0],p[1],parseInt(I[0]))<=i-t)break}a=s==l?EncodeRetCode.Disable:a}if(EncodeRetCode.Successed!=a){a+=","+o;break}}return a},changeVinMode:function(){for(var e=["MainStream","AuxStream","ThirdStream"],a=v("#AuxStreamUCCodeMode"),t=v("AuxStreamUCCodeMode").val(),i=0;i<=e.length;i++){var o=v("#"+e[i]+"UCCodeMode"),n=v("#"+e[i]+"IIntervalDiv"),d=v("#MainStreamGopTypeDiv"),r=v("#"+e[i]+"SmoothValueTR"),s=v("#VinMode").val().split("*")[2];o.val(0),n.removeClass("hidden"),d.removeClass("hidden"),r.removeClass("hidden"),Capinfo.isSupportSVC&&v("#MainStreamSvcModeTR").removeClass("hidden"),30<s?(o.prop("disabled",!0),Capinfo.isSupport4KFishEye&&(a.val(0),a.prop("disabled",!0))):t||o.prop("disabled",!1)}},changePTZStream:function(e){var a,t=16*parseInt(Capinfo.capInfoMap.CorrectALONE[0])*16,o=0,n=0,d=A[e].streamType,r=v("#VinMode").val().split("*"),s=r[0],l=r[1],p=r[2],u=Capinfo.capInfoMap.IgnoreResolutionLimit,c=v("#"+d+"PictureSize");for(c.empty(),o=t-parseInt(A[1].encodeBility),7==e?"undefined"!=typeof Capinfo.capInfoMap.ResolutionPanorama&&(a=Capinfo.capInfoMap.ResolutionPanorama):("undefined"!=typeof Capinfo.capInfoMap.ResolutionPTZ&&(a=Capinfo.capInfoMap.ResolutionPTZ),o/=4),i=0,len=a.length;i<len;i++){var m=a[i],h=m.split("*"),C=parseInt(h[0]),S=parseInt(h[1]);!u&&s*l<C*S||(n=this.getEncodeBility(C,S,1),h=Math.floor(o/n),h=Math.min(h,p),(h=b==v("#"+d+"EncodeFmt").val()?C*S<=414720?15<h?15:h:5<h?5:h:h)>=parseInt(I[0])&&(S=Q[m]||m,c.append("<option value='"+m+"' maxFrameRate='"+h+"'>"+S+"</option>")))}},changePicsizeAndFrameRate:function(e){var a,t,i,o=0,n=A[e].streamType,d=v("#VinMode").val().split("*"),r=d[0],s=d[1],l=d[2],p=Capinfo.capInfoMap.Resolution,u=Capinfo.capInfoMap.IgnoreResolutionLimit;0<e&&(r=(d=v("#"+A[e-1].streamType+"PictureSize").val().split("*"))[0],s=d[1]);var c=v("#"+n+"PictureSize");for(c.empty(),t=0;t<e;t++)o+=parseInt(A[t].encodeBility);for(a=16*parseInt(Capinfo.capInfoMap.ALONE[0])*16-o,1==e&&"undefined"!=typeof Capinfo.capInfoMap.Resolution1&&(p=Capinfo.capInfoMap.Resolution1),t=0,i=(p=2==e&&"undefined"!=typeof Capinfo.capInfoMap.Resolution2?Capinfo.capInfoMap.Resolution2:p).length;t<i;t++){var m=p[t],h=m.split("*"),C=parseInt(h[0]),S=parseInt(h[1]);if(Capinfo.isSupportHorizontalMenu){if(r*s<C*S)continue}else{if(!u&&r*s<C*S)continue;if(Capinfo.isSupport4KFishEye){if(1==e&&C/S!=r/s)continue}else if(!u&&1==e&&3145728<=C*S)continue;if(!u&&2==e&&414720<C*S)continue}h=this.getEncodeBility(C,S,1),h=Math.floor(a/h),h=Math.min(h,l);(h=b==v("#"+n+"EncodeFmt").val()?C*S<=414720?15<h?15:h:5<h?5:h:h)>=parseInt(I[0])&&(S=Q[m]||m,c.append("<option value='"+m+"' maxFrameRate='"+h+"'>"+S+"</option>"))}},changeFrameRateByPicSize:function(e){var a=parseInt(E.FrameRate),t=v("#"+e+"PictureSize").find("option:selected").attr("maxFrameRate");t<a&&(a=parseInt(t));var i=v("#"+e+"FrameRate");i.empty();for(var o=1,n=0,d=I.length;n<d&&!(a<(o=parseInt(I[n])));n++)(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(o=12==o?12.5:o),i.append("<option value='"+parseInt(o)+"'>"+o+"</option>");v("#"+e+"FrameRate option").last().attr("selected",!0)},streamEnable:function(e){var a=A[e].streamType,t=v("#"+a+"IsEnable"),i=t.is(":checked")?EncodeRetCode.Successed:EncodeRetCode.Close,i=StreamID.MAIN_VIDEO==e?EncodeRetCode.Successed:i;EncodeRetCode.Successed==i?(StreamID.MAIN_VIDEO!=e&&this.showStreamCfg(e,i),v("#"+a+"PictureSize").mouseover(),this.ChangeBitRate(a),i=this.enableStreamByStreamId(e),EncodeRetCode.Successed!=i&&(a=i.split(","),this.showStreamCfg(a[1],a[0]))):1!=e||!v("#ThirdStreamIsEnable").is(":checked")||confirm(v.lang.tip.tipCloseFollowStream)?this.showStreamCfg(e,i):t.prop("checked",!0)},showStreamCfg:function(e,a){var t=A[e].streamType,i=v("#"+t+"IsEnable");if(EncodeRetCode.Successed==a)i.prop("checked",!0),(1==e||0==e&&v("#AuxStreamIsEnable").is(":checked"))&&v("#ThirdStreamIsEnable").prop("disabled",!1),v("#"+t+"Tbl").removeClass("hidden"),v("#"+t+"Fieldset").removeClass("closeFieldset"),f=!0,A[e].sld.SetValue(v("#"+t+"SmoothValue").val()),A[e].quaSld.SetValue(v("#"+t+"Quality").val()),f=!1;else{i.prop("checked",!1),EncodeRetCode.Disable==a&&i.prop("disabled",!0);for(var o=e;o<M;o++)t=A[o].streamType,v("#"+t+"Tbl").addClass("hidden"),v("#"+t+"Fieldset").addClass("closeFieldset"),e<o&&((i=v("#"+t+"IsEnable")).prop("checked",!1),i.prop("disabled",!0))}},isContain:function(e,a){for(var t=0,i=e.length;t<i;t++)if(a==e[t])return!0;return!1},arrDelete:function(e){for(var a,t=0,i=e.length,o={},n=[];t<i;t++)1!=o[a=e[t]]&&(n.push(a),o[a]=1);return n},ChangeMainStreamPicSize:function(){var e=v("#MainStreamTbl").find("select[name='GopType']"),a=v("#MainStreamPictureSize").val().split("*");2073600<parseInt(a[0])*parseInt(a[1])?(e.val(0),e.prop("disabled",!0)):e.prop("disabled",!1)},setVinMode:function(){var e=v("#VinMode");if(confirm(v.lang.tip.tipVinModeChanged)){var a=e.val().split("*");P.Resolution.Width=a[0],P.Resolution.Height=a[1],P.FrameRate=a[2];a=Utils.LAPI_SetCfgData(LAPI_URL.VideoInMode,P,!1);return Frame.showMsg(a),a}e.val(E.Width+"*"+E.Hight+"*"+E.FrameRate)},getEncodeData:function(){return Utils.LAPI_GetCfgData(LAPI_URL.VideoEncode,n)?(this.paraseJsonMap(),!0):(this.disablePage(),!1)},rangePic:function(e){for(var a=[100,250,350,550,750,950,1150],t=0;t<a.length&&!(e<=a[t]);t++);return t},ChangeBitRate:function(e){var a=v("#"+e+"PictureSize").val(),t=v("#"+e+"EncodeFmt").val(),i=v("#"+e+"UCCodeMode").val(),o=v("#"+e+"FrameRate").val(),n=1,d=a.split("*"),r="1600*1200"==a||"1920*1080"==a||"2048*1536"==a||"2592*2048"==a,d=d[0]*d[1];switch(d/=1e6,d*=100,d=Math.floor(d),this.rangePic(d)){case 0:s="352*288"==a?128:"704*288"==a||"720*576"==a||"640*360"==a||"704*576"==a?1024:2048;break;case 1:s="1920*1080"==a||"1200*1600"==a||"1600*1200"==a?Capinfo.isSupportCapture?2048:4096:"1280*1024"==a||"1280*960"==a?2048:4096;break;case 2:s=("2048*1536"==a||"2048*1520"==a)&&Capinfo.isSupportCapture?2048:5120;break;case 3:s="2592*2048"==a&&Capinfo.isSupportCapture?2048:6144;break;case 4:s=7168;break;case 5:s=8192;break;case 6:s=9216;break;case 7:s=10240}2==i?n*=2:1==i&&d<550&&(n=4*n/3),s/=n,s=128*Math.ceil(s/128),n=1,t==l&&(n*=2),s/=n,s=128*Math.ceil(s/128),o<20?r&&Capinfo.isSupportCapture||(s*=.5):o<=60&&30<o&&(r&&Capinfo.isSupportCapture||(s*=1.5));var s=128*Math.ceil(s/128),e=v("#"+e+"BitRate");e.attr("defaultValue",s),e.val(s)},changeEncodeMode:function(e){var a=1==v("#"+e+"EncodeMode").val();a?(v("#"+e+"QuaSlider").removeClass().addClass("slider3"),v("#"+e+"QuaBar").removeClass().addClass("bar3")):(v("#"+e+"QuaSlider").removeClass().addClass("slider4"),v("#"+e+"QuaBar").removeClass().addClass("bar3 bar4"));for(var t=0;t<M;t++)if(e==A[t].streamType){A[t].quaSld.setEnable(a);break}},changeMainStreamEncodeFmt:function(){var e=v("#MainStreamUCCodeMode"),a=Number(v("#AuxStreamUCCodeMode").val()),t=v("#MainStreamIIntervalDiv"),i=v("#MainStreamGopTypeDiv"),o=v("#MainStreamSmoothValueTR"),n=v("#MainStreamSvcModeTR"),d=v("#VinMode").val().split("*")[2];v("#MainStreamEncodeFmt").val()==b||30<d?(e.val(0),e.prop("disabled",!0),t.removeClass("hidden"),i.removeClass("hidden"),o.removeClass("hidden"),Capinfo.isSupportSVC&&n.removeClass("hidden")):(Capinfo.isSupport4KFishEye&&a||e.prop("disabled",!1),0!=Number(e.val())?(t.addClass("hidden"),i.addClass("hidden"),o.addClass("hidden"),n.addClass("hidden")):(t.removeClass("hidden"),i.removeClass("hidden"),o.removeClass("hidden"),Capinfo.isSupportSVC&&n.removeClass("hidden")))},changeEncodeFmt:function(e){var a=v("#"+e+"EncodeFmt").val(),t=b==a,i=Number(v("#MainStreamUCCodeMode").val()),o=Number(v("#AuxStreamUCCodeMode").val()),n=Number(v("#ThirdStreamUCCodeMode").val()),a=v("#VinMode").val().split("*")[2];v("#"+e+"BitRate").prop("disabled",t),v("#"+e+"IInterval").prop("disabled",t),"MainStream"!=e&&"AuxStream"!=e&&"ThirdStream"!=e||!t||(v("#"+e+"UCCodeMode").prop("disabled",t),v("#"+e+"UCCodeMode").val(0),this.enableConfig(e),a<=30?("MainStream"==e&&b!=v("#AuxStreamEncodeFmt").val()&&b!=v("#ThirdStreamEncodeFmt").val()&&(v("#AuxStreamUCCodeMode").prop("disabled",!1),v("#ThirdStreamUCCodeMode").prop("disabled",!1)),"AuxStream"==e&&b!=v("#MainStreamEncodeFmt").val()&&b!=v("#ThirdStreamEncodeFmt").val()&&(v("#MainStreamUCCodeMode").prop("disabled",!1),v("#ThirdStreamUCCodeMode").prop("disabled",!1)),"ThirdStream"==e&&b!=v("#MainStreamEncodeFmt").val()&&b!=v("#AuxStreamEncodeFmt").val()&&(v("#MainStreamUCCodeMode").prop("disabled",!1),v("#AuxStreamUCCodeMode").prop("disabled",!1))):(v("#MainStreamUCCodeMode").prop("disabled",!0),v("#AuxStreamUCCodeMode").prop("disabled",!0),v("#ThirdStreamUCCodeMode").prop("disabled",!0))),a<=30?("MainStream"!=e||t||o||n||v("#"+e+"UCCodeMode").prop("disabled",t),"AuxStream"!=e||t||i||n||v("#"+e+"UCCodeMode").prop("disabled",t),"ThirdStream"!=e||t||i||o||v("#"+e+"UCCodeMode").prop("disabled",t)):v("#MainStreamEncodeMode").prop("disabled",!1),0!=v("#"+e+"UCCodeMode").val()?v("#"+e+"EncodeMode").prop("disabled",!0):(b==v("#"+e+"EncodeFmt").val()?(v("#"+e+"EncodeMode").prop("disabled",!0),v("#"+e+"UCCodeMode").prop("disabled",!0)):(v("#"+e+"EncodeMode").prop("disabled",!1),Capinfo.isSupport4KFishEye||v("#"+e+"UCCodeMode").prop("disabled",!1)),30<a&&v("#"+e+"UCCodeMode").prop("disabled",!0)),Capinfo.isSupport4KFishEye&&(0!=o&&v("#AuxStreamEncodeMode").prop("disabled",!0),0!=i&&v("#MainStreamEncodeMode").prop("disabled",!0)),b==v("#"+e+"EncodeFmt").val()?v("#"+e+"SvcModeTR").find("input").prop("disabled","true"):v("#"+e+"SvcModeTR").find("input").removeAttr("disabled"),t?(v("#"+e+"EncodeMode").val(1),this.changeEncodeMode(e),v("#"+e+"Slider").removeClass().addClass("slider4"),v("#"+e+"Bar").removeClass().addClass("bar3 bar4")):(this.changeEncodeMode(e),v("#"+e+"Slider").removeClass().addClass("slider3"),v("#"+e+"Bar").removeClass().addClass("bar3"));for(var d=0;d<M;d++)if(e==A[d].streamType){t?A[d].quaSld.setEnable(!0):(v("#"+e+"EncodeMode").val(A[d].data.EncMode),this.changeEncodeMode(e)),A[d].sld.setEnable(!t);break}},disablePage:function(){var e="";Utils.disableAll();for(var a=0;a<M;a++)e=A[a].streamType,v("#"+e+"QuaSlider").removeClass().addClass("slider4"),v("#"+e+"QuaBar").removeClass().addClass("bar3 bar4"),A[a].quaSld.setEnable(!1),v("#"+e+"Slider").removeClass().addClass("slider4"),v("#"+e+"Bar").removeClass().addClass("bar3 bar4"),A[a].sld.setEnable(!1);(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(e=A[M].streamType,v("#"+e+"QuaSlider").removeClass().addClass("slider4"),v("#"+e+"QuaBar").removeClass().addClass("bar3 bar4"),A[M].quaSld.setEnable(!1))},validateBitRate:function(e){Utils.validNumber(e,parseInt(v(e).attr("minBitRate")),parseInt(v(e).attr("maxBitRate")),v.lang.tip.tipBitRateScopeErr)},ValidVideoIInterval:function(e){Utils.validNumber(e,5,250,v.lang.tip.tipVideoIIntervalScopeErr)},enableConfig:function(e){var a,t=v("#"+e+"IIntervalDiv"),i=v("#"+e+"GopTypeDiv"),o=v("#"+e+"SmoothValueTR"),n=v("#"+e+"SvcModeTR"),d=v("#"+e+"EncodeMode");0!=v("#"+e+"UCCodeMode").val()?(a=!0,t.addClass("hidden"),n.addClass("hidden"),i.addClass("hidden"),o.addClass("hidden"),d.val(1),this.changeEncodeMode(e)):(a=!1,t.removeClass("hidden"),Capinfo.isSupportSVC&&v("#"+e+"SvcModeTR").removeClass("hidden"),i.removeClass("hidden"),o.removeClass("hidden"),1==_&&("MainStream"==e?d.val(A[0].data.EncMode):"AuxStream"==e?d.val(A[1].data.EncMode):"ThirdStream"==e&&d.val(A[2].data.EncMode),this.changeEncodeMode(e),_=!1)),d.prop("disabled",a)},initUCodeLang:function(){v(".Ucode").each(function(){var e=v(this);Capinfo.isUN||e.html(v.lang.pub.UCODE)})}}))}(jQuery),Frame.currentNameSpace=Config.Encode;