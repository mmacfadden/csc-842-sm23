Utils.$package("cruisePlan"),cruisePlan=function(s){var P=[],o={},c=1,l=0,T=s.lang.tip.tipTimeOverlap,f=[s.lang.pub.monday,s.lang.pub.tuesday,s.lang.pub.wednesday,s.lang.pub.thursday,s.lang.pub.friday,s.lang.pub.saturday,s.lang.pub.sunday],d={};return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initData(),Utils.afterDataLoad(),s("input[class='Wdate']").bind("focus",Utils.pickerTime)},initPage:function(){for(var a="",e=1;e<57;e++)a+="<input name='PlanStartTime"+e+"' id='PlanStartTime"+e+"' type='hidden' value=''/><input name='PlanEndTime"+e+"' id='PlanEndTime"+e+"' type='hidden' value=''/><input name='PlanTrack"+e+"' id='PlanTrack"+e+"' type='hidden' value=''/>";s("#hiddenInputsDiv").html(a)},initData:function(){var a,e,t={};for(d={},this.getTrackInfo(),a=1;a<=8;a++)this.makeSelectList("Track"+a,P);if(Utils.LAPI_GetCfgData(LAPI_URL.PTZPatrolWeekPlan,d)){for(var n=0;n<7;n++)for(e=0;e<8;e++){var r=8*n+e+1,l=d.Day[(n+1)%7].TimeSection[e];o["PlanStartTime"+r]=l.Begin,o["PlanEndTime"+r]=l.End,o["PlanTrack"+r]=l.RouteID}for(a=1;a<57;a++)"00:00:00"==o["PlanStartTime"+a]&&"00:00:00"==o["PlanEndTime"+a]&&(o["PlanStartTime"+a]="",o["PlanEndTime"+a]="",o["PlanTrack"+a]=0);for(e in o)"24:00:00"==o[e]&&(o[e]="");if(!Utils.LAPI_GetCfgData(LAPI_URL.PTZWeekPlanStatusPatrol,t))return Utils.disableAll("popwin_content"),!1;for(o.PlanEnable=t.Enable,Utils.cfgToForm(o,"frmSetupCruisePlan"),s("a[class='selected']").removeClass("selected"),s("#monday").addClass("selected"),a=c=1;a<9;a++)s("#StartTime"+a).val(s("#PlanStartTime"+a).val()),s("#EndTime"+a).val(s("#PlanEndTime"+a).val()),s("#Track"+a).val(s("#PlanTrack"+a).val());return!0}},initEvent:function(){},submitWinData:function(){var a,e;if(this.ValidTimeRange()){var t=!1;Utils.formToCfg("frmSetupCruisePlan",o);for(e in o)""===(a=o[e])&&(o[e]=a="24:00:00"),0;for(var n=0;n<7;n++)for(e=0;e<8;e++){var r=8*n+e+1,l=d.Day[(n+1)%7].TimeSection[e];l.Begin=o["PlanStartTime"+r],l.End=o["PlanEndTime"+r],l.RouteID=o["PlanTrack"+r]}var i=Utils.LAPI_SetCfgData(LAPI_URL.PTZPatrolWeekPlan,d);i&&(Utils.formToCfg("frmSetupCruisePlan",o),a=s("#PlanEnable").is(":checked")?1:0,Utils.LAPI_SetCfgData(LAPI_URL.PTZWeekPlanStatusPatrol,{Enable:a})&&(o.PlanEnable=a,t=!0)),Frame.showMsg(t),t&&Utils.closeWin()}},release:function(){},ValidTimeRange:function(){for(var a=[],e=[],t=[],n=0;n<8;n++)if(a[n]=s("#StartTime"+(n+1)).val(),e[n]=s("#EndTime"+(n+1)).val(),t[n]=s("#Track"+(n+1)).val(),""==a[n]&&""==e[n]){if(0!=t[n])return alert(s.lang.tip.tipTimeFormatErr1.replace("%s",f[c-1])),!1}else{if(0==t[n])return alert(s.lang.tip.tipCruisePlanRouteErr.replace("%s",f[c-1])),!1;if(a[n]>=e[n])return alert(s.lang.tip.tipTimeFormatErrStartEnd.replace("%s",f[c-1])),!1}for(n=0;n<8;n++)if(""!=a[n]||""!=e[n])for(var r=1;n+r<8;r++){var l=a[n+r],i=e[n+r];if((""!=l||""!=i)&&(a[n]>=l&&a[n]<=i||l>=a[n]&&l<=e[n]))return alert(T.replace("%s",f[c-1])),!1}for(n=1;n<9;n++){var o=8*(c-1)+n;s("#PlanStartTime"+o).val(s("#StartTime"+n).val()),s("#PlanEndTime"+o).val(s("#EndTime"+n).val()),s("#PlanTrack"+o).val(s("#Track"+n).val())}return!0},toggle:function(a,e){if(this.ValidTimeRange()){s("li.selected").removeClass("selected"),s(a).addClass("selected"),c=e;for(var t=1;t<9;t++){var n=8*(c-1)+t;s("#StartTime"+t).val(s("#PlanStartTime"+n).val()),s("#EndTime"+t).val(s("#PlanEndTime"+n).val()),s("#Track"+t).val(s("#PlanTrack"+n).val())}}},DoCopy:function(){this.ValidTimeRange()&&(l=c)},DoPaste:function(){if(0!=l)for(var a=1;a<9;a++){var e=8*(c-1)+a,t=8*(l-1)+a,n=s("#PlanStartTime"+t);s("#PlanStartTime"+e).val(n.val());var r=s("#PlanEndTime"+t);s("#PlanEndTime"+e).val(r.val());t=s("#PlanTrack"+t);s("#PlanTrack"+e).val(t.val()),s("#StartTime"+a).val(n.val()),s("#EndTime"+a).val(r.val()),s("#Track"+a).val(t.val())}},getTrackInfo:function(){var a={},e={},t={};if(Utils.LAPI_GetCfgData(LAPI_URL.PTZPatrol,e)&&Utils.LAPI_GetCfgData(LAPI_URL.PTZRoutePatrol,t)){for(var n=0;n<e.Num;n++){a["Track"+(n+1)+"CruiseNum"]=e.PatrolInfos[n].Num,a["Track"+(n+1)+"TrackId"]=e.PatrolInfos[n].ID+1,a["Track"+(n+1)+"TrackName"]=e.PatrolInfos[n].Name;for(var r=0;r<e.PatrolInfos[n].Num;r++)a["Track"+(n+1)+"Action"+(r+1)]=e.PatrolInfos[n].Actions[r].Type,a["Track"+(n+1)+"Duration"+(r+1)]=0==e.PatrolInfos[n].Actions[r].Duration?e.PatrolInfos[n].Actions[r].Para3:e.PatrolInfos[n].Actions[r].Duration,a["Track"+(n+1)+"Speed"+(r+1)]=0==e.PatrolInfos[n].Actions[r].Para1?e.PatrolInfos[n].Actions[r].Para2:e.PatrolInfos[n].Actions[r].Para1,a["Track"+(n+1)+"PresetId"+(r+1)]=e.PatrolInfos[n].Actions[r].PresetID}P=[];for(var l=1;undefined!=a["Track"+l+"TrackId"];l++){var i="Track"+l,o=a[i+"TrackId"],s={};s.id=o,s.name=a[i+"TrackName"],P.push(s)}for(l=0;l<t.Num;l++)(s={}).id=t.RecordedPatrolInfos[l].ID+1,P.push(s)}},makeSelectList:function(a,e){var t=s("#"+a);t.empty(),t.append("<option value='0' selected='selected'>"+s.lang.pub.pleaseSelect+"</option>");for(var n=0,r=e.length;n<r;n++){var l,i=e[n];i&&(i=(l=i.id)+"["+("undefined"==typeof i.name?s.lang.pub.modeRoute:i.name)+"]",t.append("<option value='"+l+"' title='"+i+"'>"+i+"</option>"))}}}))}(jQuery),Frame.openWinNameSpace=cruisePlan;