Config.alarmCapture=function(o){var t,a=null,u=null,s={},p={},d={},m={Enable:["Enable"],Width:["Resolution","Width"],Height:["Resolution","Height"],Quality:["Quality"],CaptureInterval:["CaptureInterval"],CaptureNumber:["CaptureNumber"],CaptureTimeMode:["TimingCapture","CaptureTimeMode"],PlanNum:["TimingCapture","PlanNum"],IntervalTime:["TimingCapture","Interval"],snapPictureSize:["PictureSize"]},c=[],g=[{fieldId:"rowNum",fieldType:"RowNum"},{fieldId:"Time"},{fieldId:"option",fieldType:"option",option:"<a href='#' class='icon black-del' rowNum=rowNum onclick='Config.alarmCapture.delHoliday($(this).attr(\"rowNum\"));' title='"+o.lang.pub.del+"'></a>"}];return new(Class.extend({init:function(){Utils.beforeDataLoad(),Utils.initLang(),this.initPage(),this.initEvent(),this.initData(),this.initValidator(),Utils.afterDataLoad()},initPage:function(){},initData:function(){var e;if(p={},Utils.LAPI_GetCfgData(LAPI_URL.CaptureImage,p)){d=Utils.objectClone(p),c=p.TimingCapture.UserDefPlanList,Utils.LAPI_CfgToForm("frmSetup",p,s,m),(u=new TableView("dataview_tbody",this.getDataList,g,6)).createDataView(),this.changeCaptureTimeMode();var i,t,a={};Utils.LAPI_GetCfgData(LAPI_URL.VideoInMode,a)&&(i=a.Resolution.Width,t=a.Resolution.Height);for(var n=0,r=Capinfo.capInfoMap.Resolution.length;n<r;n++){var l=Capinfo.capInfoMap.Resolution[n].split("*");parseInt(l[0])<=parseInt(i)&&parseInt(l[1])<=parseInt(t)&&(e=l[0]+"*"+l[1],o("#Resolution").append("<option value='"+e+"'>"+e+"</option>"))}e=s.Width+"*"+s.Height,o("#Resolution").val(e),this.initPicRange()}else Utils.disableAll()},initEvent:function(){var i=this;o("input[name='CaptureTimeMode']").bind("click",function(){i.changeCaptureTimeMode()}),o("#addHoliday").bind("click",function(){i.addTime()}),o("#Resolution").bind("change",function(){i.initPicRange(),a.resetForm(),rule=a.settings.rules,800==t?rule.snapPictureSize={integer:!0,required:!0,range:[1,800]}:1500==t&&(o("#snapPictureSize").prop("maxlength",4),rule.snapPictureSize={integer:!0,required:!0,range:[1,1500]});var e=o("#Resolution").val().split("*"),e=e[0]*e[1]/1e5;e<=25?o("#snapPictureSize").val(300):25<e&&e<=45?o("#snapPictureSize").val(500):45<e&&e<120?o("#snapPictureSize").val(700):120<=e&&o("#snapPictureSize").val(1e3),i.initValidator()})},submitF:function(){var e;a.form()&&(Utils.LAPI_FormToCfg("frmSetup",p,s,m),e=o("#Resolution").val().split("*"),p.Resolution.Width=e[0],p.Resolution.Height=e[1],Utils.isObjectEquals(p,d)?Frame.showMsg(!0,o.lang.tip.tipAnyChangeInfo,0):Utils.LAPI_SetCfgData(LAPI_URL.CaptureImage,p)&&(d=Utils.objectClone(p)))},release:function(){delete Config.alarmCapture},initPicRange:function(){var e=o("#Resolution").val().split("*");s.Width=e[0],s.Height=e[1],Number(s.Width*s.Height/1e4)<=400?(t=800,o("#snapPictureSize").prop("maxlength",3)):(t=1500,o("#snapPictureSize").prop("maxlength",4))},initValidator:function(){o("#snapPictureSize").attr("tip",o.validator.format(o.lang.tip.tipIntRange,1,t)),o("#IntervalTime").attr("tip",o.validator.format(o.lang.tip.tipIntRange,1,86400)),(a=o("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,i){Utils.showJqueryErr(e,i,"span")},success:function(e){},rules:{IntervalTime:{integer:!0,required:!0,range:[1,86400]},snapPictureSize:{integer:!0,required:!0,range:[1,t]}}})).init()},changeCaptureTimeMode:function(){o("#intervalUpload").is(":checked")?(o("#IntervalTimeDiv").removeClass("hidden"),o("#timeTableDiv").addClass("hidden")):(o("#timeTableDiv").removeClass("hidden"),o("#IntervalTimeDiv").addClass("hidden"))},addTime:function(){WdatePicker({el:"d12",dateFmt:"HH:mm:ss",lang:top.wdateLang,onpicked:function(e){for(var i=e.cal.getDateStr(),t=0,a=c.length;t<a;t++){if(0==c[t].Enable){c[t].Enable=1,c[t].Time=i;break}if(i==c[t].Time)return;if(t==c.length-1)return void Frame.showMsg(!0,o.lang.tip.tipTimeNum,0)}u.refresh()}})},delHoliday:function(e){c.splice(e,1),c.push({Enable:0,Time:""}),u.refresh()},getDataList:function(){for(var e,i=[],t=0,a=Number(s.PlanNum);t<a;t++)1==(e=c[t]).Enable&&i.push(e);return i}}))}(jQuery),Frame.currentNameSpace=Config.alarmCapture;