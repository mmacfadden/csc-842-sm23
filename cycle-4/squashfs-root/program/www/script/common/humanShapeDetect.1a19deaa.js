Config.humanShapeDetect=function(o){var l=null,s=DrawType.RECT,n=!0,c=null,d=["CC66FF","FF6633","0099FF","339933","CC0033","6666CC","FFFF66","99CC00"],a=["switchOutLi","ftpLi","emailLi","storLi","picLi"],u={},h={},m={},p={},f={},g={},L={},b={},e={Enable:["Enabled"]},t={},r={Sensitivity:{sliderId:"SensitivitySld",barId:"SensitivityBar",minValue:1,maxValue:100,sld:null},TargetSize:{sliderId:"TargetSizeSld",barId:"TargetSizeBar",minValue:1,maxValue:100,sld:null}};return new(Class.extend({init:function(){LoginType.VM_LOGIN!=Frame.loginType&&Utils.loadHtml("smartLinkOutIFrameDiv","/page/common/smart_linkout.76e56953.htm"),Utils.beforeDataLoad(),Utils.initLang(),this.initPage(),this.initValidator(),this.initEvent(),this.initData(),Utils.initVideo("recordManager_div_activeX",StreamType.LIVE,RunMode.CONFIG,null,Capinfo.isSupportPTZ,this.initVideo_callback),Utils.afterDataLoad()},initPage:function(){o("#areaTblDiv").removeClass("hidden"),o("#areaType").removeClass("hidden"),o("#areaName").removeClass("hidden"),o("#settingsDiv").removeClass("sectionDiv").addClass("areaInfo panel"),LoginType.VM_LOGIN!=Frame.loginType&&smartLinkOutIframe.initPage(a);var e=o(".fixLine");LoginType.VM_LOGIN==Frame.loginType&&(e.css("left",35),e.css("top",0));var t,e=o("#recordManager_div_activeX");for(t in Utils.resetVideoSize(Frame.DefaultStreamID,"recordManager_div_activeX"),e.height(18*Math.ceil(e.height()/18)),o("#add").attr("title",o.lang.pub.add),LoginType.VM_LOGIN==Frame.loginType&&((e=o("#videoDiv")).css("float","left"),o("#linkOutIFrame").addClass("hidden"),o("#planDiv").addClass("hidden"),o("#contentDiv").css({margin:"0 0 0 15px"}),e.css("marginLeft","5px"),o("#submitBtn").remove()),this.initSlider(),r)Object.prototype.hasOwnProperty.call(r,t)&&(this.setSliderEnable(t,!0),this.setSliderValue())},initData:function(){Utils.LAPI_GetCfgData(LAPI_URL.HumanShapeDetectAreas,h)&&Utils.LAPI_GetCfgData(LAPI_URL.HumanShapeDetectRule,g)&&Utils.LAPI_GetCfgData(LAPI_URL.HumanShapeDetectInterval,p)?(m=Utils.objectClone(h),L=Utils.objectClone(g),f=Utils.objectClone(p),Utils.LAPI_CfgToForm("frmSetup",g,t,e),Utils.LAPI_CfgToForm("frmSetup",p),c=h.Num,this.initAreaList(),LoginType.VM_LOGIN!=Frame.loginType&&(smartLinkOutIframe.initData(LAPI_URL.HumanShapeDetectLink)||(Utils.disableAll(),Frame.showMsg(!1,o.lang.tip.tipGetCfgFail)),Plan.init(LAPI_URL.WeekPlan+"HumanShapeDetect")),this.initDetectAreas()):Utils.disableAll()},initEvent:function(){var e=this;LoginType.VM_LOGIN==Frame.loginType&&(o("#IntervalTime").change(function(){e.submitF()}),o("#Dejitter").change(function(){e.submitF()})),o("#Enable").click(function(){this.checked?g.Enabled=1:g.Enabled=0})},submitF:function(){var e,t,a,i=!1;if(Utils.LAPI_FormToCfg("frmSetup",h.RectangleAreasList[l]),Utils.LAPI_FormToCfg("frmSetup",g),e=!Utils.isObjectEquals(h,m),t=!Utils.isObjectEquals(g,L),(e||t)&&(i=Utils.LAPI_SetCfgData(LAPI_URL.HumanShapeDetectAreas,h),r=Utils.LAPI_SetCfgData(LAPI_URL.HumanShapeDetectRule,g),(i||r)&&(m=Utils.objectClone(h),L=Utils.objectClone(g))),validator.form()){if(Utils.LAPI_FormToCfg("frmSetup",p),(a=!Utils.isObjectEquals(p,f))&&(i=Utils.LAPI_SetCfgData(LAPI_URL.HumanShapeDetectInterval,p))&&(f=Utils.objectClone(p)),LoginType.VM_LOGIN!=Frame.loginType){var n=smartLinkOutIframe.IsChanged(),r=Plan.IsChanged();if(!(e||n||a||r||t))return Frame.showMsg(!0,o.lang.tip.tipAnyChangeInfo,0),!1;r&&(i=Plan.submitF(LAPI_URL.WeekPlan+"HumanShapeDetect")),n&&(i=smartLinkOutIframe.submitF(LAPI_URL.HumanShapeDetectLink))}return i}},release:function(){Utils.EnableDrawFun(StreamType.LIVE,0),Frame.hiddenVideo(),delete Config.humanShapeDetect},initSlider:function(){var e,t,a,i=this;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t=r[e],(a=new Slider(t.sliderId,t.barId,{onMove:function(){n&&o("#"+this.textId).val(Math.round(this.GetValue()))},onDragStop:function(){i.submitF()},showTip:!0})).textId=e,a.MinValue=t.minValue,a.MaxValue=t.maxValue,t.sld=a)},setSliderValue:function(){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n=!1,r[e].sld.SetValue(Number(o("#"+e).val())),n=!0)},setSliderEnable:function(e,t){var a=r[e].sliderId,i=r[e].barId;t?(o("#"+a).removeClass().addClass("slider4"),o("#"+i).removeClass().addClass("bar3 bar4")):(o("#"+a).removeClass().addClass("slider3"),o("#"+i).removeClass().addClass("bar3")),r[e].sld.setEnable(!t),o("#"+e).prop("disabled",t)},packbits:function(e){for(var t,a,i=[],n=0,r=0,l=e.length,s=0,o=0;0<l;s=t,l-=r)if(a=l<128?l:128,3<=l&&e[s+1]==e[s]&&e[s+2]==e[s]){for(t=s+3,n=3;n<a&&e[t]==e[s];n++)++t;i[o++]=257-(r=n),i[o++]=e[s]}else{for(t=s,n=0;n<a&&!(n+3<=l&&e[t+1]==e[t]&&e[t+2]==e[t]);n++)++t;i[o++]=(r=n)-1,i=i.concat(e.slice(s,s+r)),o+=r}return i},unpackbits:function(e){for(var t,a,i,n=[],r=e.length,l=0;1<r;)if(--r,128!=(a=e[l++]))if(128<a)for(a=257-a,i=e[l++],--r,t=0;t<a;t++)n.push(i);else{if(r<++a)break;n=n.concat(e.slice(l,l+a)),l+=a,r-=a}return n},strToNumArr:function(e){var t,a=e.length%8,i=[];if(0!=a)for(a=8-a,t=0;t<a;t++)e+="0";for(a=e.length;0<a;a-=8)i.push(parseInt(e.substr(0,8),2)),e=e.substring(8);return i},numArrToStr:function(e){for(var t,a,i,n=e.length,r="",l=0;l<n;l++){for(i=8-(a=parseInt(e[l],10).toString(2)).length,t=0;t<i;t++)r+="0";r+=a}return r},encodeData:function(e){for(var t="",a=e,i=0,n=(a=this.packbits(a)).length;i<n;i++)t+=String.fromCharCode(a[i]);return Utils.base64encode(t)},decodeData:function(e){for(var t=[],a=0,i=(e=Utils.base64decode(e)).length;a<i;a++)t.push(e.charCodeAt(a));return t=this.unpackbits(t)},clickDetectAreaLink:function(){for(var e=0;e<c&&o("#areaTR"+e).is(":hidden");e++);},selectArea:function(e){null!=l&&(o("#areaTR"+l).removeClass("selectedTR"),o("#selectDiv"+l).removeClass("selectedDiv")),o("#areaTR"+(l=e)).addClass("selectedTR"),o("#selectDiv"+l).addClass("selectedDiv"),Utils.selectDrawObj(s,l),this.showAreaInfo()},showAreaInfo:function(){for(var e in o("#areaName").html(l+1),Utils.LAPI_CfgToForm("frmSetup",h.RectangleAreasList[l]),r)Object.prototype.hasOwnProperty.call(r,e)&&this.setSliderEnable(e,!1);this.setSliderValue()},addArea:function(){for(var e,t,a,i=0;i<c&&!(a=o("#areaTR"+i)).is(":hidden");i++);i!=c?((e=h.RectangleAreasList[i]).Enabled=1,t=e.Area,this.submitF()&&((e=u[s][i]).Left=Number(t.TopLeft.X),e.Top=Number(t.TopLeft.Y),e.Right=Number(t.BottomRight.X),e.Bottom=Number(t.BottomRight.Y),a.removeClass("hidden"),this.selectArea(i),Utils.setDrawObj(s,i,u),Utils.showHiddenArea(s,i,1),o("#areaTR"+i).removeClass("hidden"),this.selectArea(i))):Frame.showMsg(!0,o.lang.tip.tipUpperHumanDetInfo,0)},removeArea:function(e){if(h.RectangleAreasList[e].Enabled=0,this.submitF()){if(e==l&&null!=l){l=null;for(var t=0;t<c;t++)if(1==h.RectangleAreasList[t].Enabled){this.selectArea(t);break}}for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&this.setSliderEnable(a,!1);if(null==l)for(a in o("#areaName").html(""),o("#Sensitivity").val(1),o("#TargetSize").val(1),this.setSliderValue(),r)Object.prototype.hasOwnProperty.call(r,a)&&this.setSliderEnable(a,!0);o("#areaTR"+e).addClass("hidden"),Utils.showHiddenArea(s,e,0),this.clickDetectAreaLink()}},initAreaList:function(){for(var e=h.RectangleAreasList,t=0;t<c;t++){var a=e[t],i=o.lang.pub.area,i="<tr id='areaTR"+t+"' class='"+(1==a.Enabled?"":"hidden")+"'><td onclick='Config.humanShapeDetect.selectArea("+t+");' ><div id='selectDiv"+t+"' class='unselectDiv'><div class='colorDiv' style='background-color: #"+d[t]+"'></div></div></td><td onclick='Config.humanShapeDetect.selectArea("+t+");' >"+i+(t+1)+"</td><td align='right'><a class='icon black-del' onclick='Config.humanShapeDetect.removeArea("+t+");this.blur();' title='"+o.lang.pub.del+"'></a></td></tr>";o("#areaTbl").append(i)}},setRenderScale:function(){Video.setRenderScale(StreamType.LIVE,0)},initDetectAreas:function(){for(var e,t=0,a=!1,i=h.RectangleAreasList,n=0;n<c;n++)t=0,1==i[n].Enabled&&(t=1,a||(this.selectArea(n),a=!0)),Utils.showHiddenArea(s,n,t);if(a)this.clickDetectAreaLink();else for(e in o("#Sensitivity").val(1),o("#TargetSize").val(1),this.setSliderValue(),r)Object.prototype.hasOwnProperty.call(r,e)&&this.setSliderEnable(e,!0);b.Enabled=0,LoginType.VM_LOGIN!=Frame.loginType&&Plan.init(LAPI_URL.WeekPlan+"HumanShapeDetect")},initDetectArea:function(){var e,t,a,i,n=this,r=LANG_TYPE.Chinese==top.language?o.lang.pub.area:"area",l=h.RectangleAreasList;for((u={})[s]=[],e=0;e<c;e++)a=(t=l[e].Area).TopLeft,i=t.BottomRight,(t={}).Text=r+(e+1),t.Left=Number(a.X),t.Top=Number(a.Y),t.Right=Number(i.X),t.Bottom=Number(i.Y),t.LineColor=Utils.getDrawObjColor(d[e]),t.LineWidth=2,u[s].push(t);Utils.initDrawObj(u,function(){n.initDetectAreas()})},eventDrawObjParam:function(e,t,a){var i,n=h.RectangleAreasList[t].Area,r=n.TopLeft,n=n.BottomRight,l={},s=u[e][t];for(i in l=o.parseJSON(a))Object.prototype.hasOwnProperty.call(l,i)&&(s[i]=l[i]);DrawType.RECT==e?(r.X=Math.round(s.Left),r.Y=Math.round(s.Top),n.X=Math.round(s.Right),n.Y=Math.round(s.Bottom)):DrawType.RECT_DIAMOND==e&&(b.Grid=this.encodeData(s.Diamond)),this.submitF()},eventSelDrawObj:function(e,t){DrawType.RECT==e&&this.selectArea(t)},initVideo_callback:function(e){Utils.EnableDrawFun(e,1),Video.cur_scale=UIRenderScale.FULL,Config.humanShapeDetect.setRenderScale(),Config.humanShapeDetect.initDetectArea()},initValidator:function(){o("#SuppressTime").attr("tip",o.validator.format(o.lang.tip.tipIntRange,5,3600)),o("#ClearTime").attr("tip",o.validator.format(o.lang.tip.tipIntRange,1,600)),validator=o("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,t){Utils.showJqueryErr(e,t,"span")},success:function(e){},rules:{SuppressTime:{integer:!0,required:!0,range:[5,3600]},ClearTime:{integer:!0,required:!0,range:[1,600]}}}),validator.init()}}))}(jQuery),Frame.currentNameSpace=Config.humanShapeDetect;