Utils.$package("cruiseEdit"),cruiseEdit=function(m){var o=0==cruise.currentCruiseOperate?-1:cruise.currentTrackId,t=0==cruise.currentCruiseOperate?"":cruise.currentTrackName,f=["IsSelect:checkbox","Action:select","Speed:select","IsTurning:checkbox","Duration:text","PresetId:select","StayTime:text"],b=[1284,1282,1026,1028,1794,2050,1796,2052,772,770],g=[1794,2050,1796,2052],l=64;return new(Class.extend({init:function(){Utils.beforeDataLoad(),Utils.initLang(),this.initPage(),this.initValidator(),this.initEvent(),this.initData(),Utils.strLimit()},initPage:function(){m("#rootPreset").append(m("#position").html()),this.initTrackTable(),this.numTipCreate()},initData:function(){m("#TrackId").val(-1==o?"":o),m("#TrackName").val(null==t?"":t)},initEvent:function(){var t=this;m("#addAction").bind("click",function(){t.addAction()}),m("#delAction").bind("click",function(){t.delAction()}),m("#moveTop").bind("click",function(){t.moveAction(0)}),m("#moveUp").bind("click",function(){t.moveAction(1)}),m("#moveDown").bind("click",function(){t.moveAction(2)}),m("#moveBottom").bind("click",function(){t.moveAction(3)}),m("#TrackId").bind("blur",function(){validator.element(this)&&m(this).val(parseInt(this.value,10))})},submitWinData:function(){if(validator.form()){var t="",e={},a=m("#trackTbl").find("tr");e.Actions=[];for(var i=0,n=0,r=a.length;i<r;i++){var o=a.get(i).id.replace("trackTbl","");if(m("#IsSelect"+o).is(":hidden"))break;e.Actions[n]={};for(var l=0,d=f.length;l<d;l++){var c=f[l].split(":"),s=c[0].trim();if("checkbox"!=c[1]){var u=m("#"+s+o),p=Number(m("#Action"+o).val()),c=""==u.val()?0:u.val();if("Duration"==s&&(770==p?(c*=100,e.Actions[n].Para3=Number(c),e.Actions[n].Duration=0):(e.Actions[n].Para3=0,e.Actions[n].Duration=Number(c))),u.is(":visible")&&"PresetId"==s&&-1==c)return alert(m.lang.tip.tipNeedPreset.replace("s%",i+1)),!1;t+=s+n+"="+c+"&","PresetId"==s&&(e.Actions[n].PresetID=Number(c)),"Action"==s&&(e.Actions[n].Type=Number(c)),"Speed"==s&&(1284!=p&&1282!=p||(e.Actions[n].Para1=Number(c),e.Actions[n].Para2=0),1026!=p&&1028!=p||(e.Actions[n].Para1=0,e.Actions[n].Para2=Number(c)),-1<this.isContain(g,p)&&(e.Actions[n].Para1=Number(c),e.Actions[n].Para2=Number(c)),1538==p&&(e.Actions[n].Para1=Number(c)))}}n++;var h=this.isContain(b,p),v=Number(m("#StayTime"+o).val());-1<h&&0<v?(e.Actions[n]={},e.Actions[n].Type=2305,e.Actions[n].Para1=0,e.Actions[n].Para2=0,e.Actions[n].Duration=v,n++):e.Actions[n-1].Duration=v}""!=t?(e.ID=Number(m("#TrackId").val())-1,e.Name=m("#TrackName").val(),e.Num=n,Utils.LAPI_CreateCfgData(LAPI_URL.PTZPatrolRoute,e,!1)?(cruise.initCruiseInfo(),Utils.closeWin()):Frame.showMsg(!1)):alert(m.lang.tip.tipTrackPointCanotEmpty)}},release:function(){},isContain:function(t,e){for(var a=-1,i=t?t.length:0,n=0;n<i;n++)if(e==t[n]){a=n;break}return a},initTrackTable:function(){m("#trackTbl").empty();for(var t=cruise.trackInfoMap[o],e=m("#trackTbl").find("tr").length,a=undefined==t?0:t.length,i=0;i<a;i++){var n,r=undefined==t||0==t.length?null:t[i];r&&2305==r.Action?((n=m("#StayTime"+(e-1))).val(r.Duration),n.attr("defaultValue",r.Duration)):(this.createRow("trackTbl",e,f,r),null!=r&&(m("#Action"+e).change(),1538==r.Action?(m("#Speed"+e).val(r.Speed),m("#StayTime"+e).val(r.Duration)):0==r.Duration&&(n=m("#IsTurning"+e),r=m("#Duration"+e),n.click(),n.prop("checked",!0),r.val(0),r.prop("disabled",!0),m("#StayTime"+e).prop("disabled",!0))),e=m("#trackTbl").find("tr").length)}for(;e<9;e++)this.createRow("trackTbl",e,f,null)},createRow:function(t,e,a,i){var n=document.getElementById(t),r=document.createElement("tr"),o=this;m(r).attr("id",t+e);for(var l=0,d=a.length;l<d;l++){var c=document.createElement("td"),s=a[l].split(":"),u=s[0].trim(),p=s[1];m(c).attr("id",u+e+"TD");var h=null==i?"":i[u],v=document.createElement("label");m(v).attr("id",u+e+"Label"),m(v).html(""),m(v).addClass("hidden"),m(c).append(v);s=null;"text"==p||"checkbox"==p?(s=document.createElement("input"),m(s).attr("type",p),"text"==p?(m(s).addClass("shortText"),m(c).bind("click",function(){var t=this.id.replace("TD","");o.onclickTDContent(t,!0)}),m(s).attr("minValue",1),"Duration"==u?(m(s).attr("maxLength",6),m(s).attr("maxValue",3e5)):(m(s).attr("maxLength",7),m(s).attr("maxValue",18e5)),m(s).bind("blur",function(){"Duration"+e==this.id&&770==m("#Action"+e).val()?Utils.validPic_Num(this,parseInt(m(this).attr("minValue")),parseInt(m(this).attr("maxValue")),!0)?(this.value=Number(this.value).toFixed(2),this.defaultValue=this.value):this.value=this.defaultValue:Utils.validNumber(this,parseInt(m(this).attr("minValue")),parseInt(m(this).attr("maxValue")),m.lang.tip.tipNumScopeErr.replace("%s",m(this).attr("minValue")+"-"+m(this).attr("maxValue")))?this.defaultValue=this.value:this.value=this.defaultValue})):"checkbox"==p&&"IsTurning"==u&&m(s).bind("click",function(){var t=this.id.replace("IsTurning",""),e=m("#Duration"+t);e.val(this.checked?0:1e4),e.prop("disabled",this.checked),m("#StayTime"+t).prop("disabled",this.checked)})):"select"==p&&(s=document.createElement("select"),v="","Action"==u?(m(s).change(function(){o.action_change(this.id)}),v="<option value='1284'>"+m.lang.pub.gotoLeft+"</option><option value='1282'>"+m.lang.pub.gotoRight+"</option><option value='1026'>"+m.lang.pub.gotoUp+"</option><option value='1028'>"+m.lang.pub.gotoDown+"</option><option value='1794'>"+m.lang.pub.gotoLeftUp+"</option><option value='2050'>"+m.lang.pub.gotoRrightUp+"</option><option value='1796'>"+m.lang.pub.gotoLeftDown+"</option><option value='2052'>"+m.lang.pub.gotoRightDown+"</option><option value='770'>"+m.lang.pub.changeZoom+"</option><option value='1538'>"+m.lang.pub.gotoPreset+"</option>"):"Speed"==u?v="<option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6' selected>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option>":"PresetId"==u&&(v=m("#rootPreset").html()),m(s).append(v)),m(s).attr("id",u+e),null==i&&m(s).addClass("hidden"),m(c).append(s),m(r).append(c),null!=i&&"undefined"!=typeof i.Action&&("checkbox"==p?"IsTurning"==u&&0==i.Duration&&m(s).prop("checked",!0):("Action"==u?1538==h&&m(s).find("option[value='0']").val(h):"Duration"==u&&0==h&&m(s).prop("disabled",!0),m(s).val(h),m(s).attr("defaultValue",h)))}m(n).append(r)},onclickTDContent:function(){},numTipCreate:function(){for(var t,e,a=m("#trackTbl").find("tr"),i=a.length,n=0,r=0;r<i&&(t=a.get(r).id.replace("trackTbl",""),e=m("#Action"+t).val(),!m("#IsSelect"+t).is(":hidden"));r++)1538==e?n++:n+=2;var o=m.lang.pub.NumInfo.replace("*",n);m("#NumInfo").empty(),m("#NumInfo").html(o),l=64-n},addAction:function(){for(var t,e=m("#trackTbl").find("tr"),a=e.length,i=0,n=0;n<a&&(i=e.get(n).id.replace("trackTbl",""),!m("#IsSelect"+i).is(":hidden"));n++);l<1?alert(m.lang.tip.tipTrackPointFull):(8<n&&this.createRow("trackTbl",++i,f,{}),m("#IsSelect"+i).removeClass("hidden"),(t=m("#Action"+i)).removeClass("hidden"),l<2&&t.val(1538),t.change())},delAction:function(){for(var t=m("#trackTbl").find("tr"),e=t.length-1;-1<e;e--){var a=t.get(e).id.replace("trackTbl","");m("#IsSelect"+a).is(":checked")&&(m("#trackTbl"+a).remove(),(a=m("#trackTbl").find("tr")).length<9&&(a=a.last().attr("id").replace("trackTbl",""),this.createRow("trackTbl",parseInt(a)+1,f,null)))}this.numTipCreate()},moveAction:function(t){var e=m("#trackTbl").find("tr"),a=e.length;if(0!=a){for(var i=[],n=[],r=0;r<a;r++){var o,l=(o=e.get(r)).id.replace("trackTbl",""),d=m("#IsSelect"+l);if(d.is(":hidden"))break;(d.is(":checked")?i:n).push(o)}var c=m(i),s=m(n);0!=c.length&&0!=s.length&&(0==t?c.insertBefore(s.first()):1==t?(o=m(i).first(),o=m(o).prev()?m(o).prev():s.first(),c.insertBefore(o)):2==t?(o=m(i).last(),o=m(o).next()?(l=m(o).next().attr("id").replace("trackTbl",""),m("#IsSelect"+l).is(":visible")?m(o).next():s.last()):s.last(),c.insertAfter(o)):3==t&&c.insertAfter(s.last()),this.numTipCreate())}},action_change:function(t){var e=t.replace("Action",""),a=m("#"+t).val(),i=m("#Duration"+e),n=m("#IsTurning"+e),r=m("#StayTime"+e),o=m("#Speed"+e),l=m("#PresetId"+e),t=m("#Speed"+e+" option[value='10']");1538==a?(n.is(":checked")&&(n.prop("checked",!1),i.prop("disabled",!1),r.prop("disabled",!1)),0==t.length&&o.append("<option value='10' selected='selected'>10</option>"),o.removeClass("hidden"),m("#Speed"+e+"Label").addClass("hidden"),n.addClass("hidden"),m("#IsTurning"+e+"Label").removeClass("hidden"),i.addClass("hidden"),m("#Duration"+e+"Label").removeClass("hidden"),l.removeClass("hidden"),m("#PresetId"+e+"Label").addClass("hidden")):(770==a?(o.addClass("hidden"),m("#Speed"+e+"Label").removeClass("hidden"),n.addClass("hidden"),m("#IsTurning"+e+"Label").removeClass("hidden")):(0<t.length&&t.remove(),o.removeClass("hidden"),m("#Speed"+e+"Label").addClass("hidden"),n.removeClass("hidden"),m("#IsTurning"+e+"Label").addClass("hidden"),""==i.val()&&(i.val(1e4),i.attr("defaultValue",1e4))),i.removeClass("hidden"),m("#Duration"+e+"Label").addClass("hidden"),l.addClass("hidden"),m("#PresetId"+e+"Label").removeClass("hidden")),770==a?(Number(i.val())>Number(Capinfo.maxZoom)&&i.val(Capinfo.maxZoom),i.attr("maxValue",Capinfo.maxZoom),i.attr("defaultValue",Capinfo.maxZoom),i.attr("maxLength",Capinfo.maxZoom.toString().length+3)):(parseInt(i.val())!=i.val()&&i.val(1e4),i.attr("defaultValue",1e4),i.attr("maxLength",6),i.attr("maxValue",3e5)),""==r.val()&&(r.val(1e4),r.attr("defaultValue",1e4)),r.removeClass("hidden"),m("#StayTime"+e+"Label").addClass("hidden"),this.numTipCreate()},initValidator:function(){m("#TrackId").attr("tip",m.validator.format(m.lang.tip.tipIntRange,1,16)),m("#TrackName").attr("tip",m.lang.tip.tipName),m.validator.addMethod("validStrNoNull",function(t){return Utils.validStrNoNull(t)},m.lang.validate.valRequired),m.validator.addMethod("checkName",function(t){return Utils.validNameContent(t)},m.lang.tip.tipCharFmtErr),validator=m("#frmSetupCruiseEdit").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(t,e){Utils.showJqueryErr(t,e,"td","cruise_edit_div")},success:function(t){},rules:{TrackName:{validStrNoNull:"",checkName:""},TrackId:{integer:!0,required:!0,range:[1,16]}}}),validator.init()}}))}(jQuery),Frame.openWinNameSpace=cruiseEdit;