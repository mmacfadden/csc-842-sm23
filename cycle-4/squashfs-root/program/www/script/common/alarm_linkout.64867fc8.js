Utils.$package("alarmLinkout"),alarmLinkout=function(c){var o=1,l={},d={LinkOutPreset:0,LinkOutCapture:0,LinkOutUSBStor:0,LinkOutFTP:0,LinkOutEmail:0},A={};return new(Class.extend({init:function(){this.initPage()},initPage:function(){var t=Capinfo.switchOutArr.length,e=c("#linkOutIFrame");if(0!=t){var i=c("#switchOutTR");i.removeClass("hidden");for(var a=0;a<t;a++){var n=parseInt(Capinfo.switchOutArr[a]);i.append("<input name='LinkOutSwitch"+n+"' id='LinkOutSwitch"+n+"' type='checkbox' value='1'/>\n<label for='LinkOutSwitch"+n+"'><lang name='switchOutName"+(n+1)+"'></lang></label>")}}Capinfo.isSupportPTZ&&c("#presetTR").removeClass("hidden"),Capinfo.updateSwitchOutFn(document),Capinfo.isSupportBasicFTP&&c("#ftpTR").removeClass("hidden"),Capinfo.isSupportEmail&&c("#emailTR").removeClass("hidden"),Capinfo.isSupportStorage&&c("#storTR").removeClass("hidden"),0==e.find("li:visible").length&&e.addClass("hidden")},initData:function(t){var e=document.frmSetup;l={},d={LinkOutPreset:0,LinkOutCapture:0,LinkOutUSBStor:0,LinkOutFTP:0,LinkOutEmail:0};for(var i=o,a=0;a<i;a++)d["LinkOutSwitch"+a]=0;if(!Utils.LAPI_GetCfgData(t,l))return Utils.disableAll(),!1;var n=l.ActNum,r=l.AlarmActCfg;for(a=0;a<n;a++){var u=r[a],m=u.AlarmParam,s=u.ActID;switch(Number(u.ActCmd)){case AlarmActCommand.PRESET:d.LinkOutPreset=1,d.PresetNum=m,c("#LinkOutPreset").attr("actId",s);break;case AlarmActCommand.OUTSWITCH:d["LinkOutSwitch"+m]=1,c("#LinkOutSwitch"+m).attr("actId",s);break;case AlarmActCommand.CAPTURE:d.LinkOutCapture=1,c("#LinkOutCapture").attr("actId",s);break;case AlarmActCommand.CAPTURE2FTP:d.LinkOutFTP=1,c("#LinkOutFTP").attr("actId",s);break;case AlarmActCommand.CAPTURE2EMAIL:d.LinkOutEmail=1,c("#LinkOutEmail").attr("actId",s);break;case AlarmActCommand.START_USBSTOR:d.LinkOutUSBStor=1,c("#LinkOutUSBStor").attr("actId",s)}}return A=Utils.objectClone(d),this.makePresetList(),Utils.cfgToForm(d,"frmSetup"),Utils.setComboxTitle("PresetNum"),this.initPreset(e),!0},initEvent:function(){},submitF:function(t){var e;return this.setLinkOutValueToMap(),(e=(e=Utils.LAPI_SetCfgData(t,l,!1))&&(LAPI_URL.HighTemperatureDetectLink==t?Utils.LAPI_SetCfgData(LAPI_URL.LowTemperatureDetectLink,l,!1):e))&&(A=Utils.objectClone(d)),Frame.showMsg(e),e},release:function(){},setLinkOutValueToMap:function(){var t,e=0;for(t in l.AlarmActCfg=[],d){var i,a,n,r=c("#"+t);r.is(":checked")&&(i={},n=a=-1,r=r.attr("actId"),e++,-1<t.indexOf("Preset")?(a=AlarmActCommand.PRESET,n=c("#PresetNum").val()):-1<t.indexOf("Switch")?(a=AlarmActCommand.OUTSWITCH,n=t.replace("LinkOutSwitch","")):-1<t.indexOf("Capture")?a=AlarmActCommand.CAPTURE:-1<t.indexOf("FTP")?a=AlarmActCommand.CAPTURE2FTP:-1<t.indexOf("Email")?a=AlarmActCommand.CAPTURE2EMAIL:-1<t.indexOf("USBStor")&&(a=AlarmActCommand.START_USBSTOR),-1!=a&&(i.ActCmd=a,undefined==r&&(r=a),i.ActID=r),-1!=n&&(i.AlarmParam=n),l.AlarmActCfg.push(i))}l.ActNum=e},makePresetList:function(){var t=document.frmSetup,e=c("#video").find("#position").html(),i=c("#PresetNum");Capinfo.isSupportPTZ&&(i.empty(),i.append(e),i.find("option:first").remove(),0==t.PresetNum.length&&(t.LinkOutPreset.disabled=!0))},initPreset:function(t){1==t.LinkOutPreset.checked&&0==t.PresetNum.length&&(t.LinkOutPreset.checked=!1),t.PresetNum.disabled=!t.LinkOutPreset.checked},IsChanged:function(){return c("#LinkOutPreset").is(":checked")&&(d.PresetNum=c("#PresetNum").val()),Utils.LAPI_FormToCfg("frmSetup",d),!Utils.isObjectEquals(d,A)}}))}(jQuery);