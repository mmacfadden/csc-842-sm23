Config.storage_status=function(f){var h=0,t={},r=!0,S=null,m="",a="",g=LAPI_URL.PictureInfo+"?Name=",P=LAPI_URL.SDPictureInfo+"?Name=",d=!1,p=!1,i={},o={PicAllocMem:["PhotoStorage","AllocMemory"],PicSpareMemory:["PhotoStorage","SpareMemory"],ComPicAllocMem:["IPCPhotoStorage","AllocMemory"],ComPicSpareMemory:["IPCPhotoStorage","SpareMemory"]},u=LAPI_URL.Photo_DirectoryInfo,v=0===Capinfo.ProductType||10===Capinfo.ProductType||11===Capinfo.ProductType;return new(Class.extend({init:function(){Utils.beforeDataLoad(),Utils.initLang(),this.initPage(),this.initEvent(),this.initData(),setTimeout(this.resetVideoWH,50),Utils.afterDataLoad()},initPage:function(){top.document.title=f.lang.pub.photo;var e=document.getElementById("object"),t=e.offsetWidth,i=e.offsetHeight,o={x:0,y:0};Utils.GetOffset(e,o),Frame.showVideo(t,i,o.y,o.x),top.sdk_viewer&&top.sdk_viewer.isInstalled?(Video.NetSDKSetWndPos(top,2),Video.NetSDKGetLocalPort(top,4),Video.NetSDKStartPlayLocalJPG(top,4)):(f("#exportRecord").prop({disabled:!0,title:f.lang.tip.tipInstallPluginBtn}),f("#export").prop({disabled:!0,title:f.lang.tip.tipInstallPluginBtn}),f("#exportAndDel").prop({disabled:!0,title:f.lang.tip.tipInstallPluginBtn}))},initData:function(){var e;window.onresize=this.resetVideoWH,Utils.LAPI_GetCfgData(LAPI_URL.Storage,i)?(Utils.changeMapToMapByMapping(i,o,t,0),Utils.cfgToForm(t,"frmSetup"),Utils.setLabelValue(t),this.initTree(),top.sdk_viewer&&top.sdk_viewer.isInstalled&&(retcode=Video.NetSDKGetConfig(top),0==retcode.code&&(e=f.parseJSON(retcode.result),a=e.DefaultPath+"tmpPhoto\\tmpPhoto.jpg"))):Utils.disableAll()},initEvent:function(){var e=this;f("#submitBtn").bind("click",function(){f("#nav_photo").click()}),f("button[data-cmd]").bind("click",function(){e.operSDFile()})},submitF:function(){},release:function(){window.onresize=null,r=!1,top.sdk_viewer&&top.sdk_viewer.isInstalled&&Video.NetSDKStopPlayLocalJPG(top,wndIdNum.SDWND),Frame.hiddenVideo(),delete Config.storage_status},getAllFileOfFolder:function(e,t){var i,o,r,a,n,l,s,d=1,p=0,e=(Frame.sortType,"object"==typeof e?e.SubPath:e);if(-1!=e.indexOf("SmartServer")){if(s="SmartServer",e=e.substring(12),!l)return!1}else-1!=e.indexOf("CommonServer")?(l=LAPI_URL.SDPhoto_DirectoryInfo,s="CommonServer",e=e.substring(13)):l=u.replace("ID",0);l=l+"?Name="+e+"&index=";do{if(i={},!Utils.LAPI_GetCfgData(l+d,i))return!1;for(o=(n=i.StorDirInfoList).length,0==p&&(r=Math.ceil(i.Nums/o)),a=0;a<o;a++)s&&(n[a].SubPath=s+"/"+n[a].SubPath),t.push(n[a])}while(d+=o,++p<r);return!0},nodeFilter:function(e){e=e.getCheckStatus();return e.checked&&!e.half},getAllLeafNode:function(e,t){var i,o,r,a=[],n=this.getAllFileOfFolder(e,a);if(n)for(i=0,o=a.length;i<o&&n;i++)0==(r=a[i]).DirType&&(n=this.getAllLeafNode(r.SubPath,t)),t.push(r);return n},freshInfo:function(){var e=S.getSelectedNodes();0<e.length&&(S.expandNode(e[0],!1),S.removeChildNodes(e[0]),p=!0,S.expandNode(e[0],!0,!1,!0,!0))},callBack:function(e){h=e},operSDFileThreed:function(u,c){return function(){for(var e,t,i,o=u.length,r=!0,a=!1,n=[],l={},s=o-1;0<=s&&r;s--)p=(l=Utils.objectClone(u[s])).SubPath,2==l.pid&&0==p.indexOf("Server")&&(p="SmartServer/"+p),l.isParent&&-1==l.check_Child_State&&(r=Config.storage_status.getAllLeafNode(p,n)),n.push(l);if(r)for(s=0,o=n.length;s<o;s++){var d,p=(l=n[s]).SubPath;if(""!=p)if(-1!=p.indexOf("SmartServer")?(FirstPath="SmartServer",p=p.substring(12),t=g,i=LAPI_URL.PictureInfo):-1!=p.indexOf("CommonServer")?(t=P,i=LAPI_URL.SDPictureInfo,p=p.substring(13),FirstPath="CommonServer"):(t=g,i=LAPI_URL.PictureInfo,-1==p.indexOf("/")?p="":FirstPath=""),0<(4&c)&&(path=m+FirstPath,t+=p,1==l.DirType&&(d=p.substring(0,p.lastIndexOf("/")+1),Capinfo.isMac?path+="/"+d:path+="\\"+d.replace(/\//g,"\\"),(r=Utils.downloadFile(t,path,0,!0,0))&&(a=!0))),r&&0<(1&c)&&(t+=p,path=m+FirstPath,1==l.DirType&&(Capinfo.isMac?path+="/"+p+".jpg":path+="\\"+p.replace(/\//g,"\\")+".jpg",(r=Utils.downloadFile(t,path,1,!0,0))&&(a=!0))),r&&(0<(5&c)&&a||0==(5&c))&&0<(2&c)&&(r=Utils.LAPI_DelCfgData(encodeURI(i+"?Name="+p+p),{},!1,Config.storage_status.callBack),29==h&&(r=!0),v&&(p=FirstPath+"/"+p),r&&S.getNodeByParam("SubPath",p,null)&&S.removeNode(n[s])),!r)break}0<(5&c)&&Frame.updateBlock(!1),e=r&&(0<(5&c)&&a||0==(5&c))?f.lang.tip.tipOperateSuccess:f.lang.tip.tipOperateFail,Frame.showMsg(r&&(0<(5&c)&&a||0==(5&c)),e)}},operSDFile:function(){var e,t,i=Utils.getEvent(),o=i.srcElement||i.target,i=Number(f(o).attr("data-cmd")),o=S.getNodesByFilter(this.nodeFilter);if(0!=o.length&&(!(0<(2&i))||confirm(f.lang.tip.tipConfirmDel))){if(0<(5&i)){if(Video.sdk_viewer&&Video.sdk_viewer.isInstalled&&(e=(t=Video.NetSDKBrowseDir(top)).code,t=t.result),ResultCode.RESULT_CODE_SUCCEED!=e||""==t)return;m=Capinfo.isMac?t+"photo("+Frame.loginServerIp+")/":t+"photo("+Frame.loginServerIp+")\\",Frame.updateBlock(!0,f.lang.tip.tipExportPhotos)}setTimeout(this.operSDFileThreed(o,i),100)}},initTree:function(){var e={check:{enable:!0},data:{keep:{parent:!0},key:{name:"nameText"},simpleData:{enable:!0,idKey:"id",pIdKey:"pid",rootPId:0}},view:{selectedMulti:!1,autoCancelSelected:!1,expandSpeed:""},callback:{beforeExpand:this.beforeExpand,onExpand:this.getData,onClick:this.onNodeClick}},t=v?0===Capinfo.ProductType?[{SubPath:"",id:1,pid:0,nameText:Frame.loginServerIp},{SubPath:"CommonServer",id:3,pid:1,nameText:"CommonServer",isParent:!0}]:[{SubPath:"",id:1,pid:0,nameText:Frame.loginServerIp},{SubPath:"SmartServer",id:2,pid:1,nameText:"SmartServer",isParent:!0},{SubPath:"CommonServer",id:3,pid:1,nameText:"CommonServer",isParent:!0}]:[{SubPath:"",id:1,pid:0,nameText:Frame.loginServerIp,isParent:!0}];S=f.fn.zTree.init(f("#tree"),e,t)},beforeExpand:function(e,t){return d?(Frame.showMsg(!0,f.lang.tip.tipLoading,0),!1):(S.updateNode(t),!0)},getData:function(e,t,i){var o,r,a,n=i.SubPath,l=i.getCheckStatus().checked,s=[];if(2==i.pid&&0==n.indexOf("Server")&&(i.SubPath="SmartServer/"+n),p||-1==i.check_Child_State){if(p=!1,!Config.storage_status.getAllFileOfFolder(n,s))return;for(a=s.length,r=0;r<a;r++)o=s[r],""!=n||"photo"==o.SubPath||"epphoto"==o.SubPath?(0==o.DirType&&(o.isParent=!0),o.pId=n,o.nameText=o.SubPath.substring(o.SubPath.lastIndexOf("/")+1),o.checked=l):(s.splice(r,1),a=s.length,r--);S.removeChildNodes(i),S.addNodes(i,s)}i.icon="",S.updateNode(i),d=!1},getFileProcessResult:function(){1==Video.FileProcessResult?Video.NetSDKPlayLocalPic(top,4,a,""):2==Video.FileProcessResult||setTimeout(function(){Config.storage_status.getFileProcessResult()},300)},onNodeClick:function(e,t,i){Video.FileProcessResult=0;var o=i.SubPath,r="";i.isParent||(-1!=o.indexOf("SmartServer")?(r=g.replace("ID",ServerValue-1)+o,r=g,FirstPath="SmartServer",r+=o=o.substring(12)):-1!=o.indexOf("CommonServer")?(r=P,FirstPath="CommonServer",r+=o=o.substring(13)):(r=g,r+=o),top.sdk_viewer.execFunctionReturnAll("NetSDKDownloadFile",Frame.loginServerIp,Number(Frame.httpPort),Frame.loginUserName,Frame.loginUserPwd,Frame.auzType,r,a,1,1),Config.storage_status.getFileProcessResult())},resetVideoWH:function(){var e,t,i,o=f("#object");r&&(t=o.width(),i=o.height(),e=o.offset().top,o=o.offset().left,f("#videoDiv").css({top:e+"px",width:t+"px",height:i+"px",left:o+"px"}))}}))}(jQuery),Frame.currentNameSpace=Config.storage_status;