Utils.$package("cruise.829ec514"),cruise=function(c){var i=-1,r=-1,d=[],p={},f={};return new(Class.extend({currentCruiseOperate:0,trackInfoMap:{},currentTrackId:1,currentTrackName:"",init:function(){},initPage:function(){},initData:function(){},initEvent:function(){},submitF:function(){},release:function(){},onCruiseStatus:function(t){var a=Number(t.PTZStatus.Status),e=Number(t.PTZStatus.Param1);PTZ_STATE_CRUISE.IDLE==a||PTZ_STATE_CRUISE.IVA_PLAN==a||PTZ_STATE_CRUISE.ECOMPASS_START==a?((t=c("#ptzCruiseBody").find("button.stop")).prop("title",c.lang.pub.start),t.removeClass("stop").addClass("start"),(r=-1)!=i&&(Video.resetCombox(),this.getTrackInfo(),this.recodeBlock(!1),i=-1,this.initCruiseInfo()),PTZ_STATE_CRUISE.ECOMPASS_START==a?Frame.updateBlock(!0,c.lang.tip.tipOrienting):PTZ_STATE_CRUISE.IDLE==a&&Frame.updateBlock(!1)):PTZ_STATE_CRUISE.TRACK_RECORD==a?(c("#cruiseTab").trigger("click"),i=e,this.recodeBlock(!0)):PTZ_STATE_CRUISE.MANUAL_CRUISE==a&&(r=e,(e=c("#ptzCruiseBody").find("div[data-id='"+r+"'] button.start")).prop("title",c.lang.pub.stop),e.removeClass("start").addClass("stop"))},initCruiseInfo:function(){var t={};this.getTrackInfo(),this.initTrackTable("ptzCruiseBody"),Utils.LAPI_GetCfgData(LAPI_URL.PTZStatus,t)&&7==t.StatusID&&this.onCruiseStatus(t.StatusParam)},editCruise:function(t){this.currentCruiseOperate=1,this.currentTrackId=Number(c(t).parents("div.ptz-acc-item").attr("data-id")),this.currentTrackName=c(t).parents("div.ptz-acc-item").children("span.ptz-acc-span").attr("title"),Utils.openWin(c.lang.pub.modify,"/page/common/cruise_edit.262bbffa.htm?id=cruise_edit",750,500,!1,"40%","25%",!0,"body")},removeCruise:function(t){var a=Number(c(t).parents("div.ptz-acc-item").attr("data-id"));if(confirm(c.lang.tip.tipConfirmDel)&&(a==r?(a-=1,Utils.LAPI_SetCfgData(LAPI_URL.PTZStopPatrolRoute.replace("id",a),{},!1)):a-=1,Utils.LAPI_DelCfgData(LAPI_URL.PTZPatrolRoute+"/"+a,{},!1,this.patrolCallback))){a+=1,c(t).parents("div.ptz-acc-item").remove();for(var e=1,i=d.length+1;e<i;e++)if(d[e]&&a==d[e].id){d.splice(e,1);break}}},removeTrack:function(t){var a=Number(c(t).parents("div.ptz-acc-item").attr("data-id"));if(confirm(c.lang.tip.tipConfirmDel)&&(a==r?(a-=1,Utils.LAPI_SetCfgData(LAPI_URL.PTZStopRecordRoute.replace("id",a),{},!1)):a-=1,Utils.LAPI_DelCfgData(LAPI_URL.PTZRoutePatrol+"/"+a,{},!1,this.patrolCallback))){a+=1,c(t).parents("div.ptz-acc-item").remove();for(var e=1,i=d.length+1;e<i;e++)if(d[e]&&a==d[e].id){d.splice(e,1);break}}},patrolCallback:function(t){4970==t&&alert(c.lang.tip.tipTrackBeUsed)},onClickCruise:function(t){var a=Number(c(t).parents("div.ptz-acc-item").attr("data-id")),t=r!=a;-1!=r&&Utils.LAPI_SetCfgData(LAPI_URL.PTZStopPatrolRoute.replace("id",r-1),{},!1),t&&(top.ivaEnable?alert(c.lang.tip.tipStopCruiseFirst):Utils.LAPI_SetCfgData(LAPI_URL.PTZStartPatrolRoute.replace("id",a-1),{},!1))},onClickTrack:function(t){var a=Number(c(t).parents("div.ptz-acc-item").attr("data-id")),t=r!=a;-1!=r&&Utils.LAPI_SetCfgData(LAPI_URL.PTZStopRecordRoute.replace("id",r-1),{},!1),t&&(top.ivaEnable?alert(c.lang.tip.tipStopCruiseFirst):Utils.LAPI_SetCfgData(LAPI_URL.PTZStartRecordRoute.replace("id",a-1),{},!1))},getTrackInfo:function(){var t,a={};if(Utils.LAPI_GetCfgData(LAPI_URL.PTZPatrol,p)&&Utils.LAPI_GetCfgData(LAPI_URL.PTZRoutePatrol,f)){for(var e=0;e<p.Num;e++){a["Track"+(e+1)+"CruiseNum"]=p.PatrolInfos[e].Num,a["Track"+(e+1)+"TrackId"]=p.PatrolInfos[e].ID+1,a["Track"+(e+1)+"TrackName"]=p.PatrolInfos[e].Name;for(var i=0;i<p.PatrolInfos[e].Num;i++)a["Track"+(e+1)+"Action"+(i+1)]=p.PatrolInfos[e].Actions[i].Type,a["Track"+(e+1)+"Duration"+(i+1)]=0==p.PatrolInfos[e].Actions[i].Duration?p.PatrolInfos[e].Actions[i].Para3:p.PatrolInfos[e].Actions[i].Duration,a["Track"+(e+1)+"Speed"+(i+1)]=0==p.PatrolInfos[e].Actions[i].Para1?p.PatrolInfos[e].Actions[i].Para2:p.PatrolInfos[e].Actions[i].Para1,a["Track"+(e+1)+"PresetId"+(i+1)]=p.PatrolInfos[e].Actions[i].PresetID}for(d=[],this.trackInfoMap={},t=1;"undefined"!=typeof a["Track"+t+"TrackId"];t++){var r="Track"+t,o=a[r+"TrackId"],s={};s.id=o,s.name=a[r+"TrackName"],s.type=0,d[o]=s;for(var c=[],n=1;n<=a[r+"CruiseNum"];n++){var l={};l.PresetId=a[r+"PresetId"+n],l.Action=a[r+"Action"+n],l.StayTime=a[r+"Duration"+n],l.Duration=a[r+"Duration"+n],772==l.Action&&(l.Action=770),770==l.Action&&(l.Duration=a[r+"Duration"+n]/100),l.Speed=a[r+"Speed"+n],c.push(l)}this.trackInfoMap[o]=c}for(t=0;t<f.Num;t++){var u=f.RecordedPatrolInfos[t].ID+1;(s={}).id=u,s.type=1,d[u]=s}}},recodeBlock:function(t){t?(Frame.blockDiv(!0),c("#blockDiv4").css("display","block"),c("#blockDiv_1").css("display","block"),c("#record").removeClass("record-start").addClass("stop")):(Frame.blockDiv(!1),c("#blockDiv4").css("display","none"),c("#blockDiv_1").css("display","none"),c("#record").removeClass("stop").addClass("record-start"))},recordTrack:function(){var t,a;if(-1!=i)Utils.LAPI_SetCfgData(LAPI_URL.PTZStopPatrolRouteRecord.replace("id",i-1),{},!1);else{for(i=1,a=d.length+(t=1);t<a;t++)d[t]&&i==d[t].id&&i++;if(16<i)return i=-1,alert(c.lang.tip.tipTrackFull),!1;Utils.LAPI_SetCfgData(LAPI_URL.PTZStartPatrolRouteRecord.replace("id",i-1),{},!1)}return 0==ResultCode.RESULT_CODE_SUCCEED},initTrackTable:function(t){var a,e,i=d.length+1,r=1,o="",s=c("#"+t);for(s.empty();r<i;r++)(a=d[r])&&(e=d[r].type,this.trackInfoMap[a.id],0==e?(o="<div class='ptz-acc-item' data-id='"+a.id+"'><div class='mid_right'><button class='icon start' hidefocus='true' onclick='cruise.onClickCruise(this)' title='"+c.lang.pub.start+"'></button>",UserType.Administrator==top.userType&&(o+="<button class='icon black-edit' hidefocus='true' onclick='cruise.editCruise(this)' title='"+c.lang.pub.modify+"'></button><button class='icon black-del' hidefocus='true' onclick='cruise.removeCruise(this)' title='"+c.lang.pub["delete"]+"'></button>"),o+="</div><span class='ptz-acc-desc'>"+a.id+"</span><span class='ptz-acc-span' title='"+a.name+"'>["+a.name+"]</span></div>"):(o="<div class='ptz-acc-item' data-id='"+a.id+"'><div class='mid_right'><button class='icon start' hidefocus='true' onclick='cruise.onClickTrack(this)' title='"+c.lang.pub.start+"'></button>",UserType.Administrator==top.userType&&(o+="<button class='icon black-del' hidefocus='true' onclick='cruise.removeTrack(this)' title='"+c.lang.pub["delete"]+"'></button>"),o+="</div><span class='ptz-acc-desc'>"+a.id+"</span><span class='ptz-acc-span' title='"+c.lang.pub.modeRoute+"'>["+c.lang.pub.modeRoute+"]</span></div>"),s.append(o))}}))}(jQuery);