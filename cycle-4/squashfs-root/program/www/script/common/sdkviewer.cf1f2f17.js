Utils.$package("Video"),Video=function(h){var u,c,d=null,a=!1,t=!0,o=!1,e=0,s=null,i=!0,n=!1,r=!1,l=["Width","Height","FrameRate","ID","Enabled","EncodeFormat","BitRate","GOPType","IFrameInterval","BitRateType","ImageQuality","SmoothLevel","SVCMode","SmartEncodeMode"],S=null,p=null,m=0,v=0,f=!1,D=null;top.isGunBallLinkMarkPage=0;var P={__10:function(e,t,i){Video.dealGetWndId(Number(e),Number(t),i)},__3:function(e,t){Video.dealPlayerRecordVideo(e,t)},__6:function(e,t){Video.dealPlayerMediaVioce(e,t)},__12:function(e,t){Video.dealFileDownload(e,t)},__13:function(e,t){Video.dealFileUpload(e,t)},__8:function(e,t,i){Video.dealPlayerCodeProcess(e,Number(t),Number(i))},__106:function(e){Video.dealEvent3DPosition(e)},__110:function(e,t){Video.EventStatusReport(e,t)},__111:function(e,t){Video.dealEventSelDrawObj(Number(e),Number(t))},__112:function(e,t,i){Video.dealEventDrawObjParam(Number(e),Number(t),i)},__113:function(e){Video.dealeventAreaFoucs(e)},__115:function(e,t){Video.dealCarReport(e,t)},__116:function(e,t,i){Video.drawButtonLink(e,t,i)}};return new(Class.extend({canvas:null,videoPosStartX:0,videoPosStartY:0,videoPosEndX:0,videoPosEndY:0,digitalAreaPos:{left:0,top:0,right:1e4,bottom:1e4},sdk_viewer:null,currentWndID:0,varRotateSpeed:6,cur_scale:0,videoWidth:0,videoHeight:0,frameWidth:0,frameHeight:0,isSleepReplay:!1,isVoiceTalkOpen:!1,isCaptureOpen:!1,isCapRecEnabled:!1,isVoiceMute:!0,isMicMute:!1,isLock:!0,isAutoFocus:!1,isAreaFocus:!1,isDigitalZoom:!1,isManualSnap:!1,isOpticsZoom:!1,isFullScreen:!1,isShowPtz:!1,isLiveReplay:!0,isIVAStreamOpen:!0,streamNum:Capinfo.maxStreamNum,StreamInfoChangeList:[],statusMap:{isVideoOpen:!1,bRecEnabled:!1,streamID:0},statusList:[],FileProcessResult:0,GunBallLink3DEnable:!1,init:function(){},init2:function(){Utils.beforeDataLoad(),Utils.initLang(),this.initPage(),this.initEvent(),this.initData()},initPage:function(){var e=h("#ptz");"undefined"==typeof Capinfo.isMac&&(Capinfo.isMac=Utils.isMacPlatform()),h("#ieVersion").attr("title",h.lang.pub.hiddenTips),h("#download").attr("title",h.lang.pub.downloadSetup),LoginType.VM_LOGIN!=Frame.loginType&&(h("#addPreset").removeClass("hidden"),h("#removePreset").removeClass("hidden")),h("#warningImg2").attr("src",warningSrc[Capinfo.skinType]),e.attr("src",ptzSrc[Capinfo.skinType]),SkinStyle.Black==top.style&&e.attr("src","/skin/black/images/ptz_black.f7f9513b.png")},initData:function(){this.statusList[0]=Utils.objectClone(this.statusMap),Utils.delCookie("Authorization")},initEvent:function(){var t=this;this.bindPtzDerectEvent(PtzDerectMap),this.bindPtzLensEvent(PtzLensMap),this.bindManualBackFocusNear(),this.bindManualBackFocusFar(),Capinfo.isNoPlugin&&document.addEventListener("visibilitychange",function(e){"hidden"===e.target.visibilityState||(t.stopVideo(),t.startVideo())},!1),h("#ieVersion").bind("dblclick",function(){h("#ieVersion").slideUp(0)}),h("#download").bind("click",this.checkInstallStatus),h("#autobackfocusStart").bind("click",this.startAutoBackFocus),h("#autobackfocusPosition").bind("click",this.restoreABFPosition),h("#centerBtn").click(function(){Utils.submitCtrolCmd(PtzTurnAroundVal[e++%4],Video.varRotateSpeed,Video.varRotateSpeed)}),h("#gotoPreset").bind("click",function(){t.callPreset(h("#position").val())}),h("#addPreset").bind("click",function(){Utils.openWin(h.lang.pub.cruisePresetPosAdd,"/page/common/preset_edit.801a4356.htm",400,195,!1,"25%","50%",!0,"body")}),h("#removePreset").bind("click",function(){t.delPreset(h("#position").val())}),h("#ptzExtend").find("button").bind("click",function(){Utils.submitCtrolCmd(Number(h(this).attr("data-cmd")))}),h("#gotoScenePreset").bind("click",function(){Frame.currentNameSpace.gotoCruisePreset()}),h("#addScenePreset").bind("click",function(){Frame.currentNameSpace.setCruisePreset()}),h("#BeginMark").bind("click",function(){Config.iva_gunBallLinkMark.configMark()}),h("#RESET").bind("click",function(){Config.iva_gunBallLinkMark.resetMark()}),h("#Confirm").bind("click",function(){Config.iva_gunBallLinkMark.saveGunMark()}),h("#FinishMark").bind("click",function(){Config.iva_gunBallLinkMark.setMark()}),h("#EnLarge").bind("click",function(){Config.iva_gunBallLinkMark.enlarge()}),h("#ManualTrack").bind("click",function(){Config.iva_gunBallLinkMark.manualtrack()}),h("#ClickLinkage").bind("click",function(){Config.iva_gunBallLinkMark.clicklinkage()}),this.initSlider()},release:function(){},dealeventAreaFoucs:function(e){Frame.currentNameSpace.eventAreaFoucs&&Frame.currentNameSpace.eventAreaFoucs(e)},dealEvent3DPosition:function(e){Frame.currentNameSpace.event3DPosition&&Frame.currentNameSpace.event3DPosition(e)},dealGetWndId:function(e,t,i){var a=i.split(","),o=document.getElementById("btn_digitalZoom"),s=Number(a[0]),i=Number(a[1]),a=this.NetSDKGetFocusWnd(Video),n=this.currentWndID;if(this.currentWndID=parseInt(a.result),Frame.currentNameSpace.changeVideoBtnByVideoType&&Capinfo.isSupportFishEye&&Frame.currentNameSpace.changeVideoBtnByVideoType(this.currentWndID),Capinfo.isSupport4KFishEye&&n!=this.currentWndID&&LensPlayMode.PLAYER_FISH_LEFT_4PTZ==Variables.PlayMode)if(1<=this.currentWndID)o.className="noDigitalZoom",o.title=h.lang.pub.startDigitalZoom,o.disabled=!0,this.isDigitalZoom&&(this.isDigitalZoom=!this.isDigitalZoom,this.NetSDKDigitalZoom(0,0));else{for(var r=!1,l=0;l<this.statusList.length;l++)if(this.statusList[l].isVideoOpen){r=!0;break}this.sdk_viewer&&this.sdk_viewer.isInstalled&&r&&(o.disabled=!1,o.className="openDigitalZoom")}if(Capinfo.isSupportPTZ&&0!=s||Capinfo.isSupport4KFishEye&&this.currentWndID){if(PtzButtonAct.ButtonDown==e)switch(s){case 1:D=PtzDerectMap.leftDown[0];break;case 2:D=PtzDerectMap.goDown[0];break;case 3:D=PtzDerectMap.rightDown[0];break;case 4:D=PtzDerectMap.goLeft[0];break;case 5:D=null;break;case 6:D=PtzDerectMap.goRight[0];break;case 7:D=PtzDerectMap.leftUp[0];break;case 8:D=PtzDerectMap.goUp[0];break;case 9:D=PtzDerectMap.rightUp[0]}else if(PtzButtonAct.ButtonUp==e)null!=D&&(D=2306);else if(D=(PtzButton.WheelZoomIn==t?PtzLensMap.BecomeSub1:PtzLensMap.BecomeAdd1)[0],null!=u){if(D==c)return clearTimeout(u),void(u=setTimeout(this.wheelReset,400));clearTimeout(u),Utils.submitCtrolCmd(c-1,this.varRotateSpeed,this.varRotateSpeed),u=setTimeout(this.wheelReset,400)}else u=setTimeout(this.wheelReset,400);null!=D&&"undefined"!=D&&0!=s&&(Utils.submitCtrolCmd(D,i,i),c=D)}},wheelReset:function(){PtzLensMap.BecomeSub1[0]!=D&&PtzLensMap.BecomeAdd1[0]!=D||(Utils.submitCtrolCmd(D-1,this.varRotateSpeed,this.varRotateSpeed),clearTimeout(u),c=u=null)},dealPlayerCodeProcess:function(e){var t;2==(e=Number(e))&&(Capinfo.isSupportHorizontalMenu||Capinfo.isSupportIpcCapture||Capinfo.isSupportPersonPhoto)?(this.isCaptureOpen=!1,t=this.NetSDKStopPlay(Video,2),ResultCode.RESULT_CODE_SUCCEED==t.code&&(this.NetSDKCloseStream(Video,2),this.NetSDKFreeLocalPort(Video,2),this.NetSDKStopPlayLocalJPG(Video,1),this.NetSDKFreeLocalPort(Video,1)),setTimeout("Frame.autoStartStream("+(Capinfo.maxStreamNum+1)+","+e+")",3e3)):Frame.currentNameSpace.stopVideoBack_click?Frame.currentNameSpace.stopVideoBack_click():(h("#videoDiv").addClass("waiting"),Frame.currentNameSpace.startstopVideo&&h("#blockDiv5").css("display","block"),Video.stopVideo(StreamType.LIVE,e),setTimeout("Frame.autoStartStream("+Video.statusList[e].streamID+","+e+")",3e3))},dealPlayerMediaVioce:function(e,t){var i=h.lang.tip.tipUnknownErr;switch(t=parseInt(t)){case XPErrorResult.AUDIO_DEVICE_UNRIPE:case XPErrorResult.VOICE_RUNNING_ERROR:i=h.lang.tip.tipTalkStopAudioDevNotReady}Frame.currentNameSpace.startstopTalk&&Frame.currentNameSpace.startstopTalk(),Utils.eventAlert(i)},dealFileDownload:function(e,t){h.lang.tip.tipUnknownErr;t=parseInt(t),ResultCode.RESULT_CODE_SUCCEED!=t?this.FileProcessResult=2:this.FileProcessResult=1},dealFileUpload:function(e,t){h.lang.tip.tipUnknownErr;t=parseInt(t),ResultCode.RESULT_CODE_SUCCEED!=t?this.FileProcessResult=2:this.FileProcessResult=1},dealPlayerRecordVideo:function(e,t){var i=h.lang.tip.tipUnknownErr;switch(t=parseInt(t)){case XPErrorResult.RECORDSTATE_MANUAL:case XPErrorResult.RECORD_FINISHED:case XPErrorResult.RECORDSTATE_SUBSECTION:return;case XPErrorResult.RECORDSTATE_CAPACITYLIMIT:i=h.lang.tip.tipTotalCapReached;break;case XPErrorResult.DISK_CAPACITY_WARN:i=h.lang.tip.tipDiskSpaceUnderThreshold;break;case XPErrorResult.DISK_CAPACITY_NOT_ENOUGH:i=h.lang.tip.tipDiskSpaceNoEnouch;break;case XPErrorResult.WRITE_FILE_FAILED:i=h.lang.tip.tipWriteFileErr;break;case XPErrorResult.PROCESS_MEDIA_DATA_FAILED:i=h.lang.tip.tipMediaDataErr;break;case XPErrorResult.NOT_SUPPORT_MEDIA_ENCODE_TYPE:i=h.lang.tip.tipNotSupportMediaEncode;break;case XPErrorResult.MEDIA_RESOLUTION_CHANGE:i=h.lang.tip.tipMediaResolutionChange}XPErrorResult.DISK_CAPACITY_WARN!=t&&Frame.currentNameSpace.startStopRecord&&Frame.currentNameSpace.startStopRecord(),Utils.eventAlert(i)},EventStatusReport:function(e,t){var i={},a=h.parseJSON(t);switch(e){case MacReportType.REPORT_UPDATE:r=a.StatusInfo.UpdateResult,Frame.showUpdateResult(r);break;case MacReportType.REPORT_NETWORK_CONFIG:r=a.StatusInfo.IPChangeStatus,Frame.currentNameSpace.onNetworkCfgResult&&Frame.currentNameSpace.onNetworkCfgResult(r);break;case MacReportType.STOR_MEMORY_CARD_FORMAT:r=a.StatusInfo.MemoryFormatResult,Frame.currentNameSpace.eventMemoryCardFormat&&Frame.currentNameSpace.eventMemoryCardFormat(r);break;case MacReportType.UPNP_PORT_MAP_INFO:Frame.currentNameSpace.eventUPNPStatus&&Frame.currentNameSpace.eventUPNPStatus();break;case MacReportType.VM_SERVER_ONLINE:r=a.StatusInfo.VMServerOnline,Frame.eventStatusReport("VmRegStatus",r);break;case MacReportType.PHOTO_SERVER_ONLINE:r=a.StatusInfo.PhotoServerOnline,Frame.eventStatusReport("TmsRegStatus",r);break;case MacReportType.LED_STROBE_STATE:r=a.StatusInfo.LEDStrobeStatus,Frame.eventStatusReport("LEDStatus",r);break;case MacReportType.POLARIZER_STATUS:r=a.StatusInfo.PolarizerStatus,Frame.eventStatusReport("PolarizerStatus",r);break;case MacReportType.NAS_STATUS:break;case MacReportType.RADAR_STATUS:r=a.StatusInfo.RadarStatus,Frame.eventStatusReport("RadarStatus",r);break;case MacReportType.COIL_STATUS:Frame.eventStatusReport("CoilStatus",a);break;case MacReportType.NDFILTER_STATUS:r=a.StatusInfo.NDFilterStatus,Frame.eventStatusReport("NDFilterStatus",r);break;case MacReportType.TRAFFICLIGHT_STATUS:r=a.StatusInfo.TrafficLightStatus,Frame.eventStatusReport("TrafficLightStatus",r);break;case MacReportType.TRAFFICLIGHTCOR_STATUS:Frame.currentNameSpace.eventTrafficLightColor&&(r=a.StatusInfo.TrafficLightColour,Frame.currentNameSpace.eventTrafficLightColor(r));break;case MacReportType.PARKING_STATUS:Frame.eventStatusReport("ParkingInfo",a);break;case MacReportType.VEHQUENULEN_STATUS:Frame.eventStatusReport("VehQueueLenStatus",a);break;case MacReportType.IVADETECTREPORT_INFO:null!==d&&(clearTimeout(d),d=null);var o=!0,s="",n=500,r=parseInt(a.StatusInfo.IVADetectReportInfo.ReportType),l=h("#IVAManualSnapInfo");switch(r){case IVAManualSnapErr.ILLEGAL_MANUAL_SNAP_START:o=!1,s=h.lang.pub.manualSnapStart,n=1e3;break;case IVAManualSnapErr.ILLEGAL_MANUAL_SNAP_OVER:s=h.lang.pub.manualSnapOver;break;case IVAManualSnapErr.MANUAL_SNAP_PTZ_MOVING:s=h.lang.pub.manualSnapPTZError;break;case IVAManualSnapErr.MANUAL_SNAP_OBJ_MAX_FULL:s=h.lang.pub.manualSnapFull;break;case IVAManualSnapErr.WORK_MODE_NOT_SUPPORT:s=h.lang.pub.workModeNotSupport}if(""==s)return;l.html(s),l.is(":visible")?(l.stop(),1==l.css("opacity")&&l.fadeTo(100,0),l.fadeTo(200,1)):(l.removeClass("hidden"),l.fadeIn(n)),o&&(d=setTimeout(function(){l.fadeOut(n,function(){l.addClass("hidden")})},800));break;case MacReportType.TRASERICESTATUS_STATUS:r=a.StatusInfo.TraServiceStatus,Frame.eventStatusReport("TrafficDataServerStatus",r);break;case MacReportType.TRAFFICPARAM_RESULT:Frame.currentNameSpace.getTrafficParamReport&&(r=a.StatusInfo.TrafficParamResult,Frame.currentNameSpace.getTrafficParamReport(r));break;case MacReportType.OUTLED_STATUS:r=a.StatusInfo.OutLedStatus,Frame.eventStatusReport("CarportLEDCtrlStatus",r);break;case MacReportType.PTZ_STATUS:i.PTZStatus={},i.PTZStatus.Status=a.StatusInfo.PTZStatus.Status,i.PTZStatus.Param1=a.StatusInfo.PTZStatus.Param1,Frame.currentNameSpace.onCruiseStatus&&Frame.currentNameSpace.onCruiseStatus(i);break;case MacReportType.SCENE_CURRENT:r=a.StatusInfo.SceneCurrent,Frame.currentNameSpace.eventSwitchScene&&Frame.currentNameSpace.eventSwitchScene(r);break;case MacReportType.SD_STATUS:r=a.StatusInfo.SDStatus,Frame.eventStatusReport("SDStatus",r);break;case MacReportType.DDNS_DOMAIN_CHECK_RESULT:r=a.StatusInfo.DDNSDomainTestResult,Frame.currentNameSpace.eventDomainCheck&&Frame.currentNameSpace.eventDomainCheck(r);break;case MacReportType.REPORT_USERINFOCHANGED:if(a.StatusInfo.QuitUserInfo.QuitUser==top.loginUserName&&!top.isAlertPwdChanged){top.showedFlag=!0,top.isAlertPwdChanged=!0,Utils.eventAlert({isReboot:!0,msg:h.lang.tip.tipUserInfoChanged});break}case MacReportType.WhiteBlackSqlStatus:r=a.StatusInfo.WhiteBlackSqlStatus,Frame.currentNameSpace.eventStatusReportList(r)}},initOcx:function(){var e,t,i,a={},o=Frame.loginServerIp.split(":"),s=this;1<o.length&&(Frame.loginServerIp=o[0],Frame.httpPort=o[1]),"localhost"==Frame.loginServerIp&&(Frame.loginServerIp="127.0.0.1"),Capinfo.isNoPlugin?(h("#ieVersion").attr("title",h.lang.pub.hiddenTips),Capinfo.isNoSupportAll?h("#videoDiv").find("#ieVersion .activeXDiv").html(h.lang.pub.noSupportAll):h("#videoDiv").find("#ieVersion .activeXDiv").html(h.lang.pub.noPluginTip1+"<a class='h264' style='color:blue;font-weight:bold;padding:0 5px;'>"+h.lang.pub.h264+"</a>"+h.lang.pub.noPluginTip2),h("#videoDiv").find("#ieVersion").slideDown(),flvjs.isSupported()&&(h("#activeX_obj").html("<video id='recordManager_activeX' ondblclick='Video.fullscreen()'></video><canvas id='canvas_fun' class='funCanvas hidden'></canvas><canvas id='canvas_265' style='display: none;'></canvas>"),S=h("#recordManager_activeX")[0])):(Capinfo.isMac?(e="netsdkplayer-plugin",i="1.2.0.3"):(i=(e=Capinfo.isUN?(t="B91BB9EA-9CDF-4917-9037-27CE4DEF0D8A","netsdkplayer-plugin-un"):(t="0F1A61E3-9097-4550-AC8C-3EA1D34690C9","netsdkplayer-plugin-nb"),"0.3.0.6"),top.is64Platform&&(i="1.2.0.2")),this.sdk_viewer=new Player({application:e,eventname:"plgnevent",clsid:t,id:"player",version:i,container:"activeX_obj",name:"Video.sdk_viewer",szDeviceIp:Frame.loginServerIp,events:P,prefix:"__",maxWnd:6}),top.sdk_viewer=this.sdk_viewer,t=Frame.loginUserName,i=Frame.loginUserPwd,t=Utils.hex_md5(t),i=Utils.hex_md5(i),Utils.LAPI_GetCfgData(LAPI_URL.CurrentPasswordInfo,a,"UserName="+t+"&Password="+i),a.IsTempPassword&&(top.IsTempCert=1),h("#activeX_obj").mouseenter(function(){s.sdk_viewer.isInstalled&&s.sdk_viewer.execFunctionReturnAll("NetSDKActiveWnd")}))},startStream:function(e){(p=flvjs.createPlayer({type:"flv",url:e,isLive:!0},{enableWorker:!0,enableStashBuffer:!1})).attachMediaElement(S),p.load(),p.play(),flvjs.LoggingControl.enableVerbose=!1,p.on(flvjs.Events.ERROR,function(e,t){switch(e){case flvjs.ErrorTypes.NETWORK_ERROR:break;case flvjs.ErrorTypes.MEDIA_ERROR:p.detachMediaElement();break;case flvjs.ErrorTypes.REDUX_ERROR:var i=Video.statusList[_wndID].bRecEnabled?0:1;Video.statusList[_wndID].bRecEnabled=!Video.statusList[_wndID].bRecEnabled,Frame.currentNameSpace.eventStorageRst(i),199===t.code&&Frame.showMsg(!1,h.lang.tip.tipVideoPrameChanged);break;default:p.destroy()}})},startVideo:function(e,t,i,a,o){var s,n,r=void 0===e?0:Number(e),l=void 0===t||t,u=void 0===i?0:i,c=this.statusList[u].isVideoOpen,e={},t=LAPI_URL.LivingStream;if(void 0===a&&(a=0),LoginType.VM_LOGIN==top.loginType&&(Frame.IsAutoStartVideo=!0),Capinfo.isNoPlugin&&1!=Video.StreamInfoChangeList[r].EncodeFormat)return!0;if(!Frame.IsAutoStartVideo||c)return!0;if(Capinfo.isNoPlugin){Utils.LAPI_GetCfgData(LAPI_URL.HttpAuth,{},{},!1,function(e,t){s=t.Mode});var d="/LAPI/V1.0/video/flv/stream1".replace("stream1","stream"+(r+1)),S="ws://"+Frame.loginServerIp+d;return s?new WebSocket(S).onmessage=function(e){var a=new FileReader;a.readAsText(e.data),a.addEventListener("loadend",function(){var e=(t=a.result.split(":")[1].trim()).indexOf("}"),t=t.slice(0,e);Utils.setCookie("Authorization",Utils.web_Digest(t,d,"GET"));for(var i=Utils.getCookie("Authorization");!i;)i=Utils.getCookie("Authorization");Video.startStream(S)})}:Video.startStream(S),c=!0,Video.statusList[u].isVideoOpen=c}if("undefined"!=typeof top.isGunBallLinkMarkPage&&top.isGunBallLinkMarkPage&&1==i){if(t="http://"+top.gunBallIpAddress+":"+top.gunBallPort+t,!Utils.OriginalAjaxGET(t,e,!1))return!1}else if(!Utils.LAPI_GetCfgData(t,e,"",!1))return!1;return"localhost"==(e=(t=e.Data.split("//"))[1].split(":"))[0]&&(e[0]=Frame.loginServerIp),0!=Frame.rtspPort&&-1!=(n=e[1].indexOf("/"))&&(e[1]=e[1].substring(n),e[1]=Frame.rtspPort+e[1]),t=(t="undefined"!=typeof top.isGunBallLinkMarkPage&&top.isGunBallLinkMarkPage&&1==i?t[0]+"//"+Frame.loginUserName+":"+Frame.loginUserPwd+"@"+t[1]:t[0]+"//"+Frame.loginUserName+":"+Frame.loginUserPwd+"@"+e[0]+":"+e[1]).replace("video1","video"+(r+1)),this.NetSDKGetLocalPort(this,u),this.NetSDKEnShowVideoInfo(o),e=this.NetSDKGetConfig(Video),e=(r=h.parseJSON(e.result)).VideoTransProto,e=(e=this.NetSDKOpenIPCNetStream(u,t,e,0,0,0)).code,ResultCode.RESULT_CODE_SUCCEED==e?(e=(e=this.NetSDKStartPlay(u)).code,o&&Capinfo.isSupport4KFishEye&&u?this.NetSDKPtzCtrl(u,1):this.NetSDKPtzCtrl(u,a),!this.isVoiceTalkOpen&&h("#audioBar").is(":visible")&&(this.NetSDKOpenSound(u,0),undefined==top.pcVolume&&(top.pcVolume=255),Capinfo.isMac&&(a=this.NetSDKGetVolume(this,u),ResultCode.RESULT_CODE_SUCCEED==a.code&&(top.pcVolume=a.result)),this.NetSDKSetVolume(this,u,top.pcVolume),!this.isVoiceMute&&o?this.NetSDKSetQuietStatus(Video,u,0):this.NetSDKSetQuietStatus(Video,u,1)),this.sdk_viewer.execFunctionReturnAll("NetSDKActiveWnd"),r=0==r.UntriggeredTarget?11:15,this.sdk_viewer.execFunctionReturnAll("NetSDKEnableIvaDraw",u,1,r)):this.NetSDKFreeLocalPort(Video,u),Capinfo.isSupportAudio&&this.videoChannel(0),ResultCode.RESULT_CODE_SUCCEED==e?this.statusList[u].isVideoOpen=c=!0:l&&(XPErrorResult.VIDEO_STREAM_FULL==e?Frame.showMsg(!1,h.lang.tip.tipVideoFull):Frame.showMsg(!1,h.lang.tip.tipStartVideoFailed)),c},startJpeg:function(){var e,t,i={};return(t=this.NetSDKGetLocalPort(Video,2).code==ResultCode.RESULT_CODE_SUCCEED)?(t=Utils.LAPI_GetCfgData(LAPI_URL.LivingStream,i,"",!1))&&(e=(e=i.Data.split("//"))[0]+"//"+Frame.loginUserName+":"+Frame.loginUserPwd+"@"+e[1],Capinfo.isSupportPersonPhoto||(e=e.replace("video1","video"+(Capinfo.maxStreamNum+1))),(t=this.NetSDKOpenIPCNetStream(2,e,2,0,0,0).code==ResultCode.RESULT_CODE_SUCCEED)?(t=this.NetSDKStartPlay(2).code==ResultCode.RESULT_CODE_SUCCEED)||(this.NetSDKCloseStream(Video,2),this.NetSDKFreeLocalPort(Video,2)):this.NetSDKFreeLocalPort(Video,2)):this.NetSDKFreeLocalPort(Video,2),Capinfo.isSupportPersonPhoto||t&&(e=!0,t=this.NetSDKGetLocalPort(this,1).code==ResultCode.RESULT_CODE_SUCCEED,Capinfo.isSupportHISIParam&&(e=this.sdk_viewer.execFunctionReturnAll("NetSDKGetLocalPort",3)),t&&e?(t=this.sdk_viewer.execFunctionReturnAll("NetSDKStartPlayLocalJPG",1).code==ResultCode.RESULT_CODE_SUCCEED,Capinfo.isSupportHISIParam&&(e=this.sdk_viewer.execFunctionReturnAll("NetSDKStartPlayLocalJPG",3)),t&&e||(this.NetSDKStopPlayLocalJPG(Video,1),this.NetSDKFreeLocalPort(Video,1),this.NetSDKStopPlay(this,2),this.NetSDKCloseStream(Video,2),this.NetSDKFreeLocalPort(Video,2),this.NetSDKFreeLocalPort(Video,3))):(this.NetSDKStopPlay(this,2),this.NetSDKCloseStream(Video,2),this.NetSDKFreeLocalPort(Video,2),this.NetSDKFreeLocalPort(this,1),e||this.NetSDKFreeLocalPort(Video,3))),this.isCaptureOpen=t,this.isCaptureOpen},videoChannel:function(){var e,t,i={};Utils.LAPI_GetCfgData(LAPI_URL.AudioIn,i)&&(1==i.Type?e="Channel=0":(t=i.AudioInputList[0].Enabled,1==Capinfo.AudioInNum?e=1==t?"Channel=0":"Channel=2":2==Capinfo.AudioInNum&&(e=1==t?"Channel=0":0==t&&0==i.AudioInputList[1].Enabled?"Channel=2":"Channel=1")),this.NetSDKSetSoundChannel(this,this.currentWndID,e))},stopVideo:function(e,t){var i,a=void 0===t?0:t,t=this.statusList[a].isVideoOpen;if(t=StreamType.PICTRUE==e||StreamType.IMAGE_TYPE_PLATE==e?this.isCaptureOpen:t){if(StreamType.PICTRUE==e||StreamType.IMAGE_TYPE_PLATE==e?this.isCapRecEnabled&&this.autoSaveGrabImg():StreamType.LIVE==e&&(this.statusList[a].bRecEnabled&&this.stopStorage(a),this.isDigitalZoom&&this.setDigitalZoom(),this.isOpticsZoom&&this.setOpticsZoom(),this.isManualSnap&&this.setManualSnap(),this.isAreaFocus&&this.setAreaFocus()),Capinfo.isNoPlugin){if(Utils.delCookie("Authorization"),void 0===p||null==p)return;p.destroy(),p=null,i=0,this.statusList[a].isVideoOpen=t=!1}else i=(i=this.NetSDKStopPlay(Video,a)).code,ResultCode.RESULT_CODE_SUCCEED==i&&(this.NetSDKCloseSound(this,0,0),i=(i=this.NetSDKCloseStream(Video,a)).code),ResultCode.RESULT_CODE_SUCCEED==i&&(i=(i=this.NetSDKFreeLocalPort(this,a)).code),t=!(ResultCode.RESULT_CODE_SUCCEED==i),StreamType.PICTRUE==e||StreamType.IMAGE_TYPE_PLATE==e?this.isCaptureOpen=t:this.statusList[a].isVideoOpen=t;t&&Frame.showMsg(!1,h.lang.tip.tipStopVideoFailed)}},startVoiceTalk:function(){var e,t,i={};this.isVoiceTalkOpen||(this.NetSDKCloseSound(this,this.currentWndID,0),this.NetSDKGetLocalPort(this,160),this.NetSDKOpenSound(160,0),this.NetSDKSetVolume(this,160,top.pcVolume),this.isVoiceMute?this.NetSDKSetQuietStatus(this,160,1):this.NetSDKSetQuietStatus(this,160,0),Utils.LAPI_GetCfgData(LAPI_URL.LivingStream,i),"localhost"==(i=(t=i.Data.split("//"))[1].split(":"))[0]&&(i[0]=Frame.loginServerIp),0!=Frame.rtspPort&&-1!=(e=i[1].indexOf("/"))&&(i[1]=i[1].substring(e),i[1]=Frame.rtspPort+i[1]),t=t[0]+"//"+Frame.loginUserName+":"+Frame.loginUserPwd+"@"+i[0]+":"+i[1],i=(i=this.NetSDKOpenVoiceSvcEx(160,t,1,3)).code,this.isVoiceTalkOpen=ResultCode.RESULT_CODE_SUCCEED==i,this.isMicMute||this.sdk_viewer.execFunctionReturnAll("NetSDKSetMicVolume",160,top.pcMicVolume),this.isVoiceTalkOpen?this.isVoiceTalkOpen=!0:(t=h.lang.tip.tipUnableOpenVoiceTalk,XPErrorResult.AUDIO_DEVICE_UNRIPE==i&&(t=h.lang.tip.tipStartFailAudioDevNotReady),Frame.showMsg(!1,t)),this.videoChannel(1))},stopVoiceTalk:function(){if(this.isVoiceTalkOpen){for(var e=this.NetSDKCloseVoiceSvcEx(160).code,t=0;t<this.statusList.length;t++)if(this.statusList[t].isVideoOpen){this.NetSDKOpenSound(t,0),this.NetSDKSetVolume(this,t,top.pcVolume),this.isVoiceMute?this.NetSDKSetQuietStatus(this,t,1):this.NetSDKSetQuietStatus(this,t,0);break}this.isVoiceTalkOpen=!(ResultCode.RESULT_CODE_SUCCEED==e),this.isVoiceTalkOpen?Frame.showMsg(!1,h.lang.tip.tipUnableCloseVoiceTalk):this.isVoiceTalkOpen=!1}},startStorage:function(e,t){var i,a,o,s,n,r,l=void 0===e?0:e;this.statusList[l].bRecEnabled||(Capinfo.isNoPlugin?(p.startRecord("1.mp4"),this.statusList[l].bRecEnabled=!0):(i=this.NetSDKGetDefaultPath(this),r=ResultCode.RESULT_CODE_SUCCEED==i.code?(a=(r=new Date).getFullYear().toString(),o=(r.getMonth()+1).toString(),n=r.getDate().toString(),s=+r.getHours().toString(),e=r.getMinutes().toString(),r=r.getSeconds().toString(),r=Utils.formatNewTime(a,o,n,s,e,r),n=Utils.formatDate(a,o,n),t=Utils.checkNavigator("safari")?void 0===t?i.result+"Record/"+Frame.loginServerIp+"/"+n+"/"+r:t:void 0===t?i.result+"Record\\"+Frame.loginServerIp+"\\"+n+"\\"+r:t,(r=this.NetSDKStartRecord(this,l,t,1)).code):i.code,this.statusList[l].bRecEnabled=ResultCode.RESULT_CODE_SUCCEED==r,this.statusList[l].bRecEnabled||(XPErrorResult.DISK_CAPACITY_NOT_ENOUGH==r?Frame.showMsg(!1,h.lang.tip.tipDiskSpaceNotEnoughStorage):XPErrorResult.CREATE_DIR_FAIL==r?Frame.showMsg(!1,h.lang.tip.tipCreateDirFailStorage):XPErrorResult.DIR_TOO_LONG==r?Frame.showMsg(!1,h.lang.tip.tipDirTooLongStorage):XPErrorResult.RECORDSTATE_CAPACITYLIMIT==r?Frame.showMsg(!1,h.lang.tip.tipRecordCapacityLimitStorage):Frame.showMsg(!1,h.lang.tip.tipUnableStartPlayer)),Utils.LAPI_SetCfgData(LAPI_URL.KeyFrame,{StreamID:this.statusList[l].streamID},!1)))},stopStorage:function(e){var t=void 0===e?0:e,i=h.lang.tip.tipStopStorageSuccess;this.statusList[t].bRecEnabled&&(Capinfo.isNoPlugin?(p.stopRecord(),this.statusList[t].bRecEnabled=!1):(e=(e=this.NetSDKStopRecord(this,t)).code,this.statusList[t].bRecEnabled=!(ResultCode.RESULT_CODE_SUCCEED==e),this.statusList[t].bRecEnabled&&(i=h.lang.tip.tipUnableStopPlayer)),Frame.showMsg(!this.statusList[t].bRecEnabled,i))},setAdjustVolume:function(e,t){var i,a,o=!0,s=1;if(void 0===t&&(t=!0),Capinfo.isNoPlugin&&(p.volume=new Number(e*(1/255)).toFixed(2)),this.sdk_viewer&&this.sdk_viewer.isInstalled){if(i=this.isVoiceTalkOpen?160:0,Capinfo.isSupport4KFishEye&&!this.isVoiceTalkOpen&&t)for(a=0;a<this.statusList.length;a++)this.statusList[a].isVideoOpen&&(s&=this.NetSDKSetVolume(this,a,e).code);else s=(s=this.NetSDKSetVolume(this,i,e)).code;ResultCode.RESULT_CODE_SUCCEED!=s&&(Frame.showMsg(!1,h.lang.tip.tipSetAdjustVolumeFail),o=!1)}return o},setSilenceStatus:function(e,t){var i,a,o=1;if(void 0===t&&(t=!0),Capinfo.isNoPlugin&&(this.isVoiceMute=!this.isVoiceMute,S.muted=this.isVoiceMute),this.sdk_viewer&&this.sdk_viewer.isInstalled){if(this.isVoiceTalkOpen)o=(o=this.NetSDKSetQuietStatus(this,a=160,e)).code;else if(a=0,Capinfo.isSupport4KFishEye&&t)for(i=0;i<this.statusList.length;i++)this.statusList[i].isVideoOpen&&(o&=this.NetSDKSetQuietStatus(this,i,e).code);else o=(o=this.NetSDKSetQuietStatus(this,a,e)).code;ResultCode.RESULT_CODE_SUCCEED==o?this.isVoiceMute=1==e:(a=this.isVoiceMute?h.lang.tip.tipAdjustNotSilenceFail:h.lang.tip.tipAdjustSilenceFail,Frame.showMsg(!1,a))}},setMicVolume:function(e,t){e=this.NetSDKSetMicVolume(this,160,e);e=e.code;e=ResultCode.RESULT_CODE_SUCCEED==e;return e?this.isMicMute=!!t&&!this.isMicMute:Frame.showMsg(!1,h.lang.tip.tipSetMicFail),this.NetSDKSendVoiceData(160,this.isMicMute),e},setAreaFocus:function(){var e;this.isAreaFocus=!this.isAreaFocus,e=1==this.isAreaFocus?1:0,this.NetSDKEnAreaFocus(this,0,e)},setDigitalZoom:function(){var e,t;this.isDigitalZoom=!this.isDigitalZoom,e=1==this.isDigitalZoom?1:0,Capinfo.isNoPlugin?(t=h("#canvas_fun"),this.digitalAreaPos.left=0,this.digitalAreaPos.top=0,this.digitalAreaPos.right=1e4,this.digitalAreaPos.bottom=1e4,this.isDigitalZoom?this.createCanvas(1):(t.addClass("hidden"),this.distroyCanvas(),clearInterval(m),m=0,h(S).css("opacity",1))):this.NetSDKDigitalZoom(0,e)},setManualSnap:function(){var e;this.isManualSnap=!this.isManualSnap,e=1==this.isManualSnap?1:0,this.sdk_viewer.execFunctionReturnAll("NetSDKEnAreaFocus",0,e)},setOpticsZoom:function(){var e;this.isOpticsZoom=!this.isOpticsZoom,e=this.isOpticsZoom?1:0,this.NetSDKDraw3DPosition(this,0,e)},autoSaveGrabImg:function(){var e=this.isCapRecEnabled?0:1,e=this.sdk_viewer.ViewerAxAutoSaveGrabImg(e);ResultCode.RESULT_CODE_SUCCEED==e?this.isCapRecEnabled=!this.isCapRecEnabled:(e=this.isCapRecEnabled?h.lang.tip.tipStopAutoSaveFail:h.lang.tip.tipStartAutoSaveFail,Frame.showMsg(!1,e))},autoFocus:function(){var e=this.isAutoFocus?0:1,e=this.sdk_viewer.ViewerAxAutoFocus(e);ResultCode.RESULT_CODE_SUCCEED==e?this.isAutoFocus=!this.isAutoFocus:(e=this.isAutoFocus?h.lang.tip.tipStopAutoFocusFail:h.lang.tip.tipStartAutoFocusFail,Frame.showMsg(!1,e))},grabImg:function(){Utils.LAPI_SetCfgData(LAPI_URL.CAPTURE_FORMAL,{},!1)||Frame.showMsg(!1,h.lang.tip.tipGrabImgFail)},grabDebugImg:function(){this.sdk_viewer.isInstalled&&Utils.LAPI_SetCfgData(LAPI_URL.CAPTURE_DEBUG,{},!1)},snatchPic:function(e){var t,i,a,o,s,n,r,l,u=void 0===e?0:e,c=h.lang.tip.tipSnatchSuccess,e={};Utils.LAPI_GetCfgData(LAPI_URL.IQDebugInfo,e,"",!1)&&(t=e.Info),Capinfo.isNoPlugin?(i=(r=h("#canvas_fun"))[0].getContext("2d"),n="screen_"+(new Date).getTime()+".png",a=(s=-1<window.navigator.userAgent.indexOf("Chrome"))?1080:this.videoWidth,o=s?687:this.videoHeight,r.attr({width:a,height:o}),i.drawImage(S,0,0,a,o),s=r[0].toDataURL("image/png").replace("image/png","image/octet-stream"),this.saveFile(s,n)):(i=this.NetSDKGetDefaultPath(this),ResultCode.RESULT_CODE_SUCCEED==i.code&&(a=(l=new Date).getFullYear().toString(),o=(l.getMonth()+1).toString(),r=l.getDate().toString(),s=+l.getHours().toString(),n=l.getMinutes().toString(),l=l.getSeconds().toString(),l=Utils.formatNewTime(a,o,r,s,n,l),r=Utils.formatDate(a,o,r),l=Utils.checkNavigator("safari")?i.result+"Snap/"+Frame.loginServerIp+"/"+r+"/"+l:i.result+"Snap\\"+Frame.loginServerIp+"\\"+r+"\\"+l,u=this.sdk_viewer.execFunctionReturnAll("NetSDKSnatchOnce",u,l,2),this.sdk_viewer.execFunctionReturnAll("NetSDKSetIQDebugInfo",t,l+".jpg"),(l=ResultCode.RESULT_CODE_SUCCEED==u.code)||(c=XPErrorResult.DISK_CAPACITY_NOT_ENOUGH==u.code?h.lang.tip.tipDiskSpaceNotEnoughSnatchFail:h.lang.tip.tipSnatchFail)),Frame.showMsg(l,c))},saveFile:function(e,t){var i=document.createElement("a");i.id="tmp_a_save",i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)},isFullscreen:function(){return document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement},fullscreen:function(e){this.isFullScreen=!!this.isFullscreen();var t,i=e||(this.isFullScreen?0:1);Capinfo.isNoPlugin?(t=h("#recordManager_activeX").get(0),i?Utils.requestFullScreen(t):Utils.exitFullscreen()):(t=(t=this.NetSDKFullScreen(e)).code,ResultCode.RESULT_CODE_SUCCEED==t&&(this.isFullScreen=1==e))},NetSDKGetConfig:function(e){return!Capinfo.isNoPlugin&&e.sdk_viewer.execFunctionReturnAll("NetSDKGetConfig")},NetSDKSetConfig:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKSetConfig",t)},NetSDKEnableIvaDraw:function(e,t,i,a){e.sdk_viewer.execFunctionReturnAll("NetSDKEnableIvaDraw",t,i,a)},NetSDKRegPostAuzEvent:function(e,t,i,a,o,s,n,r){e.sdk_viewer.execFunctionReturnAll("NetSDKRegPostAuzEvent",t,i,a,o,s,n,r)},NetSDKUnRegPostEvent:function(e){e.sdk_viewer.execFunctionReturnAll("NetSDKUnRegPostEvent")},frameRelease:function(){top.sdk_viewer.execFunctionReturnAll("NetSDKStopPlay",0),top.sdk_viewer.execFunctionReturnAll("NetSDKUnRegPostEvent"),(Capinfo.isSupportCapture||Capinfo.isSupportIpcCapture)&&(top.sdk_viewer.execFunctionReturnAll("NetSDKStopPlay",2),top.sdk_viewer.execFunctionReturnAll("NetSDKStopPlayLocalJPG",1))},NetSDKSetPlayDlgSize:function(e,t,i){e.sdk_viewer.execFunctionReturnAll("NetSDKSetPlayDlgSize",t,i)},NetSDKEnDblClkFull:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKEnDblClkFull",t)},NetSDKSetTrustSiteEnable:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKSetTrustSiteEnable",t)},NetSDKSetOSDStyle:function(e,t,i){e.sdk_viewer.execFunctionReturnAll("NetSDKSetOSDStyle",t,i)},NetSDKStopPlay:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKStopPlay",t)},NetSDKCloseStream:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKCloseStream",t)},NetSDKFreeLocalPort:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKFreeLocalPort",t)},NetSDKPlayBackCtrl:function(e,t){return this.sdk_viewer.execFunctionReturnAll("NetSDKPlayBackCtrl",e,t)},NetSDKOpenSound:function(e,t){this.sdk_viewer.execFunctionReturnAll("NetSDKOpenSound",e,t)},NetSDKStartPlay:function(e){return this.sdk_viewer.execFunctionReturnAll("NetSDKStartPlay",e)},NetSDKOpenIPCNetStream:function(e,t,i,a,o,s){return this.sdk_viewer.execFunctionReturnAll("NetSDKOpenIPCNetStream",e,t,i,a,o,s)},NetSDKEnShowVideoInfo:function(e){this.sdk_viewer.execFunctionReturnAll("NetSDKEnShowVideoInfo",e)},NetSDKGetLocalPort:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetLocalPort",t)},NetSDKGetVolume:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetVolume",t)},NetSDKSetPtzAndFixMode:function(e,t,i,a,o){return e.sdk_viewer.execFunctionReturnAll("NetSDKSetPtzAndFixMode",t,i,a,o)},NetSDKDigitalZoom:function(e,t){this.sdk_viewer.execFunctionReturnAll("NetSDKDigitalZoom",e,t)},NetSDKGetFocusWnd:function(e){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetFocusWnd")},NetSDKSetWndPos:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKSetWndPos",t)},NetSDKGetDefaultPath:function(e){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetDefaultPath")},NetSDKGetMicVolume:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetMicVolume",t)},NetSDKGetOCXRendScale:function(e){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetOCXRendScale")},NetSDKPlayLocalPic:function(e,t,i,a,o){return e.sdk_viewer.execFunctionReturnAll("NetSDKPlayLocalPic",t,i,a,o)},NetSDKChangeFileName:function(e,t,i){e.sdk_viewer.execFunctionReturnAll("NetSDKChangeFileName",t,i)},NetSDKStartPlayLocalJPG:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKStartPlayLocalJPG",t)},NetSDKFileDownLoad:function(e,t,i,a){return e.sdk_viewer.execFunctionReturnAll("NetSDKFileDownLoad",t,i,a)},NetSDKBrowseDir:function(e){return e.sdk_viewer.execFunctionReturnAll("NetSDKBrowseDir")},NetSDKStopPlayLocalJPG:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKStopPlayLocalJPG",t)},NetSDKSetOCXRendScale:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKSetOCXRendScale",t)},NetSDKSetQuietStatus:function(e,t,i){return e.sdk_viewer.execFunctionReturnAll("NetSDKSetQuietStatus",t,i)},NetSDKSetVolume:function(e,t,i){return e.sdk_viewer.execFunctionReturnAll("NetSDKSetVolume",t,i)},NetSDKCloseSound:function(e,t,i){return e.sdk_viewer.execFunctionReturnAll("NetSDKCloseSound",t,i)},NetSDKSetSoundChannel:function(e,t,i){e.sdk_viewer.execFunctionReturnAll("NetSDKSetSoundChannel",t,i)},NetSDKDraw3DPosition:function(e,t,i){e.sdk_viewer.execFunctionReturnAll("NetSDKDraw3DPosition",t,i)},NetSDKSetMicVolume:function(e,t,i){return e.sdk_viewer.execFunctionReturnAll("NetSDKSetMicVolume",t,i)},NetSDKEnAreaFocus:function(e,t,i){e.sdk_viewer.execFunctionReturnAll("NetSDKEnAreaFocus",t,i)},NetSDKStopRecord:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKStopRecord",t)},NetSDKStartRecord:function(e,t,i,a){return e.sdk_viewer.execFunctionReturnAll("NetSDKStartRecord",t,i,a)},NetSDKCloseVoiceSvcEx:function(e){return this.sdk_viewer.execFunctionReturnAll("NetSDKCloseVoiceSvcEx",e)},NetSDKSetRendScale:function(e,t){this.sdk_viewer.execFunctionReturnAll("NetSDKSetRendScale",e,t)},NetSDKSendVoiceData:function(e,t){this.sdk_viewer.execFunctionReturnAll("NetSDKSendVoiceData",e,t)},NetSDKOpenVoiceSvcEx:function(e,t,i,a){return this.sdk_viewer.execFunctionReturnAll("NetSDKOpenVoiceSvcEx",e,t,i,a)},NetSDKPtzCtrl:function(e,t){return this.sdk_viewer.execFunctionReturnAll("NetSDKPtzCtrl",e,t)},NetSDKFullScreen:function(e){return this.sdk_viewer.execFunctionReturnAll("NetSDKFullScreen",e)},NetSDKLivePause:function(e,t,i){return e.sdk_viewer.execFunctionReturnAll("NetSDKLivePause",t,i)},NetSDKJPGPlayCtrl:function(e,t){e.sdk_viewer.execFunctionReturnAll("NetSDKJPGPlayCtrl",t)},NetSDKPicPlayChange:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKPicPlayChange",t)},NetSDKSetDigitalZoom:function(e,t,i){return this.sdk_viewer.execFunctionReturnAll("NetSDKSetDigitalZoom",e,t,i)},NetSDKUploadFile:function(e,t,i,a,o,s,n,r,l,u){return e.sdk_viewer.execFunctionReturnAll("NetSDKUploadFile",t,i,a,o,s,n,r,l,u)},NetSDKGetLocalIP:function(e){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetLocalIP")},NetSDKGetRegSubPort:function(e,t){return e.sdk_viewer.execFunctionReturnAll("NetSDKGetRegSubPort",t)},NetSDKUnRegSubscription:function(e){return e.sdk_viewer.execFunctionReturnAll("NetSDKUnRegSubscription")},sortPrestList:function(e){for(var t,i=e.split("|"),a=[],o=0;o<i.length;o++)""!=(t=i[o])&&(a[t.split("*")[0]]=t);for(e="",o=0;o<a.length;o++)""!=(t=a[o])&&undefined!=t&&(e+=t+"|");return e=e.substring(0,e.lastIndexOf("|"))},resetCombox:function(){if(Capinfo.isSupportPTZ){var e,t,i=[],a={},o=h("#position"),s=0,n=0,r=200,l=[];do{if(!Utils.LAPI_GetCfgData(LAPI_URL.PresetList+"?Limit="+r+"&Offset="+s,a))return void Utils.disableAll()}while(l=l.concat(a.PresetInfos),s=a.Offset,n=a.Total,r=a.Total-a.Offset<r?a.Total-a.Offset:r,a={},s<n);for(a.PresetInfos=l,a.Total=n,e=0;e<a.Total;e++){var u,c=a.PresetInfos[e],d=Number(c.ID);d>=Frame.startPresetID&&d<=Frame.endPresetID&&(u=c.Name,(c={}).id=d,c.name=u,i[d]=c)}for(o.empty(),o.append("<option value='-1'>["+h.lang.pub.none+"]</option>"),e=0,t=i.length;e<t;e++){var S,p=i[e];p&&(p=(S=p.id)+"["+p.name+"]",o.append("<option value='"+S+"' title='"+p+"'>"+p+"</option>"))}}},callPreset:function(e){-1<e&&Utils.LAPI_SetCfgData(LAPI_URL.GoPreset+e+"/goto",{},!1)},delPreset:function(e){if(-1!=e&&confirm(h.lang.tip.tipConfirmDel))return Utils.LAPI_DelCfgData(LAPI_URL.PresetList+"/"+e,{},!1,this.callBack)},callBack:function(e){var t,i,a=h("#PresetNum"),o=h("#MotionPresetNum");e!=ResultCode.PTZ_PRESET_ISUSED?ResultCode.DEL_PTZ_PRESET!=e?((i=ResultCode.RESULT_CODE_SUCCEED==e)&&(Video.resetCombox(),e=Frame.currentNameSpace,h("#presetTR").is(":visible")&&(t=a.val(),e.makePresetList(),a.val(t)),o.is(":visible")&&(t=o.val(),e.generalPresetOption(),o.val(t))),Frame.showMsg(i)):alert(h.lang.tip.delPresetErrorMeg):alert(h.lang.tip.advErrorMeg)},bindPtzDerectEvent:function(e){if("object"!=typeof e)return!1;for(var t in e){var i=h("#"+t);i.bind("mousedown",e[t],function(e){Utils.submitCtrolCmd(e.data[0],Video.varRotateSpeed,Video.varRotateSpeed)&&(o=!0)}),i.bind("mouseup",e[t],function(e){o&&Utils.submitCtrolCmd(e.data[1],Video.varRotateSpeed,Video.varRotateSpeed)&&(o=!1)}),i.bind("mouseout",e[t],function(e){o&&Utils.submitCtrolCmd(e.data[1],Video.varRotateSpeed,Video.varRotateSpeed)&&(o=!1)})}},bindPtzLensEvent:function(e){if("object"!=typeof e)return!1;for(var t in e){var i=h("#"+t);i.bind("mousedown",e[t],function(e){Utils.submitCtrolCmd(e.data[0])&&(o=!0)}),i.bind("mouseup",e[t],function(e){o&&Utils.submitCtrolCmd(e.data[1])&&(o=!1)}),i.bind("mouseout",e[t],function(e){o&&Utils.submitCtrolCmd(e.data[1])&&(o=!1)})}},bindManualBackFocusNear:function(){var e=h("#manualbackfocusNear");e.bind("mousedown",function(){Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:2,ComParams:"2"},!1),n=!0}),e.bind("mouseup",function(){Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:2,ComParams:"0"},!1),n=!1}),e.bind("mouseout",function(){n&&(Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:2,ComParams:"0"},!1),n=!1)})},bindManualBackFocusFar:function(){var e=h("#manualbackfocusFar");e.bind("mousedown",function(){Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:2,ComParams:"1"},!1),n=!0}),e.bind("mouseup",function(){Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:2,ComParams:"0"},!1),n=!1}),e.bind("mouseout",function(){n&&(Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:2,ComParams:"0"},!1),n=!1)})},resetDivWidth:function(){null!=document.getElementById("bgObj_id")&&(document.getElementById("bgObj_id").style.width=document.body.scrollWidth+"px")},changeVideoType:function(e,t,i){var a=h("#ctrlTR");this.isShowPtz=e,Capinfo.isSupportFishEye&&(this.isShowPtz=!1),this.isShowPtz?(h("#activeX_obj").css({width:t,height:i}),a.removeClass("hidden"),s.SetValue(this.varRotateSpeed)):(a.addClass("hidden"),h("#activeX_obj").css({width:"100%",height:"100%"}))},startAutoBackFocus:function(){Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:1,ComParams:"0"},!1)||Frame.showMsg(!0,h.lang.tip.tipAutoFocusing,0)},restoreABFPosition:function(){Utils.LAPI_SetCfgData(LAPI_URL.SetBackFocus,{CmdType:0,ComParams:"0"},!1)||Frame.showMsg(!1,h.lang.tip.tipOperateFail)},startstopLivePlay:function(){this.isIVAStreamOpen=!this.isIVAStreamOpen,this.isIVAStreamOpen?(this.NetSDKLivePause(this,0,0),h("#stopLiveStream").html(h.lang.pub.stopLiveStream)):(this.NetSDKLivePause(this,0,1),h("#stopLiveStream").html(h.lang.pub.startLiveStream))},createCanvas:function(e){Video.calVideoRealPos();var t=h("#canvas_activeX_obj");t.length>>>0&&t.remove(),this.canvas=new DrawObj("activeX_obj",e),this.cur_scale=1,this.calVideoRealPos(),this.canvas.changeCanvasSize(),t.removeClass("hidden"),v=0,h("#canvas_fun").attr({width:this.videoWidth,height:this.videoHeight}).css({top:0,left:0}),window.onresize=function(){var e=h("#canvas_fun");Video.isDigitalZoom&&!e.hasClass("hidden")?(Video.digitalAreaPos.left=0,Video.digitalAreaPos.top=0,Video.digitalAreaPos.right=1e4,Video.digitalAreaPos.bottom=1e4,Video.showDigitalView(),h(S).css("opacity",1),Video.isDigitalZoom&&Video.setDigitalZoom(),Live.eventSetDigitalZoom()):(Video.calVideoRealPos(),Video.canvas&&Video.canvas.changeCanvasSize())}},showDigitalView:function(){var e=h("#canvas_fun");e.hasClass("hidden")?0==Video.digitalAreaPos.left&&0==Video.digitalAreaPos.top&&1e4==Video.digitalAreaPos.right&&1e4==Video.digitalAreaPos.bottom||(e.attr("width",this.frameWidth),e.attr("height",this.frameHeight),e.removeClass("hidden"),e.css("cursor","move"),h("#canvas_activeX_obj").addClass("hidden"),this.cur_scale=0,this.calVideoRealPos(),this.canvas.changeCanvasSize(),e.css({position:"absolute",left:Video.videoPosStartX,top:Video.videoPosStartY}),m=setInterval(Video.drawBigImage.bind(this,0),30),e.get(0).addEventListener("DOMMouseScroll",Video.scrollFunc,!1),e.get(0).onmousewheel=this.scrollFunc):0==Video.digitalAreaPos.left&&0==Video.digitalAreaPos.top&&1e4==Video.digitalAreaPos.right&&1e4==Video.digitalAreaPos.bottom&&(this.cur_scale=1,this.calVideoRealPos(),this.canvas.changeCanvasSize(),e.addClass("hidden"))},scrollFunc:function(e){h(S).css("opacity",0);var o,s=h("#canvas_fun"),n=s[0],t=n.getContext("2d");s.css({left:0,top:0}),v=0<(v+=e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3)?Math.min.call(null,10,v):Math.max.call(null,0,v),clearInterval(m),m=0==v?(f=!0,setInterval(function(){t.drawImage(S,0,0,Video.frameWidth,Video.frameHeight)},30)):(o=f?0:v,f=!1,setInterval(Video.drawBigImage.bind(this,o),30)),s.attr({width:Video.frameWidth*(1+.3*v),height:Video.frameHeight*(1+.3*v)}),n.onmousedown=function(e){var i=e.layerX,a=e.layerY;n.onmousemove=function(e){var t=n.offsetLeft+e.layerX-i,e=n.offsetTop+e.layerY-a;t<0&&e<0&&t>Video.frameWidth-Video.frameWidth*(1+.3*o)&&e>Video.frameHeight-Video.frameHeight*(1+.3*o)&&s.css({left:t,top:e}),n.onmouseup=function(){n.onmouseup=n.onmousemove=null}}}},drawBigImage:function(e){h("#canvas_fun")[0].getContext("2d").drawImage(S,S.videoWidth*(Video.digitalAreaPos.left/1e4),S.videoHeight*(Video.digitalAreaPos.top/1e4),S.videoWidth*((Video.digitalAreaPos.right-Video.digitalAreaPos.left)/1e4),S.videoHeight*((Video.digitalAreaPos.bottom-Video.digitalAreaPos.top)/1e4),0,0,Video.frameWidth*(1+.3*e),Video.frameHeight*(1+.3*e))},distroyCanvas:function(){this.canvas&&(this.canvas.Distroy(),this.canvas=null)},setRenderScale:function(e,t){this.calVideoRealPos(),this.sdk_viewer&&this.sdk_viewer.isInstalled&&(this.NetSDKSetRendScale(e,this.cur_scale),t&&this.NetSDKSetOCXRendScale(Video,this.cur_scale))},getVideoFormat:function(){var e,t={},i={};if(Utils.LAPI_GetCfgData(LAPI_URL.ImageEnhance,i)&&(r="4"==i.ImageRotation||"5"==i.ImageRotation),Utils.LAPI_GetCfgData(LAPI_URL.VideoEncode,t)){for(var a=0;a<t.Num;a++){for(var o={},s=0;s<l.length;s++){var n=l[s];o[n]=("Height"==n||"Width"==n?t.VideoStreamInfos[a].VideoEncodeInfo.Resolution:"ID"==n||"Enabled"==n?t.VideoStreamInfos[a]:t.VideoStreamInfos[a].VideoEncodeInfo)[n]}Capinfo.isSupportAlureMode&&(e=o.Height,o.Height=o.Width,o.Width=e),this.StreamInfoChangeList.push(o)}for(s=0;s<Capinfo.maxStreamNum&&0!=Number(this.StreamInfoChangeList[s].Enabled);s++);this.streamNum=s}},getStreamTypeByStreamID:function(e){var e=Number(this.StreamInfoChangeList[e].EncodeFmt),t=StreamType.LIVE;if(Capinfo.isSupportCapture)switch(e){case 1:t=StreamType.LIVE;break;case VideoFormat.JPEG:t=StreamType.IMAGE_TYPE_PLATE;break;case 0:t=StreamType.MJPEG}return t},getCurVideoFormat:function(e){e=this.StreamInfoChangeList[e<10?e:e-10];r?(this.videoWidth=Number(e.Height),this.videoHeight=Number(e.Width)):(this.videoWidth=Number(e.Width),this.videoHeight=Number(e.Height))},calVideoRealPos:function(){this.cur_scale==UIRenderScale.REAL?(this.videoPosStartX=this.videoPosStartY=0,this.videoPosEndX=this.videoWidth,this.videoPosEndY=this.videoHeight):this.cur_scale==UIRenderScale.PROPORTION?this.frameWidth*this.videoHeight>this.frameHeight*this.videoWidth?(this.videoPosStartX=(this.frameWidth-this.frameHeight*this.videoWidth/this.videoHeight)/2,this.videoPosStartY=0,this.videoPosEndX=(this.frameWidth+this.frameHeight*this.videoWidth/this.videoHeight)/2,this.videoPosEndY=this.frameHeight):(this.videoPosStartX=0,this.videoPosStartY=(this.frameHeight-this.frameWidth*this.videoHeight/this.videoWidth)/2,this.videoPosEndX=this.frameWidth,this.videoPosEndY=(this.frameHeight+this.frameWidth*this.videoHeight/this.videoWidth)/2):(this.videoPosStartX=this.videoPosStartY=0,this.videoPosEndX=this.frameWidth,this.videoPosEndY=this.frameHeight)},rectPerVal:function(e){return e<0?e=0:100<e&&(e=100),e},realPosToPer:function(e){e=e.split(",");return this.rectPerVal(Math.round(100*(parseInt(e[0])-this.videoPosStartX)/(this.videoPosEndX-this.videoPosStartX)))+","+this.rectPerVal(Math.round(100*(parseInt(e[1])-this.videoPosStartY)/(this.videoPosEndY-this.videoPosStartY)))+","+this.rectPerVal(Math.round(100*(parseInt(e[2])-this.videoPosStartX)/(this.videoPosEndX-this.videoPosStartX)))+","+this.rectPerVal(Math.round(100*(parseInt(e[3])-this.videoPosStartY)/(this.videoPosEndY-this.videoPosStartY)))},perPosToReal:function(e){e=e.split(",");return Math.round(this.videoPosStartX+this.rectPerVal(e[0])*(this.videoPosEndX-this.videoPosStartX)/100)+","+Math.round(this.videoPosStartY+this.rectPerVal(e[1])*(this.videoPosEndY-this.videoPosStartY)/100)+","+Math.round(this.videoPosStartX+this.rectPerVal(e[2])*(this.videoPosEndX-this.videoPosStartX)/100)+","+Math.round(this.videoPosStartY+this.rectPerVal(e[3])*(this.videoPosEndY-this.videoPosStartY)/100)},initSlider:function(){(s=new Slider("rotateSpeedSld","rotateSpeedBar",{onMove:function(){i&&(Video.varRotateSpeed=Math.round(this.GetValue()))},showTip:!0})).MinValue=1,s.MaxValue=9,i=!1,s.SetValue(this.varRotateSpeed),i=!0},getSweepSnowInfo:function(){if(t||a){t=!1;var e={};if(!Utils.LAPI_GetCfgData(LAPI_URL.SnowMode,e))return void Utils.disableAll();a=0!=e.StatusParam.SnowModeStatus,this.changeSweepSnowStatus()}setTimeout(function(){Video.getSweepSnowInfo()},6e5)},changeSweepSnowStatus:function(){var e=h("#clearsnowOpen"),t=h("#clearsnowClose");a?(e.removeClass("clearsnow-open").addClass("clearsnowOpen_disable"),e.prop("disabled",!0),t.removeClass("clearsnowClose_disable").addClass("clearsnow-close"),t.prop("disabled",!1),document.getElementById("clearsnowOpen")&&(e.removeClass("clearsnow-open").addClass("clearsnowOpen_disable"),e.prop("disabled",!0),t.removeClass("clearsnowClose_disable").addClass("clearsnow-close"),t.prop("disabled",!1)),h("#clearsnowOpen_live").addClass("clearsnowopen_status")):(e.removeClass("clearsnowOpen_disable").addClass("clearsnow-open"),e.prop("disabled",!1),t.removeClass("clearsnow-close").addClass("clearsnowClose_disable"),t.prop("disabled",!0),document.getElementById("clearsnowOpen")&&(e.removeClass("clearsnowOpen_disable").addClass("clearsnow-open"),e.prop("disabled",!1),t.removeClass("clearsnow-close").addClass("clearsnowClose_disable"),t.prop("disabled",!0)),h("#clearsnowOpen_live").removeClass("clearsnowopen_status"))},sweepSnow:function(e,t,i){Utils.submitCtrolCmd(e,t,i)&&(a=4865==e,this.changeSweepSnowStatus())},checkInstallStatus:function(){(Utils.checkNavigator("ie")||Utils.checkNavigator("firefox"))&&Video.initOcx();var e=Video.sdk_viewer.checkVersion();e&&null!==e?location.reload():setTimeout(Video.checkInstallStatus,5e3)},addEvent:function(e,t,i){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener?e.addEventListener(t,i,!1):alert("failed to attach event")},dealCarReport:function(e,t){Frame.currentNameSpace.eventRecordReport&&Frame.currentNameSpace.eventRecordReport(e,t)},drawButtonLink:function(e,t,i){Frame.currentNameSpace.eventDrawButtonLink&&Frame.currentNameSpace.eventDrawButtonLink(e,t,i)},dealEventDrawObjParam:function(e,t,i){Frame.currentNameSpace.eventDrawObjParam&&Frame.currentNameSpace.eventDrawObjParam(e,t,i)},dealEventDrawObjParamCanvas:function(e,t,i){(Frame.currentNameSpace.eventDrawObjParam||Frame.currentNameSpace.eventDrawObjParamCanvas)&&(Frame.currentNameSpace.eventDrawObjParamCanvas?Frame.currentNameSpace.eventDrawObjParamCanvas(e,t,i):Frame.currentNameSpace.eventDrawObjParam(e,t,i))},dealEventSelDrawObj:function(e,t){Frame.currentNameSpace.eventSelDrawObj&&Frame.currentNameSpace.eventSelDrawObj(e,t)}}))}(jQuery),Video.init2();