Config.NetworkSystem=function(i){var d,s=!1,r="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",n=null,a=Capinfo.ElectPortNum,o={},l=0,p=1,c={},I={},P={IPGetType:["IPv4","IPGetType"],UserName:["IPv4","PPPoE","LoginName"],MTULen:["MTU"],WorkMode:["NegotiationMode"],v6Mode:["IPv6","IPGetType"]},u={IpAddress:["Address"],IpNetmask:["Netmask"],IpGateway:["Gateway"]},m={Ipv6Address:["Address"],PrefixLenth:["PrefixLenth"],Ipv6Gateway:["Gateway"]},v=-1;i.lang.pub.del;return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initValidator(),this.initEvent(),this.initData(document.frmSetup),Utils.afterDataLoad()},initPage:function(){this.initIPTypeOption()},initData:function(e){var t;if(o={},c={},e.Password.value=r,0<Capinfo.networkModeArr.length)for(a=0;a<Capinfo.networkModeArr.length;a++)t=Number(Capinfo.networkModeArr[a]),i("#WorkMode").append("<option value='"+t+"'>"+i.lang.pub["WorkMode"+(t+1)]+"</option>");else i("#workModeTR").addClass("hidden");if(i("#networkType").val(Capinfo.networkType),!Utils.LAPI_GetCfgData(LAPI_URL.NetworkInterfaces,c))return Frame.showMsg(!1,i.lang.tip.tipGetCfgFail),void Utils.disableAll();(1<c.IPv4.AddressNum?i("#doubleIsolationOpen"):i("#doubleIsolationClose")).prop("checked",!0),I=Utils.objectClone(c);for(var a=0;a<c.IPv4.AddressNum;a++)Utils.LAPI_CfgToForm("frmSetup",c.IPv4.AddressList[a],o,u);for(a=0;a<c.IPv6.AddressNum;a++)Utils.LAPI_CfgToForm("frmSetup",c.IPv6.AddressList[a],o,m);Utils.LAPI_CfgToForm("frmSetup",c,o,P),this.selectIPMode(e),i(".tab_selected").trigger("click")},initEvent:function(){var e={Address:"0.0.0.0",Netmask:"0.0.0.0",Gateway:"0.0.0.0"};i("button.sectionTab").bind("click",this.ipAddrTab_click),i("input[name='doubleIsolationEnable']").bind("click",function(){i("#doubleIsolationOpen").is(":checked")?(c.IPv4.AddressNum=2,c.IPv4.AddressList[1]=e,i("#Tab_bar").removeClass("hidden"),i("#IPAddrDiv").addClass("tab_content"),i("#IPAddrDiv").addClass("section_padding")):(i("#Tab_bar").addClass("hidden"),i("#IPAddrDiv").removeClass("tab_content"),i("#IPAddrDiv").removeClass("section_padding"),0!=v&&(v=-1,i(".sectionTab").first().trigger("click")),c.IPv4.AddressNum=1,c.IPv4.AddressList.splice(1,1))}),i("#IpGateway").change(function(){""==i("#IpGateway").val()&&i("#IpGateway").val("0.0.0.0")})},submitF:function(){if(n.form()){var e=document.frmSetup;if(Utils.LAPI_FormToCfg("frmSetup",c,o,P),Utils.LAPI_FormToCfg("frmSetup",c.IPv4.AddressList[v],o,u),Utils.LAPI_FormToCfg("frmSetup",c.IPv6.AddressList[0],o,m),i("#doubleIsolationOpen").is(":checked")){var t=c.IPv4.AddressList[0].Address,a=c.IPv4.AddressList[1].Address,t=t.split("."),a=a.split(".");if(t[0]==a[0]&&t[1]==a[1]&&t[2]==a[2])return void Frame.showMsg(!1)}a=!Utils.isObjectEquals(c,I);a||s?!Utils.isObjectEquals(c.IPv6.AddressList[0],I.IPv6.AddressList[0])&&""==i("#Ipv6Address").val()?alert(i.lang.tip.tipIPv6AddressAndGateway):a&&!confirm(i.lang.tip.tipCfmChangeNetWork)||(0==e.IpGateway.value.length&&(e.IpGateway.value="0.0.0.0"),(a||s)&&(Frame.updateBlock(!0),l=setTimeout(function(){Frame.updateBlock(!1),Frame.showMsg(!0),Utils.disableAll()},5e3),s&&(c.RSAPublicKey={},c.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,c.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,c.IPv4.PPPoE.PIN=Utils.encrypting(i("#Password").val(),Frame.RSAKey)),Utils.LAPI_SetCfgData(LAPI_URL.NetworkInterfaces,c,!1,this.callback))):Frame.showMsg(!0,i.lang.tip.tipAnyChangeInfo,0)}},callback:function(e){ResultCode.RESULT_CODE_SUCCEED==e?(s&&(delete c.RSAPublicKey,delete c.IPv4.PPPoE.PIN),I=Utils.objectClone(c),s=!1,i("#Password").val(r)):ResultCode.RESULT_RASPUBLICKEY_AUTH_ERR==e?(e={},Utils.LAPI_GetCfgData(LAPI_URL.SecurityRSA,e)&&(setMaxDigits(130),Frame.RSAPublicKeyE=e.RSAPublicKeyE,Frame.RSAPublicKeyN=e.RSAPublicKeyN,Frame.RSAKey=new RSAKeyPair(Frame.RSAPublicKeyE,"",Frame.RSAPublicKeyN),c.RSAPublicKey={},c.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,c.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,c.IPv4.PPPoE.PIN=Utils.encrypting(i("#Password").val(),Frame.RSAKey),Utils.LAPI_SetCfgData(LAPI_URL.NetworkInterfaces,c,!1,Config.NetworkSystem.callback))):Frame.showMsg(!1,i.lang.tip.tipSetCfgFail)},release:function(){},initValidator:function(){var t=this;i("#MTULen").attr("tip",i.validator.format(i.lang.tip.tipIntRange,576,1500)),i.validator.addMethod("checkCommonNamePwd",function(e){return Utils.checkCommonNamePwd(e)},i.lang.tip.tipCharFmtErr),i("#IpAddress").attr("tip",i.lang.tip.tipIPInfo),i("#IpNetmask").attr("tip",i.lang.tip.tipSubnetMaskInfo),i("#IpGateway").attr("tip",i.lang.tip.tipGatewayInfo),i("#UserName").attr("tip",i.lang.tip.tipCommonNamePwd),i("#Password").attr("tip",i.lang.tip.tipCommonNamePwd),i("#PrefixLenth").attr("tip",i.validator.format(i.lang.tip.tipIntRange,3,127)),i("#Ipv6Address").attr("tip",i.lang.tip.tipIPInfo),i("#Ipv6Gateway").attr("tip",i.lang.tip.tipGatewayInfo),i.validator.addMethod("isIPAddress",function(e){return Utils.isIPAddress(e)},i.lang.tip.tipIPErr),i.validator.addMethod("checkIP1To223",function(e){return Utils.checkIP1To223(e)},i.lang.tip.tipIPRangeErr),i.validator.addMethod("checkIPUnequalGW",function(e){return t.checkIPUnequalGW()},i.lang.tip.tipIPAndGWNotEqual),i.validator.addMethod("checkSubnetMask",function(e){return t.checkSubnetMask(e)},i.lang.tip.tipSubnetMaskErr),i.validator.addMethod("checkIPAddrOrEmpty",function(e){return Utils.checkIPAddrOrEmpty(e)},i.lang.tip.tipIPErr),i.validator.addMethod("checkIP1To223OrEmpty",function(e){return Utils.checkIP1To223OrEmpty(e)},i.lang.tip.tipIPRangeErr),i.validator.addMethod("isIPv6OrEmpty",function(e){return t.isIPv6OrEmpty(e)},i.lang.tip.tipIPErr),i.validator.addMethod("isIPv6SpecialLimit",function(e){return t.isIPv6SpecialLimit(e)},i.lang.tip.tipIPv6Limit),i.validator.addMethod("ipv6limitOnlyZero",function(e){return t.ipv6limitOnlyZero(e)},i.lang.tip.tipIPv6Limit),n=i("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,t){Utils.showJqueryErr(e,t,"div")},success:function(e){},rules:{PrefixLenth:{integer:!0,required:!0,range:[3,127]},Ipv6Address:{isIPv6OrEmpty:"",isIPv6SpecialLimit:"",ipv6limitOnlyZero:"",CheckIPv6AddressAndGatewayEqual:"#Ipv6Address,#Ipv6Gateway",relationTo:[{id:"#Ipv6Gateway",method:"CheckIPv6AddressAndGatewayEqual"}]},Ipv6Gateway:{isIPv6OrEmpty:"",isIPv6SpecialLimit:"",ipv6limitOnlyZero:"",CheckIPv6AddressAndGatewayEqual:"#Ipv6Address,#Ipv6Gateway",relationTo:[{id:"#Ipv6Address",method:"CheckIPv6AddressAndGatewayEqual"}]},MTULen:{integer:!0,required:!0,range:[576,1500]},IpAddress:{required:!0,isIPAddress:"",checkIP1To223:"",checkIPUnequalGW:"",userDefinedCheckIPAndMask:"#IpNetmask",userDefinedCheckIPAndMaskSameNet:"#IpAddress,#IpNetmask,#IpGateway",relationTo:[{id:"#IpGateway",method:"userDefinedCheckIPAndMaskSameNet"}]},IpNetmask:{required:!0,isIPAddress:"",checkSubnetMask:"",relationTo:[{id:"#IpAddress",method:"userDefinedCheckIPAndMask"},{id:"#IpGateway",method:"userDefinedCheckIPAndMask"},{id:"#IpGateway",method:"userDefinedCheckIPAndMaskSameNet"},{id:"#IpAddress",method:"userDefinedCheckIPAndMaskSameNet"}]},IpGateway:{checkIPAddrOrEmpty:"",checkIP1To223OrEmpty:"",checkIPUnequalGW:"",userDefinedCheckIPAndMask:"#IpNetmask",userDefinedCheckIPAndMaskSameNet:"#IpAddress,#IpNetmask,#IpGateway",relationTo:[{id:"#IpAddress",method:"userDefinedCheckIPAndMaskSameNet"}]},UserName:{checkCommonNamePwd:""},Password:{checkCommonNamePwd:""}}})},netContent_change:function(){var e=Utils.getEvent(),t=(e.srcElement||e.target).id,a=i("#"+t),e=i("#"+t+"_TD").attr("rowNum"),t=t.replace(e,"");return"Netmask"!=t||this.checkSubnetMask(a.val())?"Destination"!=t||Utils.checkIP1To223(a.val())?void(d.getData(e)[t]=a.val()):(alert(i.lang.tip.tipDestination),void a.val(d.getData(e)[t])):(alert(i.lang.tip.tipGenmask),void a.val(d.getData(e)[t]))},ipAddrTab_click:function(){var e=i(this).attr("data-divID");if(-1!=v){if((!i("#IpAddress").valid()||!i("#IpNetmask").valid()||!i("#IpGateway").valid())&&p)return;Utils.LAPI_FormToCfg("frmSetup",c.IPv4.AddressList[v],o,u)}i("#"+e).removeClass("hidden"),i(".tab_selected").removeClass("tab_selected"),i(this).addClass("tab_selected"),v=i(this).attr("data-ipAddr"),Utils.LAPI_CfgToForm("frmSetup",c.IPv4.AddressList[v],o,u),p=1},initPwdChanged:function(e){s||(i("#"+e).val(""),s=!0)},initIPTypeOption:function(){for(var e="",t=Capinfo.netIPTypeArr,a=0;a<t.length;a++)switch(Number(t[a])){case 0:e+="<option value='0' lang='staticIP'></option>";break;case 1:e+="<option value='1'> PPPoE </option>";break;case 2:e+="<option value='2'> DHCP </option>"}i("#IPGetType").append(e)},checkSubnetMask:function(e){if(!Utils.isIPAddress(e))return!1;var t=e.split("."),a=parseInt(t[0]),i=parseInt(t[1]),e=parseInt(t[2]),t=parseInt(t[3]);return!(-1<(Utils.format10To2(a)+Utils.format10To2(i)+Utils.format10To2(e)+Utils.format10To2(t)).indexOf("01"))&&(0!=a+i+e+t&&1020!=a+i+e+t)},checkIPUnequalGW:function(){return i("#IpAddress").val()!=i("#IpGateway").val()},onNetworkCfgResult:function(e){clearTimeout(l),top.showedFlag=!0,Frame.updateBlock(!1);var t="";switch(parseInt(e)){case ResultCode.RESULT_CODE_IP_CONFLICT:t=i.lang.tip.tipChgIpConflict;break;case ResultCode.RESULT_CODE_NOT_SUPPORT:t=i.lang.tip.tipChgIpUnsupport;break;case ResultCode.RESULT_CODE_INVALID_PARAM:t=i.lang.tip.tipChgIpInvalidParm;break;case ResultCode.RESULT_CODE_UNPPPPOE_CONFLICT:t=i.lang.tip.tipUnpPppoeConfict;break;case ResultCode.RESULT_CODE_GATEWAY_CONFLICT:t=i.lang.tip.tipChgGatewayIpConflict;break;default:t=i.lang.tip.tipChgIpFailure}Utils.eventAlert(t)},selectIPMode:function(e){var t;n.init(),p=0,2==i("#IPGetType").val()?(i("#IPSet").addClass("hidden"),i("#MaskSet").addClass("hidden"),i("#GWSet").addClass("hidden"),i("#UserNameSet").addClass("hidden"),i("#UserPwdSet").addClass("hidden"),i("#doubleIsolationEnableDiv").addClass("hidden"),i("#Tab_bar").addClass("hidden"),i("#IPAddrDiv").addClass("hidden"),i("#MTU").removeClass("hidden")):(t=1==i("#IPGetType").val(),o.IPGetType,t?(i("#IPSet").addClass("hidden"),i("#MaskSet").addClass("hidden"),i("#GWSet").addClass("hidden"),i("#UserNameSet").removeClass("hidden"),i("#UserPwdSet").removeClass("hidden"),i("#doubleIsolationEnableDiv").addClass("hidden"),i("#Tab_bar").addClass("hidden"),i("#IPAddrDiv").addClass("hidden"),i("#MTU").addClass("hidden")):(1<a&&i("#doubleIsolationEnableDiv").removeClass("hidden"),i("#IPSet").removeClass("hidden"),i("#MaskSet").removeClass("hidden"),i("#GWSet").removeClass("hidden"),i("#UserNameSet").addClass("hidden"),i("#UserPwdSet").addClass("hidden"),i("#doubleIsolationOpen").is(":checked")&&(i("#Tab_bar").removeClass("hidden"),i("#DefineLU").removeClass("hidden"),i("#IPAddrDiv").addClass("tab_content"),i("#IPAddrDiv").addClass("section_padding")),i("#IPAddrDiv").removeClass("hidden"),i("#MTU").removeClass("hidden"))),i(".tab_selected").trigger("click")},ipv6limitOnlyZero:function(e){var t,a;if(""==e)return!0;for(t=e.split(":"),a=0;a<t.length;a++){if(a==t.length-1&&"1"==t[a])return!1;if(0!==Number(t[a]))return!0}return!1},isIPv6SpecialLimit:function(e){e=e.split(":")[0].toLowerCase();return!("f"==e.charAt(0)&&"f"==e.charAt(1)||"f"==e.charAt(0)&&"e"==e.charAt(1)&&("8"==e.charAt(2)||"9"==e.charAt(2)||"b"==e.charAt(2)||"a"==e.charAt(2)))},isIPv6OrEmpty:function(e){return""==e||Utils.isIPv6Address(e)}}))}(jQuery),Frame.currentNameSpace=Config.NetworkSystem;