Utils.$package("userinfoEdit"),userinfoEdit=function(n){var l=Frame.opener.userMap,s=!1,t=null,r=Frame.opener.type,i=top.IsTempCert,o=!1;return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initEvent(),this.initValidator(),this.initData(),Utils.afterDataLoad()},initPage:function(){n("#Name").prop("disabled",1==r),1==i?n("#tipDiv").removeClass("hidden"):0!=Utils.checkStrong(Frame.loginUserPwd)&&1!=Utils.checkStrong(Frame.loginUserPwd)||(VersionType.IN==Capinfo.versionType?n("#enNotice"):n("#unNotice")).removeClass("hidden")},initEvent:function(){var e=this,i=n("#userPwd");i.bind("keyup",function(){e.pwStrength(this.value)}),i.bind("blur",function(){e.pwStrength(this.value)}).bind("blur",function(){e.userConfirmPwdCheck()}),i.bind("focus",function(){e.initPwdChanged()}),n("#userConfirmPwd").bind("focus",function(){e.initPwdChanged()})},initData:function(){n("#userPwd").val(""),n("#userConfirmPwd").val(""),Utils.cfgToForm(l,"frmSetup1")},release:function(){},initValidator:function(){var e=VersionType.IN==Capinfo.versionType||top.IsRemote?n.lang.tip.tipENPwsStrong:n.lang.tip.tipCharFmtErr;n("#Name").attr("tip",n.lang.tip.tipUserName2),n("#userPwd").attr("tip",n.lang.tip.tipENPwsStrong),n("#userConfirmPwd").attr("tip",n.lang.tip.tipENPwsStrong),n.validator.addMethod("checkUserName",function(e){return Utils.checkUserName(e)},n.lang.tip.tipCharFmtErr),n.validator.addMethod("checkPwd",function(e){var i=!0;return s&&(VersionType.IN==Capinfo.versionType?i=!n("#pwdLevelPic_3").hasClass("level0"):i&&top.IsRemote&&""!=e&&(i=!n("#pwdLevelPic_2").hasClass("level0"))),i},e),n.validator.addMethod("userDefinedConfirmPwd",function(){return n("#userPwd").val()==n("#userConfirmPwd").val()},n.lang.tip.tipUnequalUserPwd),(t=n("#frmSetup1").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,i){Utils.showJqueryErr(e,i,"span","userinfo_edit_div")},success:function(){},rules:{Name:{required:!0,checkUserName:""},userPwd:{checkPwd:""},userConfirmPwd:{userDefinedConfirmPwd:""}}})).init()},checkDuplicatedName:function(){for(var e,i=Config.system_passwd.jsonMap.Users.length,a=!1,l=0;l<i;l++)if(e=Config.system_passwd.jsonMap.Users[l],(1!=r||l!=Config.system_passwd.UserDataView.currectRow)&&e.Name==n("#Name").val()){Frame.showMsg(!0,n.lang.tip.tipDuplicatedName,0),a=!0;break}return a},pwStrength:function(e){var i,a,l,s,t,r;if(null==e)i="level1",a=l="level0",s="levelT1",t=r="levelT0";else switch(Utils.checkStrong(e)){case 0:case 1:i="level1",a=l="level0",s="levelT1",t=r="levelT0";break;case 2:i=a="level2",l="level0",t="levelT2",s=r="levelT0";break;default:i=a=l="level3",r="levelT3",s=t="levelT0"}n(".levelPic").removeClass("level0").removeClass("level1").removeClass("level2").removeClass("level3"),n(".levelText").removeClass("levelT0").removeClass("levelT1").removeClass("levelT2").removeClass("levelT3"),n("#pwdLevelPic_1").addClass(i),n("#pwdLevelPic_2").addClass(a),n("#pwdLevelPic_3").addClass(l),n("#pwdLevelText_1").addClass(s),n("#pwdLevelText_2").addClass(t),n("#pwdLevelText_3").addClass(r)},submitWinData:function(){var e=this,i=n("#Name"),a=n("#userPwd");o=LoginType.WEB_LOGIN==Frame.loginType&&Frame.loginUserName==i.val(),0==r&&a.focus().blur(),t.form()&&(l.RSAPublicKey={},l.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,l.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,l.Passwd=Utils.encrypting(a.val(),Frame.RSAKey),0==r?e.checkDuplicatedName()||(l.ID=-1,l.Name=i.val(),l.Level=n("#Level").val(),Utils.LAPI_CreateCfgData(LAPI_URL.Users_Cfg+"/Users",l,!1,e.callback)):s?o&&!confirm(n.lang.tip.tipPasswdChanged)||Utils.LAPI_SetCfgData(LAPI_URL.Users_Cfg+"/Users/"+l.ID,l,!1,e.callback):Frame.showMsg(!0,n.lang.tip.tipAnyChangeInfo,0))},callback:function(e){ResultCode.RESULT_CODE_SUCCEED==e?(Frame.showMsg(!0),Frame.loginUserName==n("#Name").val()&&(Frame.loginUserPwd=n("#userPwd").val()),Config.system_passwd&&Config.system_passwd.UserDataView.refresh(),1==i?Frame.logout():(o&&Frame.logout(),Utils.closeWin())):ResultCode.RESULT_RASPUBLICKEY_AUTH_ERR==e?(e={},Utils.LAPI_GetCfgData(LAPI_URL.SecurityRSA,e)&&(setMaxDigits(130),Frame.RSAPublicKeyE=e.RSAPublicKeyE,Frame.RSAPublicKeyN=e.RSAPublicKeyN,Frame.RSAKey=new RSAKeyPair(Frame.RSAPublicKeyE,"",Frame.RSAPublicKeyN),l.RSAPublicKey={},l.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,l.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,l.Passwd=Utils.encrypting(n("#userPwd").val(),Frame.RSAKey),0==r?Utils.LAPI_CreateCfgData(LAPI_URL.Users_Cfg+"/Users",l,!1,userinfoEdit.callback):Utils.LAPI_SetCfgData(LAPI_URL.Users_Cfg+"/Users/"+l.ID,l,!1,userinfoEdit.callback))):Frame.showMsg(!1,n.lang.tip.tipSetCfgFail)},userConfirmPwdCheck:function(){var e=n("#userConfirmPwd");""!=e.val()&&e.valid()},initPwdChanged:function(){s||(n("#userPwd").val(""),n("#userConfirmPwd").val(""),s=!0)}}))}(jQuery),Frame.openWinNameSpace=userinfoEdit;