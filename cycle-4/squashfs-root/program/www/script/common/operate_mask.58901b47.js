Config.OperateMask=function(C){var n=Capinfo.coverOsdNum,s=["CC66FF","FF6633","0099FF","339933","CC0033","6666CC","FFFF66","99CC00","CC66FF","FF6633","0099FF","339933","CC0033","6666CC","FFFF66","99CC00","CC66FF","FF6633","0099FF","339933","CC0033","6666CC","FFFF66","99CC00"],d={Enable:1,Area:{TopLeft:{X:0,Y:0},BotRight:{X:10,Y:10}}},p=Capinfo.isSupport3DCover,f={},m=!0,u={},l={},r=[],a=null,v={},t={},o={},c={},e=[{fieldId:"CoverEnable",hidden:!0,hiddenFillter:0},{fieldId:"CoverLeft",fieldType:"text",hidden:!0},{fieldId:"CoverTop",fieldType:"text",hidden:!0},{fieldId:"CoverRight",fieldType:"text",hidden:!0},{fieldId:"CoverBottom",fieldType:"text",hidden:!0},{fieldId:"rowNum",fieldType:"RowNum"},{fieldId:"name"},{fieldId:"Zoom",fieldType:"text",hidden:!(p&&1==Capinfo.ptzType),eventMap:{onchange:function(e){Config.OperateMask.changeZoom(e)}}},{fieldId:"option",fieldType:"option",hidden:!(p&&1==Capinfo.ptzType),option:"<span class='button hidden' id='getZoom#rowNum'><span class='btn_l'></span><button type='button' rowNum=#rowNum onclick='Config.OperateMask.setCurrentZoom($(this).attr(\"rowNum\"))'>"+C.lang.pub.setAsCurrentZoom+"</button><span class='btn_r'></span></span><span class='button hidden' id='gotoAreaPos#rowNum'><span class='btn_l'></span><button type='button' rowNum=#rowNum onclick='Config.OperateMask.presetCoverArea($(this).attr(\"rowNum\"))'>"+C.lang.pub.cruisePreset+"</button><span class='btn_r'></span></span>&nbsp;"}],g=null;return new(Class.extend({init:function(){},init2:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initEvent(),this.initData(),Utils.afterDataLoad()},initPage:function(){8<n&&C("#coverOsdTip").removeClass("hidden"),p&&1==Capinfo.ptzType&&(C("*[name='coverName']").css("width","140px"),C("*[name='zoom']").removeClass("hidden"),C("*[name='operateTD']").removeClass("hidden")),Utils.resetVideoSize(StreamID.MAIN_VIDEO,"recordManager_div_activeX"),2==Utils.getCfg("style")&&C("body").css("backgroundColor","#f1f2f3"),Utils.initVideo("recordManager_div_activeX",StreamType.LIVE,RunMode.CONFIG,null,Capinfo.isSupportPTZ,this.initVideo_callback)},initData:function(){if(Capinfo.isSupportFishEye&&10!=Frame.DefaultStreamID)return C("#tipMsg").removeClass("hidden"),void Utils.disableAll();if(v={},Utils.LAPI_GetCfgData(LAPI_URL.PrivacyMask,v)){if(this.FullmappingMap(),l={},0==v.AreaNum?Utils.LAPI_CfgToForm("frmSetup",v):Utils.LAPI_CfgToForm("frmSetup",v,l,t),p&&1==Capinfo.ptzType){if(!Utils.LAPI_GetCfgData(LAPI_URL.CoverOSDZooms,o))return void Utils.disableAll();for(var e=0;e<o.Nums;e++)l["Zoom"+e]=o.AreaZooms[e].Zoom}this.initDataView()}else Utils.disableAll()},initEvent:function(){var e=this;C("#addCover").bind("click",function(){e.addCoverArea()}),C("#delCover").bind("click",function(){e.removeCoverArea()})},submitF:function(){},release:function(){Frame.currentNameSpace="",g&&clearTimeout(g),Utils.EnableDrawFun(StreamType.LIVE,0),Frame.hiddenVideo()},changeDataToList:function(){var e,t,o={},a=0;for(r=[],e=0;e<n;e++){for(t=!(o={}),a=0;a<v.AreaNum;a++)if(e==l["Index"+a]){t=!0;break}o.name=C.lang.pub.coverOsd+(e+1),o.CoverEnable=t?l["CoverEnable"+a]:0,o.CoverLeft=t?l["CoverLeft"+a]:0,o.CoverTop=t?l["CoverTop"+a]:0,o.CoverRight=t?l["CoverRight"+a]:1e3,o.CoverBottom=t?l["CoverBottom"+a]:1e3,p&&1==Capinfo.ptzType&&(o.Zoom=l["Zoom"+e]),r.push(o)}return r},mappingMapFn:function(e){c={};for(var t=0;t<e.AreaNum;t++)c["AreaId"+t]=["Areas",t,"AreaID"],c["CoverLeft"+t]=["Areas",t,"CoverPosition","TopLeft","X"],c["CoverTop"+t]=["Areas",t,"CoverPosition","TopLeft","Y"],c["CoverRight"+t]=["Areas",t,"CoverPosition","BotRight","X"],c["CoverBottom"+t]=["Areas",t,"CoverPosition","BotRight","Y"]},repareCoverOsdPos:function(){if(p&&0!=C("#dataview_tbody").find("tr:visible").length){var e=!1,t={},o={},a={},r=this;if(Utils.LAPI_GetCfgData(LAPI_URL.OSD3DCoverPosition,o)){for(var i in this.mappingMapFn(o),Utils.changeMapToMapByMapping(o,c,t,0),t)e||f[i]==t[i]||(e=!0),f[i]=t[i];if(m=m&&!(e=!0),e)for(var n=o.AreaNum,s=0;s<n;s++){var d="0,0,0,0"==t["CoverLeft"+s]+","+t["CoverTop"+s]+","+t["CoverRight"+s]+","+t["CoverBottom"+s]?0:1,l=Number(t["AreaId"+s]);(a=u[DrawType.RECT][l]).Left=100*Number(t["CoverLeft"+s]),a.Top=100*Number(t["CoverTop"+s]),a.Right=100*Number(t["CoverRight"+s]),a.Bottom=100*Number(t["CoverBottom"+s]),(isOldPlugin&&!Capinfo.isMac?Utils.setDrawObj(DrawType.RECT,l,u):Utils.ModifyDrawObj(DrawType.RECT,l,u))?Utils.showHiddenArea(DrawType.RECT,l,d):m=!0}}g=setTimeout(function(){r.repareCoverOsdPos()},1e3)}},initOsdDrawObjData:function(){var e,t,o,a,r=this,i=LANG_TYPE.Chinese==top.language?C.lang.pub.coverOsd:"Mask";for((u={})[DrawType.RECT]=[],t=0;t<n;t++){for(a=!(e={}),o=0;o<v.AreaNum;o++)if(t==l["Index"+o]){a=!0;break}e.Text=i+(t+1),e.Left=a?100*Number(l["CoverLeft"+o]):0,e.Top=a?100*Number(l["CoverTop"+o]):0,e.Right=a?100*Number(l["CoverRight"+o]):1e3,e.Bottom=a?100*Number(l["CoverBottom"+o]):1e3,e.LineColor=Utils.getDrawObjColor(s[t]),e.LineWidth=2,u[DrawType.RECT].push(e)}Utils.initDrawObj(u,function(){r.showAllArea()})},FullmappingMap:function(){var e;for(t={},e=0;e<v.AreaNum;e++)t["Index"+e]=["CoverOSD",e,"Index"],t["name"+e]=["CoverOSD",e,"Name"],t["CoverEnable"+e]=["CoverOSD",e,"Enable"],t["CoverLeft"+e]=["CoverOSD",e,"Area","TopLeft","X"],t["CoverTop"+e]=["CoverOSD",e,"Area","TopLeft","Y"],t["CoverRight"+e]=["CoverOSD",e,"Area","BotRight","X"],t["CoverBottom"+e]=["CoverOSD",e,"Area","BotRight","Y"]},addCoverArea:function(){var e=0,t=v.AreaNum;if(v.AreaNum!=n){for(;e<v.AreaNum;e++)if(e!=v.CoverOSD[e].Index){t=e;break}d.Area.TopLeft.X=0,d.Area.TopLeft.Y=0,d.Area.BotRight.X=10,d.Area.BotRight.Y=10,Utils.LAPI_CreateCfgData(LAPI_URL.Cover_OSD,d)&&(this.initData(),this.initOsdDrawObjData(),1==v.AreaNum&&(this.repareCoverOsdPos(),m=!0),C("#dataview_tbody").find("tr[rowNum='"+t+"']").click())}else Frame.showMsg(!0,C.lang.tip.tipUpperMaskInfo,0)},removeCoverArea:function(){var e,t=a.currectRow;t<0||(r[t].CoverEnable=0,p&&1==Capinfo.ptzType&&(r[t].Zoom=100,C("#Zoom"+t).val("1.00")),Utils.LAPI_DelCfgData(LAPI_URL.Cover_OSD+"/"+t,{})&&(p&&1==Capinfo.ptzType&&this.submitF_osdZoom(),this.initData(),this.initOsdDrawObjData(),Utils.showHiddenArea(DrawType.RECT,t,0),0<(e=C("#dataview_tbody")).find("tr:visible").length&&(t=e.find("tr:visible").get(0).getAttribute("rowNum"),e.find("tr[rowNum='"+t+"']").click())))},presetCoverArea:function(e){Utils.submitCtrolCmd(32768,e)||alert(C.lang.tip.tipPresetMaskFailed)},changeZoom:function(){var e=Utils.getEvent(),t=(e.srcElement||e.target).id,o=Number(t.replace("Zoom","")),e=C("#"+t),t=e.val(),t=isNaN(t)||Number(t)<1?1:parseFloat(t);e.val(t.toFixed(2)),r[o].Zoom=100*Number(e.val()),this.submitF_osdZoom()},setCurrentZoom:function(e){var t={};Utils.LAPI_GetCfgData(LAPI_URL.PTZAbsZoom,t)?(t=Number(t.StatusParam.PTZAbsZoom.PTZZoomNum).toFixed(2),C("#Zoom"+e).val(t),r[e].Zoom=100*t,this.submitF_osdZoom()):Frame.showMsg(!1,C.lang.tip.tipGetPtzPosErr)},isContain:function(e,t){for(var o=0,a=e.length;o<a;o++)if(t==e[o])return!0;return!1},submitF_osdZoom:function(){for(var e=0;e<n;e++)o.AreaZooms[e].Zoom=r[e].Zoom,o.AreaZooms[e].AreaID=e;Utils.LAPI_SetCfgData(LAPI_URL.CoverOSDZooms,o)},eventDrawObjParam:function(e,t,o){var a,r={},i=u[e][t];for(a in isOldPlugin&&!Capinfo.isMac?Utils.sdkAddCfg(r,o):r=C.parseJSON(o),r)i[a]=Number(r[a]);d.Index=t,d.Enable=1,d.Area.TopLeft.X=Math.round(i.Left/100),d.Area.TopLeft.Y=Math.round(i.Top/100),d.Area.BotRight.X=Math.round(i.Right/100),d.Area.BotRight.Y=Math.round(i.Bottom/100),Utils.LAPI_SetCfgData(LAPI_URL.Cover_OSD+"/"+t,d),this.initData(),this.eventSelDrawObj(e,t)},eventSelDrawObj:function(e,t){C("#dataview_tbody").find("tr[rowNum='"+t+"']").trigger("click")},showAllArea:function(){for(var e,t=0;t<v.AreaNum;t++)e=0,p||1!=l["CoverEnable"+t]||(e=1),Utils.showHiddenArea(DrawType.RECT,l["Index"+t],e)},initDataView:function(){a=new TableView("dataview_tbody",this.changeDataToList,e),p&&1==Capinfo.ptzType&&a.setFields({Zoom:function(e){return(Number(e)/100).toFixed(2)}}),a.setTrEvnet({onclick:function(){var e,t=Utils.getEvent(),o=t.srcElement||t.target,t=a.currectRow;if("TR"==o.tagName||"TD"==o.tagName)e=C(o).attr("rowNum");else{if("A"==o.tagName)return;e=C(o).parents("td").attr("rowNum")}t!=e&&(-1!=t&&p&&1==Capinfo.ptzType&&(C("#getZoom"+t).addClass("hidden"),C("#gotoAreaPos"+t).addClass("hidden")),a.checkRow(e),p&&1==Capinfo.ptzType&&(C("#getZoom"+e).removeClass("hidden"),C("#gotoAreaPos"+e).removeClass("hidden")),Utils.selectDrawObj(DrawType.RECT,a.currectRow))}}),a.createDataView()},initVideo_callback:function(e){Utils.EnableDrawFun(e,1),Config.OperateMask.initOsdDrawObjData(),Config.OperateMask.repareCoverOsdPos()}}))}(jQuery),Config.OperateMask.init2(),Frame.currentNameSpace=Config.OperateMask;