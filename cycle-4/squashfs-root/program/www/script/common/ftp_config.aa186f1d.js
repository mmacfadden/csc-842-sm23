Config.ftpPage=function(s){var r=!1,t="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",o={},n=[],l=[],p=[],d=[],h=Capinfo.FTPPathNameArr,c=Capinfo.FTPFileNameArr,u={},m=null,g={},P={DataType:["UploadType"],ServerIP:["ServerIPAddress"],Port:["ServerPort"],Username:["LoginName"],StorMode:["StorageMode"],FullCoverNum:["FullCoverNum"]},f=[s.lang.pub.none,s.lang.pub.custom,s.lang.pub.ipAddr,s.lang.pub.time,s.lang.pub.date,s.lang.pub.roadInfo,s.lang.pub.roadID,s.lang.pub.device,s.lang.pub.NeedCarPlate,s.lang.pub.NeedPlateColor,s.lang.pub.PlateColorID,s.lang.pub.plateType,s.lang.pub.plateTypeID,s.lang.pub.drivewayID,s.lang.pub.speed,s.lang.pub.markedSpeed,s.lang.pub.limitedSpeed,s.lang.pub.overSpeedPercent,s.lang.pub.NeedDrivingDirection,s.lang.pub.directID,s.lang.pub.NeedSecurityCode,s.lang.pub.illegalType,s.lang.pub.illegalParams,s.lang.pub.carType,s.lang.pub.carLogo,s.lang.pub.NeedCarColor,s.lang.pub.CarColorID,s.lang.pub.CarColorDept,s.lang.pub.picNum,s.lang.pub.epPicNum,s.lang.pub.dataAndHour,s.lang.pub.timeYear,s.lang.pub.timeMonth,s.lang.pub.timeDay,s.lang.pub.timeHour,s.lang.pub.timeMin,s.lang.pub.timeSec,s.lang.pub.TrgMode,s.lang.pub.FrameCount,s.lang.pub.carCoordinate,s.lang.pub.plateCoordinate,s.lang.pub.redLightTime,s.lang.pub.randomValue,s.lang.pub.elementLowercase,s.lang.pub.elementUpercase,s.lang.pub.picAllCount,s.lang.pub.epPicNumZero,"","","",s.lang.pub.timeHourMin,s.lang.pub.presetNo,s.lang.pub.ptzLongitude,s.lang.pub.ptzLatitude,s.lang.pub.ptzZoom],C=[s.lang.pub.disable,s.lang.pub.custom,s.lang.pub.ipAddr,s.lang.pub.time,s.lang.pub.date,s.lang.pub.roadInfo,"",s.lang.pub.device,"","","","","",s.lang.pub.roadway,"","","","","","","",s.lang.pub.illegalType,"","","","","","",s.lang.pub.picNum,"",s.lang.pub.dataAndHour,s.lang.pub.timeYear,s.lang.pub.timeMonth,s.lang.pub.timeDay,s.lang.pub.hours,s.lang.pub.timeMin,"","","","","","","","","","","","","","",s.lang.pub.timeHourMin,s.lang.pub.presetNo],v=20,b=4,N={".":".","-":"-","=":"=",_:"_"};return N[s.lang.pub.custom]=s.lang.pub.custom,new(Class.extend({init:function(){0==Menu.pageType&&(h=Capinfo.BasicFTPPathNameArr,c=Capinfo.BasicFTPFileNameArr),Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initEvent(),this.initData(document.frmSetup),this.initValidator(),Utils.afterDataLoad()},initPage:function(){var e=s("#RoadIDSpan");e.html(s.lang.pub.roadID);var a=s("#isUploadPic"),t=s("#passCarPic");Capinfo.isSupportCapture&&s("#Tab_bar").removeClass("hidden"),1==Menu.pageType?(s("#deviceNameTR").removeClass("hidden"),s("#deviceIDTR").removeClass("hidden"),(-1<Utils.isContainsElement("19",c)||Capinfo.isSupportCapture)&&s("#DirectionIDTD").removeClass("hidden"),Capinfo.isSupportIVA?IVAMode.ILLEGAL==Frame.IVAType?(s("#illegalCarPic").removeClass("hidden"),s("#passCarPic").addClass("hidden"),s("#Tab_bar button:first").addClass("hidden"),s("#Tab_bar button:first").removeClass("tab_selected"),s("#Tab_bar button:last").removeClass("hidden"),s("#Tab_bar button:last").addClass("tab_selected"),s("#RoadIDTD").removeClass("hidden"),s("#FormatStrTD").removeClass("hidden"),s("#PathUtf8FormatDIV").removeClass("hidden"),s("#EpAdvancedNameRule").html(s.lang.pub.advanced),e.html(s.lang.pub.SceneID),f[5]=s.lang.pub.sceneName,f[6]=s.lang.pub.SceneID,C[5]=s.lang.pub.sceneName):(s("#passCarPic").removeClass("hidden"),s("#illegalCarPic").addClass("hidden"),s("#Tab_bar button:first").removeClass("hidden"),s("#Tab_bar button:first").addClass("tab_selected"),s("#Tab_bar button:last").addClass("hidden"),s("#Tab_bar button:last").removeClass("tab_selected"),s("#RoadIDTD").removeClass("hidden")):(s("#Tab_bar button:first").removeClass("hidden"),s("#Tab_bar button:first").addClass("tab_selected"),s("#passCarPic").removeClass("hidden"),s("#RoadIDTD").removeClass("hidden"),s("#FormatStrTD").removeClass("hidden"),s("#PathUtf8FormatDIV").removeClass("hidden"),a.parent().removeClass("hidden"),s("#TgAdvancedNameRule").html(s.lang.pub.advanced),s("#EpAdvancedNameRule").html(s.lang.pub.advanced),Capinfo.isSupportIpcCapture||Capinfo.isSupportCapture||Capinfo.isSupportIvaPark?s("#PlateIDTD").removeClass("hidden"):(s("#isUploadPic").addClass("hidden"),s("#DataType").addClass("hidden"),Capinfo.isSupportHorizontalMenu||(s("#isUploadPic").removeClass("hidden"),s("#DataType").removeClass("hidden")),s("#Tab_bar").find("button:first").html(s.lang.pub.ivaPassVehicleTitle)),Capinfo.isSupportIllegalParam&&s("#Tab_bar button:last").removeClass("hidden"))):Capinfo.isSupportIvaPark?(s("#deviceNameTR").removeClass("hidden"),s("#deviceIDTR").removeClass("hidden"),s("#Tab_bar").find("button:first").html(s.lang.pub.parkPicPath),s("#passCarPic").removeClass("hidden"),s("#illegalCarPic").addClass("hidden"),s("#Tab_bar button:first").removeClass("hidden"),s("#Tab_bar button:first").addClass("tab_selected"),s("#Tab_bar button:last").addClass("hidden"),s("#Tab_bar button:last").removeClass("tab_selected"),s("#RoadIDTD").removeClass("hidden"),s("#FormatStrTD").removeClass("hidden"),s("#EpAdvancedNameRule").html(s.lang.pub.advanced),e.html(s.lang.pub.SceneID),f[5]=s.lang.pub.sceneName,f[6]=s.lang.pub.SceneID,f[13]=s.lang.pub.carPort,C[5]=s.lang.pub.sceneName,C[13]=s.lang.pub.carPort):(s("#checkFtpDiv").removeClass("hidden"),b=4,s("#PathType3").removeClass("hidden"),s("#PassVehicleSpan3").removeClass("hidden"),s("#Tab_bar").find("button:first").html(s.lang.pub.ivaPassVehicleTitle),s("#Tab_bar button:first").removeClass("hidden"),a.parent().removeClass("hidden"),a.html(s.lang.pub.uploadPic),s("#storModeTR").removeClass("hidden"),s("#pageCoverTip").removeClass("hidden"),s("#FullCoverNumTR").removeClass("hidden"),t.removeClass("hidden")),s("#fileNameTip").attr("title",s.lang.pub.fileNameTip),s("#FullCover").attr("title",s.lang.pub.FullCover),this.createOption(),this.createSignalOption(),s("#Tab_bar .tab_selected").trigger("click")},initData:function(e){if(e.Password.value=t,0!=Menu.pageType||Capinfo.isSupportIvaPark){if(P={FormatStrEnable:["Advance"],FtpElementNum:["ElementNum"],DataType:["BaseCfg","DataType"],DeviceID:["BaseCfg","DeviceID"],DeviceName:["BaseCfg","DeviceName"],DirectID:["BaseCfg","DirectionID"],PathUtf8Format:["BaseCfg","PathUtf8Format"],PlateID:["BaseCfg","CarPlateInterval"],RoadID:["BaseCfg","DrivewayID"],Username:["BaseCfg","UserName"],ServerIP:["BaseCfg","ServerAddr","IPAddr"],Port:["BaseCfg","ServerAddr","Port"],BreakSign:["PicName","BreakSign"],EpBreakSign:["EPPicName","BreakSign"]},!Utils.LAPI_GetCfgData(LAPI_URL.PictureFTP,u))return void Utils.disableAll();this.fullmappingMap(),g=Utils.objectClone(u),Utils.LAPI_CfgToForm("frmSetup",u,o,P),o.BreakChar=0==o.BreakSign?"":String.fromCharCode(o.BreakSign),o.EpBreakChar=0==o.EpBreakSign?"":String.fromCharCode(o.EpBreakSign),"."==o.BreakChar||"_"==o.BreakChar||"-"==o.BreakChar||"="==o.BreakChar?o.fgSignal=o.BreakChar:(o.fgSignal=s.lang.pub.custom,s("#BreakChar").removeClass("hidden")),0==u.EPPicName.BreakSign?o.EpBreakChar="":o.EpBreakChar=String.fromCharCode(u.EPPicName.BreakSign),"."==o.EpBreakChar||"_"==o.EpBreakChar||"-"==o.EpBreakChar||"="==o.EpBreakChar?o.illfgSignal=o.EpBreakChar:(o.illfgSignal=s.lang.pub.custom,s("#EpBreakChar").removeClass("hidden")),Utils.LAPI_CfgToForm("frmSetup",u,o,P),this.changeMapToPicNameRuleList(),this.changeMapToEpPicNameRuleList(),this.changeMapToPassVehiclelList(),this.changeMapToIllegalPicList(),this.initPicRuleTable(),this.initEpPicRuleTable(),this.refreshPassVehicleOption(),this.refreshIllegalOption(),this.showAdvancedParam()}else{if(u={},!Utils.LAPI_GetCfgData(LAPI_URL.FTP_Cfg,u))return void Utils.disableAll();g=Utils.objectClone(u),b=u.PathFormat.Num,P.BreakSign=["NameFormat","Separator"];for(var a=0;a<b;a++)P["PassVehiclePathType"+a]=["PathFormat","PathList",a,"Type"],P["PassVehiclePathName"+a]=["PathFormat","PathList",a,"Path"];for(v=u.NameFormat.Num,a=0;a<v;a++)P["PicNameRulePathType"+a]=["NameFormat","ElementList",a,"Type"],P["PicNameRulePathName"+a]=["NameFormat","ElementList",a,"Name"];0==u.NameFormat.Separator?o.BreakChar="":o.BreakChar=String.fromCharCode(u.NameFormat.Separator),"."==o.BreakChar||"_"==o.BreakChar||"-"==o.BreakChar||"="==o.BreakChar?o.fgSignal=o.BreakChar:(o.fgSignal=s.lang.pub.custom,s("#BreakChar").removeClass("hidden")),Utils.LAPI_CfgToForm("frmSetup",u,o,P),this.changeMapToPicNameRuleList(),this.changeMapToPassVehiclelList(),this.initPicRuleTable(),this.refreshPassVehicleOption(),this.showAdvancedParam()}this.storMode()},initEvent:function(){var e=this;s("#FormatStrEnable").bind("click",function(){Config.ftpPage.showAdvancedParam()}),s("#Tab_bar button").bind("click",e.picTab_click),s("#fgSignal").change(function(){Config.ftpPage.toggleFgSignal("fgSignal")}),s("#illfgSignal").change(function(){Config.ftpPage.toggleFgSignal("illfgSignal")}),s("#BreakChar").bind("blur",this.showPicName),s("#FullCoverNum").change(e.isSmaller),s("#StorMode").change(e.storMode)},submitF:function(){var e=p.length,a=s("#StorMode").is(":checked");if(m.form())if(m.init(),0!=Menu.pageType||Capinfo.isSupportIvaPark){var t=d.length+p.length;for(i=0;i<t;i++)u.PicAdvanceName[i]={},u.PicAdvanceName[i].FormatCtrl="",u.PicAdvanceName[i].UnKnowStr="",P["FormatStr"+(i+1)]=["PicAdvanceName",i,"FormatCtrl"],P["UnknowStr"+(i+1)]=["PicAdvanceName",i,"UnKnowStr"];if(Utils.LAPI_FormToCfg("frmSetup",u,o,P),u.ElementNum=t,r||!Utils.isObjectEquals(u,g)){for(r&&(u.RSAPublicKey={},u.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,u.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,u.BaseCfg.ServerPassword=Utils.encrypting(s("#Password").val(),Frame.RSAKey)),i=0;i<t;i++)undefined==u.PicAdvanceName[i].FormatCtrl&&(u.PicAdvanceName[i].FormatCtrl=""),undefined==u.PicAdvanceName[i].UnKnowStr&&(u.PicAdvanceName[i].UnKnowStr="");Utils.LAPI_SetCfgData(LAPI_URL.PictureFTP,u,!1,this.callback)}else Frame.showMsg(!0,s.lang.tip.tipAnyChangeInfo,0)}else Utils.LAPI_FormToCfg("frmSetup",u,o,P),r||!Utils.isObjectEquals(u,g)?(r&&(u.RSAPublicKey={},u.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,u.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,u.PIN=Utils.encrypting(s("#Password").val(),Frame.RSAKey)),v==e&&0!=p[e-1].type||1==e?e-=1:e-=2,a&&28!=p[e].type?alert(s.lang.pub.fileNameTip):Utils.LAPI_SetCfgData(LAPI_URL.FTP_Cfg,u,!1,this.callback)):Frame.showMsg(!0,s.lang.tip.tipAnyChangeInfo,0)},callback:function(e){ResultCode.RESULT_CODE_SUCCEED==e?(r&&(delete u.RSAPublicKey,0!=Menu.pageType||Capinfo.isSupportIvaPark?delete u.BaseCfg.ServerPassword:delete u.PIN),g=Utils.objectClone(u),r=!1,s("#Password").val(t),Frame.showMsg(!0)):ResultCode.RESULT_RASPUBLICKEY_AUTH_ERR==e?(e={},Utils.LAPI_GetCfgData(LAPI_URL.SecurityRSA,e)&&(setMaxDigits(130),Frame.RSAPublicKeyE=e.RSAPublicKeyE,Frame.RSAPublicKeyN=e.RSAPublicKeyN,Frame.RSAKey=new RSAKeyPair(Frame.RSAPublicKeyE,"",Frame.RSAPublicKeyN),u.RSAPublicKey={},u.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,u.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,0!=Menu.pageType||Capinfo.isSupportIvaPark?(u.BaseCfg.ServerPassword=Utils.encrypting(s("#Password").val(),Frame.RSAKey),Utils.LAPI_SetCfgData(LAPI_URL.PictureFTP,u,!1,Config.ftpPage.callback)):(u.PIN=Utils.encrypting(s("#Password").val(),Frame.RSAKey),Utils.LAPI_SetCfgData(LAPI_URL.FTP_Cfg,u,!1,Config.ftpPage.callback)))):Frame.showMsg(!1,s.lang.tip.tipSetCfgFail)},release:function(){delete Config.ftpPage},picTab_click:function(){s(".sectionDiv").addClass("hidden");var e=s(this).attr("data-divID");s("#"+e).removeClass("hidden"),s(".tab_selected").removeClass("tab_selected"),s(this).addClass("tab_selected")},toggleFgSignal:function(e){var a=s("#"+e+" option:selected"),t=s("#BreakChar"),i=s("#EpBreakChar"),r=s("#"+e).val();o[e]=r,"fgSignal"==e?(s.lang.pub.custom==r?(t.removeClass("hidden"),t.val("")):(t.addClass("hidden"),t.val(a.text())),t.trigger("change"),t.trigger("blur")):(s.lang.pub.custom==r?(i.removeClass("hidden"),i.val("")):(i.addClass("hidden"),i.val(a.text())),i.trigger("change"),i.trigger("blur"))},changeMapToPassVehiclelList:function(){n=[];for(var e=0;e<b;e++){var a={};a.type=o["PassVehiclePathType"+e],a.name=o["PassVehiclePathName"+e],n.push(a)}},changeMapToIllegalPicList:function(){l=[];for(var e=0;e<b;e++){var a={};a.type=o["IllegalPathType"+e],a.name=o["IllegalPathName"+e],l.push(a)}},changeMapToPicNameRuleList:function(){p=[];for(var e=0;e<v;e++){var a={};if(a.type=o["PicNameRulePathType"+e],a.name=o["PicNameRulePathName"+e],0==a.type){for(var t=e;t<v;t++)o["PicNameRulePathType"+t]=0,o["PicNameRulePathName"+t]="";break}p.push(a)}e<v&&p.push({type:0,name:""})},changeMapToEpPicNameRuleList:function(){d=[];for(var e=0;e<v;e++){var a={};if(a.type=o["EpPicNameRulePathType"+e],a.name=o["EpPicNameRulePathName"+e],0==a.type){for(var t=e;t<v;t++)o["EpPicNameRulePathType"+t]=0,o["EpPicNameRulePathName"+t]="";break}d.push(a)}e<v&&d.push({type:0,name:""})},createRuleOption:function(){var e,a,t,i="";if(0<c.length)for(e=0,a=c.length;e<a;e++)i+="<option value='"+(t=c[e])+"'>"+f[t]+"</option>";else if(Capinfo.isSupportCapture)for(Capinfo.isSupportPTZ||f.splice(51,4),e=0,a=f.length;e<a;e++)""!=f[e]&&(i+="<option value='"+e+"'>"+f[e]+"</option>");else for(e=0,a=(c=Capinfo.isSupportPTZ?[0,1,2,3,4,28,30,31,32,33,34,35,36,50,51,52,53,54]:[0,1,2,3,4,28,30,31,32,33,34,35,36,50]).length;e<a;e++)i+="<option value='"+(t=c[e])+"'>"+f[t]+"</option>";return i},saveParam:function(e){var a=s("#"+e);"checkbox"==a.attr("type")?o[e]=Number(a.is(":checked")):o[e]=a.val()},fullmappingMap:function(){for(var e=0;e<u.PicName.PicNameElement.length;e++)P["PicNameRulePathType"+e]=["PicName","PicNameElement",e,"PathType"],P["PicNameRulePathName"+e]=["PicName","PicNameElement",e,"Path"];for(e=0;e<u.EPPicName.PicNameElement.length;e++)P["EpPicNameRulePathType"+e]=["EPPicName","PicNameElement",e,"PathType"],P["EpPicNameRulePathName"+e]=["EPPicName","PicNameElement",e,"Path"];for(e=0;e<u.PhotoPath.length;e++)P["PassVehiclePathType"+e]=["PhotoPath",e,"PathType"],P["PassVehiclePathName"+e]=["PhotoPath",e,"Path"];for(e=0;e<u.EPPhotoPath.length;e++)P["IllegalPathType"+e]=["EPPhotoPath",e,"PathType"],P["IllegalPathName"+e]=["EPPhotoPath",e,"Path"];for(e=0;e<u.ElementNum;e++)P["FormatStr"+(e+1)]=["PicAdvanceName",e,"FormatCtrl"],P["UnknowStr"+(e+1)]=["PicAdvanceName",e,"UnKnowStr"]},validBreakChar:function(e){return!/[:\*\?\|\/\\"<>]/g.test(e)},validFormatStr:function(e){return/^[^/\\:\*\?<>\|"]{1,16}<(\([^/\\:\*\?<>\|"]\)\d{1,}){0,1}%(\d{1,}\([^/\\:\*\?<>\|"]\)){0,1}>[^\?/\\:\*<>\|"]{1,16}$/.test(e)||""==e},initPicRuleTable:function(){var e=s("#picNameRule");e.empty();for(var a=this.createRuleOption(),t=0,i=p.length;t<i;t++){var r="<tr><td>"+(t+1)+"</td><td><div id='InfoDiv"+t+"'><input type='text' class='absoluteDiv hidden' id='PicNameRulePathName"+t+"' maxlength='10' style='width: 150px;position: absolute;' onchange='Config.ftpPage.savePicName("+t+")'><select id='PicNameRulePathType"+t+"' style='width:180px' onchange='Config.ftpPage.editInfo("+t+")' onblur=''>"+a+"</select></div></td><td><input type='text' id='FormatStr"+(t+1)+"' name='FormatStr"+(t+1)+"' class='middleTxt hidden' maxlength='32' onchange='Config.ftpPage.saveParam(this.id)'><input type='text' id='UnknowStr"+(t+1)+"' name='UnknowStr"+(t+1)+"' class='shortTxt hidden' maxlength='9' onchange='Config.ftpPage.saveParam(this.id)'>&nbsp;</td></tr>";e.append(r)}for(;t<v;t++)e.append(r="<tr><td>"+(t+1)+"</td><td>&nbsp;</td><td>&nbsp;</td></tr>");Utils.cfgToForm(o,"frmSetup");for(var n=0;n<p.length;n++)1==p[n].type&&s("#PicNameRulePathName"+n).removeClass("hidden");this.showPicName()},initEpPicRuleTable:function(){var e=s("#epPicNameRule");e.empty();for(var a=this.createRuleOption(),t=0,i=d.length,r=p.length;t<i;t++,r++){var n="<tr><td>"+(t+1)+"</td><td><div id='InfoDiv"+t+"'><input type='text' class='absoluteDiv hidden' id='EpPicNameRulePathName"+t+"' maxlength='10' style='width: 150px;position: absolute;' onchange='Config.ftpPage.saveEpPicName("+t+")'><select id='EpPicNameRulePathType"+t+"' style='width:180px' onchange='Config.ftpPage.editEpInfo("+t+")' onblur=''>"+a+"</select></div></td><td><input type='text' id='FormatStr"+(r+1)+"' name='FormatStr"+(r+1)+"' class='middleTxt hidden' maxlength='32' onchange='Config.ftpPage.saveParam(this.id)'><input type='text' id='UnknowStr"+(r+1)+"' name='UnknowStr"+(r+1)+"' class='shortTxt hidden' maxlength='9' onchange='Config.ftpPage.saveParam(this.id)'>&nbsp;</td></tr>";e.append(n)}for(;t<v;t++)e.append(n="<tr><td>"+(t+1)+"</td><td>&nbsp;</td><td>&nbsp;</td></tr>");Utils.cfgToForm(o,"frmSetup");for(var l=0;l<d.length;l++)1==d[l].type&&s("#EpPicNameRulePathName"+l).removeClass("hidden");this.showEpPicName()},refreshPassVehicleOption:function(){for(var e=0,e=0;e<b;e++)1==n[e].type?0!=e&&0==n[e-1].type||s("#PassVehiclePathName"+e).removeClass("hidden"):s("#PassVehiclePathName"+e).addClass("hidden");this.showDir("PassVehicle")},refreshIllegalOption:function(){for(var e=0,e=0;e<b;e++)1==l[e].type?0!=e&&0==l[e-1].type||s("#IllegalPathName"+e).removeClass("hidden"):s("#IllegalPathName"+e).addClass("hidden");this.showDir("Illegal")},showAdvancedParam:function(){for(var e=s("#FormatStrEnable").is(":checked"),a=p.length,t=p.length+d.length,i=1;i<t;i++)a!=i&&(e?(s("#FormatStr"+i).removeClass("hidden"),s("#UnknowStr"+i).removeClass("hidden")):(s("#FormatStr"+i).addClass("hidden"),s("#UnknowStr"+i).addClass("hidden")))},savePicName:function(e){var a="PicNameRulePathName"+e,t=s("#"+a).val();if(!this.validBreakChar(t))return alert(s.lang.tip.inputErr+s.lang.tip.tipFTPNameErr),void s("#"+a).val(o[a]);o["PicNameRulePathName"+e]=t,Config.ftpPage.changeMapToPicNameRuleList(),Config.ftpPage.showPicName()},editInfo:function(e){var a=s("#PicNameRulePathType"+e),t=a.val(),i=p.length,r=Utils.objectClone(o);o["PicNameRulePathType"+e]=t,this.changeMapToPicNameRuleList();for(var t=p.length,n=p.length+d.length,l=t+1;l<n;l++,i++)o["FormatStr"+l]=r["FormatStr"+(i+1)],o["UnknowStr"+l]=r["UnknowStr"+(i+1)];o["FormatStr"+t]="",o["UnknowStr"+t]="",this.initPicRuleTable(),this.initEpPicRuleTable();e=s("#PicNameRulePathName"+e);1==a.val()?(e.removeClass("hidden"),e.focus()):e.addClass("hidden"),this.showPicName(),this.showAdvancedParam(),this.initValidator()},showPicName:function(){var e=s.lang.pub.fileName,a=s("#BreakChar").val();o.BreakSign=""==a?a:a.charCodeAt(0),s("#BreakSign").val(o.BreakSign);for(var t=0;t<p.length;t++){var i=p[t].type;if(0==i)break;e+=1==i?"["+p[t].name+"]"+a:"["+f[i]+"]"+a}""!=a&&s.lang.pub.fileName!=e&&(e=e.substring(0,e.length-1)),1<p.length&&(e+=".jpg"),s("#flieName").text(e)},editEpInfo:function(e){var a=s("#EpPicNameRulePathType"+e),t=a.val();o["EpPicNameRulePathType"+e]=t,this.changeMapToEpPicNameRuleList(),this.initEpPicRuleTable();e=s("#EpPicNameRulePathName"+e);1==a.val()?(e.removeClass("hidden"),e.focus()):e.addClass("hidden"),this.showEpPicName(),this.showAdvancedParam(),this.initValidator()},saveEpPicName:function(e){var a="EpPicNameRulePathName"+e,t=s("#"+a).val();if(!this.validBreakChar(t))return alert(s.lang.tip.inputErr+s.lang.tip.tipFTPNameErr),void s("#"+a).val(o[a]);o["EpPicNameRulePathName"+e]=s("#EpPicNameRulePathName"+e).val(),this.changeMapToEpPicNameRuleList(),this.showEpPicName()},showEpPicName:function(){var e=s.lang.pub.fileName,a=s("#EpBreakChar").val();o.EpBreakSign=""==a?a:a.charCodeAt(0),s("#EpBreakSign").val(o.EpBreakSign);for(var t=0;t<d.length;t++){var i=d[t].type;if(0==i)break;e+=1==i?"["+d[t].name+"]"+a:"["+f[i]+"]"+a}""!=a&&s.lang.pub.fileName!=e&&(e=e.substring(0,e.length-1)),1<d.length&&(e+=".jpg"),s("#EpFlieName").text(e)},showDir:function(e){for(var a=s.lang.pub.ftpPath,t=0,i=0;i<b;i++){if(0==o[e+"PathType"+i]){for(t=i;t<b;t++)s("#"+e+"PathType"+t).val(0),o[e+"PathType"+t]=0,s("#"+e+"PathName"+t).val(""),o[e+"PathName"+t]="",s("#"+e+"PathName"+t).addClass("hidden");break}a+=0==i?"\\\\ ":"\\ ",1==o[e+"PathType"+i]?a+=o[e+"PathName"+i]:a+="["+s("select[id='"+e+"PathType"+i+"'] option:selected").text()+"]"}s("#"+e+"Dir").text(a)},createOption:function(){var e="";if(0<h.length)for(var a=0;a<h.length;a++)e+="<option value="+(r=h[a])+">"+f[r]+"</option>";else if(Capinfo.isSupportCapture){Capinfo.isSupportPTZ||C.pop(s.lang.pub.presetNo);for(var t=0,i=C.length;t<i;t++)""!=C[t]&&(e+="<option value="+t+">"+C[t]+"</option>")}else{h=Capinfo.isSupportPTZ?[0,1,2,4,30,31,32,33,34,35,50,51]:[0,1,2,4,30,31,32,33,34,35,50];for(var r,a=0;a<h.length;a++)e+="<option value="+(r=h[a])+">"+C[r]+"</option>"}s(".ftpConfig select").append(e)},createSignalOption:function(){var e,a="",t=s("#fgSignal"),i=s("#illfgSignal");for(e in t.empty(),i.empty(),N)a+="<option value="+e+">"+N[e]+"</option>";t.append(a),i.append(a)},optionChange:function(e){if(!this.validBreakChar(s("#"+e).val()))return alert(s.lang.tip.inputErr+s.lang.tip.tipFTPNameErr),void s("#"+e).val(o[e]);o[e]=s("#"+e).val(),this.changeMapToPassVehiclelList(),this.changeMapToIllegalPicList(),this.refreshPassVehicleOption(),this.refreshIllegalOption()},initValidator:function(){var a=this;s("#Port").attr("tip",s.validator.format(s.lang.tip.tipIntRange,1,65535)),s("#FullCoverNum").attr("tip",s.validator.format(s.lang.tip.tipIntRange,1,1e5)),s("#ServerIP").attr("tip",s.lang.tip.tipIPInfo),s("#Username").attr("tip",s.lang.tip.tipUserName),s("#DeviceName").attr("tip",s.lang.tip.tipUserName),s("#RoadID").attr("tip",s.lang.tip.tipUserName),s("#DeviceID").attr("tip",s.lang.tip.tipUserName),s("#DirectID").attr("tip",s.lang.tip.tipUserName),s("#PlateID").attr("tip",s.lang.tip.tipPlateIDErr),s("#Password").attr("tip",s.lang.tip.tipCommonNamePwd),s("#EpBreakChar").attr("tip",s.lang.tip.tipFTPBreakCharErr),s("#BreakChar").attr("tip",s.lang.tip.tipFTPBreakCharErr),s.validator.addMethod("isIPAddress",function(e){return Utils.isIPAddress(e)},s.lang.tip.tipIPErr),s.validator.addMethod("validBreakChar",function(e){return a.validBreakChar(e)},s.lang.tip.tipCharFmtErr),s.validator.addMethod("checkIP1To223",function(e){return Utils.checkIP1To223(e)},s.lang.tip.tipIPRangeErr),s.validator.addMethod("checkUserName",function(e){return Utils.checkUserName(e)},s.lang.tip.tipCharFmtErr),s.validator.addMethod("checkFtpPwd",function(e){return Utils.checkCommonNamePwd(e)},s.lang.tip.tipCharFmtErr),s.validator.addMethod("validFormatStr",function(e){return a.validFormatStr(e)},s.lang.tip.tipCharFmtErr);for(var e=(m=s("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,a){var t,i="div";"EpBreakChar"!=s(a).attr("id")&&"BreakChar"!=s(a).attr("id")||(i="li"),-1==s(a).attr("id").indexOf("FormatStr")&&-1==s(a).attr("id").indexOf("UnknowStr")||(t="picNameRule",i="td"),Utils.showJqueryErr(e,a,i,t)},success:function(e){},rules:{ServerIP:{required:!0,isIPAddress:"",checkIP1To223:""},Port:{integer:!0,required:!0,range:[1,65535]},FullCoverNum:{integer:!0,required:!0,range:[1,1e5]},Username:{checkUserName:""},Password:{checkFtpPwd:""},DeviceName:{checkUserName:""},DeviceID:{checkUserName:""},RoadID:{checkUserName:""},DirectID:{checkUserName:""},PlateID:{checkFtpPwd:"",validBreakChar:""},EpBreakChar:{validBreakChar:"",checkFtpPwd:""},BreakChar:{validBreakChar:"",checkFtpPwd:""}}})).settings.rules,t=p.length+d.length,i=1;i<=t;i++){var r="FormatStr"+i;s("#"+r).attr("tip",s.lang.tip.tipFormatStrTip),e[r]={validFormatStr:""},s("#"+("UnknowStr"+i)).attr("tip",s.lang.tip.tipUnknowStrTip)}m.init()},storMode:function(){var e=s("#StorMode").is(":checked");e?s("#fileNameTip").removeClass("hidden"):s("#fileNameTip").addClass("hidden"),o.StorMode=e},isSmaller:function(){var e=s("#FullCoverNum").val();u.FullCoverNum>e?s("#FullCover").removeClass("hidden"):s("#FullCover").addClass("hidden"),o.FullCoverNum=e},checkFtpFuc:function(){m.form()&&(Frame.updateBlock(!0,s.lang.pub.Testing),setTimeout(this.ftpTest,400))},ftpTest:function(){var e=Utils.objectClone(u),a=Utils.objectClone(o);Utils.LAPI_FormToCfg("frmSetup",e,a,P),r&&(e.RSAPublicKey={},e.RSAPublicKey.RSAPublicKeyE=Frame.RSAPublicKeyE,e.RSAPublicKey.RSAPublicKeyN=Frame.RSAPublicKeyN,e.PIN=Utils.encrypting(s("#Password").val(),Frame.RSAKey)),Utils.LAPI_SetCfgData(LAPI_URL.FTPTest,e,!1,Config.ftpPage.ftpCallBack)},ftpCallBack:function(e){Frame.updateBlock(!1),ResultCode.RESULT_CODE_SUCCEED==e?Config.ftpPage.showResult("testFtpDiv",!0,s.lang.tip.tipTestSuccess):ResultCode.RESULT_FTP_SERVER_ERR==e?Config.ftpPage.showResult("testFtpDiv",!1,s.lang.tip.tipFTPServerErr):ResultCode.RESULT_FTP_USER_ERR==e?Config.ftpPage.showResult("testFtpDiv",!1,s.lang.tip.tipFTPUserErr):ResultCode.RESULT_FTP_CONTENT_ERR==e?Config.ftpPage.showResult("testFtpDiv",!1,s.lang.tip.tipFTPContentErr):ResultCode.RESULT_FTP_WRITE_ERR==e?Config.ftpPage.showResult("testFtpDiv",!1,s.lang.tip.tipFTPwriteErr):Config.ftpPage.showResult("testFtpDiv",!1,s.lang.tip.tipTestErr)},showResult:function(e,a,t){a?s("#"+e+" a").removeClass("fail").addClass("success"):s("#"+e+" a").removeClass("success").addClass("fail"),s("#"+e+" span").text(t),s("#"+e).removeClass("hidden")},initPwdChanged:function(e){r||(s("#"+e).val(""),r=!0)}}))}(jQuery),Frame.currentNameSpace=Config.ftpPage;