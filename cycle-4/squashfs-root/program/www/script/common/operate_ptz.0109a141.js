Config.OperatePtz=function(P){var T=null,r={},i={},R={},M={},p=Capinfo.serialModeArr,l=Capinfo.serialIDArr,C=Capinfo.serialTypeArr,g=l.length,A=["",P.lang.pub.PTZControl,P.lang.pub.biDirectTransChannel,"","","",P.lang.pub.detectorS,P.lang.pub.radarC,P.lang.pub.laser,P.lang.pub.pcBoxAlarm,P.lang.pub.trafficLightS,P.lang.pub.radarA,P.lang.pub.osdLayout,P.lang.pub.radarH,P.lang.pub.detectorQ,P.lang.pub.radarCController,P.lang.pub.localPTZController,"RFID",P.lang.pub.detectorU,P.lang.pub.trafficLightU,P.lang.pub.radarW,P.lang.pub.radarZ,P.lang.pub.switchKND,P.lang.pub.trafficLightQ,P.lang.pub.radarH2,P.lang.pub.trafficLightY,P.lang.pub.radarAD,P.lang.pub.radarA2,P.lang.pub.trafficLightC,P.lang.pub.weighingXK,P.lang.pub.weighingDS,P.lang.pub.radarLD,P.lang.pub.onfivTransChannel,P.lang.pub.detectorX,P.lang.pub.trafficLightB,P.lang.pub.nettrafficLight,P.lang.pub.radarS,P.lang.pub.detectorH2,P.lang.pub.isMode,P.lang.pub.FSCapture,P.lang.pub.weighingDS1,P.lang.pub.soundPickUp,P.lang.pub.sensorControl,P.lang.pub.radarJZ,"",P.lang.pub.radarDH,P.lang.pub.weighingYH,P.lang.pub.radarH2S,P.lang.pub.detectorD,P.lang.pub.trafficLightDW,P.lang.pub.radarHC,P.lang.pub.HCRadar],o={},t={},d={},n={},S={},s={},f={},I={},u={Serial1PtzAddressCode:["Addr"],Serial1PtzFactoryName:["PtzFactoryName"],Serial1PtzMode:["PtzMode"]},b={},L={},c={Serial1OSDReport:["Enable"]};return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initValidator(),this.initEvent(),this.initData();var e=P("#Serial1SerialMode");1==e.find("option").length&&SerialMode.PTZ==e.val()&&Utils.disableAll(),Utils.afterDataLoad()},initPage:function(){for(var e,a,r,i,l="",o="",t=0,d=0,n=P("#frmSetup"),S=n.html(),s=1;s<g;s++)o=S.replace(/Serial1/g,"Serial"+(s+1)),n.append(o);for(s=0;s<p.length;s++){for(l="",i=P("#"+(o="Serial"+(s+1))+"SerialMode"),"RS485"==C[s]?P("#"+o+"Fieldset legend").html("RS485_"+ ++t):"RS232"==C[s]&&P("#"+o+"Fieldset legend").html("RS232_"+ ++d),i.empty(),e=0,a=p[s].length;e<a;e++)r=p[s][e],SerialMode.ISMode==r&&(A[r]=P.lang.pub.isMode),l+="<option value='"+r+"'>"+A[r]+"</option>";i.append(l)}},initData:function(){var e,a;for(o={},d={},S={},s={},e=0;e<g;e++)S["Serial"+(e+1)+"BaudRate"]=["SingSerialCfg",e,"SerialCfg","SerialParam","BaudRate"],S["Serial"+(e+1)+"DataBit"]=["SingSerialCfg",e,"SerialCfg","SerialParam","DataBit"],S["Serial"+(e+1)+"StopBit"]=["SingSerialCfg",e,"SerialCfg","SerialParam","StopBit"],S["Serial"+(e+1)+"Parity"]=["SingSerialCfg",e,"SerialCfg","SerialParam","Parity"],S["Serial"+(e+1)+"Flowcontrol"]=["SingSerialCfg",e,"SerialCfg","SerialParam","FlowCtrl"],S["Serial"+(e+1)+"SerialMode"]=["SingSerialCfg",e,"SerialCfg","SerialMode"],S["Serial"+(e+1)+"ChannelID"]=["SingSerialCfg",e,"ChannelID"],s["Serial"+(e+1)+"ChannelID"]=["SingTransPortCfg",e,"ChannelID"],s["Serial"+(e+1)+"Enable"]=["SingTransPortCfg",e,"TransPortCfg","Enable"],s["Serial"+(e+1)+"SerialID"]=["SingTransPortCfg",e,"TransPortCfg","SerialID"],s["Serial"+(e+1)+"TransMode"]=["SingTransPortCfg",e,"TransPortCfg","TransMode"],s["Serial"+(e+1)+"LocalAddr"]=["SingTransPortCfg",e,"TransPortCfg","LocalAddr","IPAddr"],s["Serial"+(e+1)+"LocalPort"]=["SingTransPortCfg",e,"TransPortCfg","LocalAddr","Port"],s["Serial"+(e+1)+"PeerAddr"]=["SingTransPortCfg",e,"TransPortCfg","PeerAddr","IPAddr"],s["Serial"+(e+1)+"PeerPort"]=["SingTransPortCfg",e,"TransPortCfg","PeerAddr","Port"];if(Utils.LAPI_GetCfgData(LAPI_URL.SerialCfg,o)&&Utils.LAPI_GetCfgData(LAPI_URL.SerialTrans,d)){if(!Utils.LAPI_GetCfgData(LAPI_URL.SerialOSDReport,b))return Utils.disableAll(),!1;if(L=Utils.objectClone(b),Utils.LAPI_CfgToForm("frmSetup",b,M,c),Capinfo.isSupportPTZ){if(f={},!Utils.LAPI_GetCfgData(LAPI_URL.LAPI_PTZCfg,f))return void Utils.disableAll();I=Utils.objectClone(f),Utils.LAPI_CfgToForm("frmSetup",f,R,u)}if(t=Utils.objectClone(o),n=Utils.objectClone(d),Utils.LAPI_CfgToForm("frmSetup",o,r,S),Utils.LAPI_CfgToForm("frmSetup",d,i,s),Capinfo.isSupportTransMode)for(e=1;e<=g;e++)P("#"+(a="Serial"+e)+"TransModeTR").removeClass("hidden"),"2"==i[a+"TransMode"]&&(P("#"+a+"LocalAddr").parent().addClass("hidden"),P("#"+a+"LocalPort").parent().addClass("hidden"));for(e=0;e<g;e++)this.changePtzMode("Serial"+(e+1)+"SerialMode"),this.enableTransPort("Serial"+(e+1)+"Enable")}else Utils.disableAll()},initEvent:function(){for(var e,a=this,r=0;r<g;r++)P("#"+(e="Serial"+(r+1))+"SerialMode").bind("change",function(){a.changePtzMode(this.id)}),P("#"+e+"TransMode").bind("change",function(){a.changeTransMode(this.id)})},submitF:function(){if(T.form()&&this.validateSerialMode()){for(var e=P("#Serial1Enable").is(":checked"),a=0;a<g;a++)l[a];if(!e||this.submitSerialPtzCfg()){if(Utils.LAPI_FormToCfg("frmSetup",d,i,s),!Utils.isObjectEquals(d,n)||Number(e)!=i.Serial1Enable){if(!Utils.LAPI_SetCfgData(LAPI_URL.SerialTrans,d))return;n=Utils.objectClone(d)}(e||this.submitSerialPtzCfg())&&(Utils.LAPI_FormToCfg("frmSetup",b,M,c),!Utils.isObjectEquals(b,L)&&Utils.LAPI_SetCfgData(LAPI_URL.SerialOSDReport,b)&&(L=Utils.objectClone(b)))}}},release:function(){Frame.currentNameSpace="",delete Config.OperatePtz},initValidator:function(){P("#Serial1PtzAddressCode").attr("tip",P.validator.format(P.lang.tip.tipIntRange,0,255)),P.validator.addMethod("isIPAddress",function(e){return Utils.isIPAddress(e)},P.lang.tip.tipIPErr),P.validator.addMethod("checkIP1To223",function(e){return Utils.checkIP1To223(e)},P.lang.tip.tipIPRangeErr);for(var e=(T=P("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,a){Utils.showJqueryErr(e,a,"div")},success:function(){},rules:{Serial1PtzAddressCode:{integer:!0,required:!0,range:[0,255]}}})).settings.rules,a=0;a<g;a++){var r="Serial"+(a+1)+"LocalAddr";P("#"+r).attr("tip",P.lang.tip.tipIPInfo),e[r]={required:!0,isIPAddress:"",checkIP1To223:""},P("#"+(r="Serial"+(a+1)+"LocalPort")).attr("tip",P.validator.format(P.lang.tip.tipIntRange,1025,65535)),e[r]={integer:!0,required:!0,range:[1025,65535]},P("#"+(r="Serial"+(a+1)+"PeerPort")).attr("tip",P.validator.format(P.lang.tip.tipIntRange,1025,65535)),e[r]={integer:!0,required:!0,range:[1025,65535]}}T.init()},enableTransPort:function(e){var a=e.replace("Enable","Table");P("#"+e).is(":checked")?P("#"+a).removeClass("hidden"):P("#"+a).addClass("hidden"),T.init()},changePtzProtocol:function(e){var a=!1,r=P("#"+e+"PtzMode");"INTERNAL-PTZ"==P("#"+e+"PtzFactoryName").val()&&(a=!0,r.val(0)),P("#"+e+"BaudRate").prop("disabled",a),P("#"+e+"DataBit").prop("disabled",a),P("#"+e+"StopBit").prop("disabled",a),P("#"+e+"Parity").prop("disabled",a),P("#"+e+"Flowcontrol").prop("disabled",a),r.prop("disabled",a),P("#"+e+"PtzAddressCode").prop("disabled",a)},changePtzFactoryName:function(e,a){if(SerialMode.PTZ==e||SerialMode.LOCALPTZ==e){var r="",i="",a=P("#"+a+"PtzFactoryName"),l=a.val();a.empty();for(var o=SerialMode.PTZ==e?["INTERNAL-PTZ","PELCO-D","PELCO-P","ALEC","VISCA","ALEC_PELCO-D","ALEC_PELCO-P","MINKING_PELCO-D","MINKING_PELCO-P","YAAN"]:["PELCO-D","Private-KR","PELCO-P"],t=0;t<o.length;t++)r+="<option value='"+o[t]+"'>"+o[t]+"</option>",l==o[t]&&(i=l);a.append(r),""!=i&&a.val(i)}},changePtzMode:function(e){var a=e.replace("SerialMode",""),r=P("#"+e).val(),i=P("#Serial1OSDReport"),l=P("#"+a+"ptzModeTR"),o=P("#"+a+"protocolName"),t=P("#"+a+"protocolAddr"),d=P("#"+a+"PtzMode"),n=P("#"+a+"PtzFactoryName"),S=P("#"+a+"PtzAddressCode"),s=P("#"+a+"BaudRate"),p=P("#"+a+"DataBit"),C=P("#"+a+"StopBit"),g=P("#"+a+"Parity"),e=P("#"+a+"Flowcontrol");if("Serial1"==a&&i.parent().parent().addClass("hidden"),i.val(M.SerialOSDReport),this.changePtzFactoryName(r,a),SerialMode.PTZ==r)l.removeClass("hidden"),o.removeClass("hidden"),t.removeClass("hidden"),n.prop("disabled",!1),this.changePtzProtocol(a);else if(SerialMode.LOCALPTZ==r)l.addClass("hidden"),o.removeClass("hidden"),t.removeClass("hidden"),d.prop("disabled",!0),n.prop("disabled",!1),S.prop("disabled",!1),s.prop("disabled",!1),p.prop("disabled",!1),C.prop("disabled",!1),g.prop("disabled",!1),e.prop("disabled",!1);else{if(l.addClass("hidden"),o.addClass("hidden"),t.addClass("hidden"),d.prop("disabled",!0),n.prop("disabled",!0),S.prop("disabled",!0),SerialMode.TRANS==r||SerialMode.OSDLAYOUT==r||SerialMode.ONVIF_TRANS==r)s.prop("disabled",!1),p.prop("disabled",!1),C.prop("disabled",!1),g.prop("disabled",!1),e.prop("disabled",!1),SerialMode.OSDLAYOUT==r&&i.parent().parent().removeClass("hidden");else if(SerialMode.ISMode==r){for(var A=["BaudRate","DataBit","StopBit","Parity","Flowcontrol"],f=A.length-1;0<=f;f--)P("#"+a+A[f]).prop("disabled",!0);s.prop("disabled",!1),p.prop("disabled",!0),C.prop("disabled",!0),g.prop("disabled",!0),e.prop("disabled",!0)}else SerialMode.VEHICLE_DETECTOR_S!=r&&SerialMode.RADAR_C!=r&&SerialMode.LASER!=r&&SerialMode.CASEALARM!=r&&SerialMode.TRAFFICLIGHT!=r&&SerialMode.RADAR_A!=r&&SerialMode.RADAR_H!=r&&SerialMode.RADAR_H2!=r&&SerialMode.RADAR_Z!=r&&SerialMode.VEHICLE_DETECTOR_Q!=r&&SerialMode.RADAR_C_CONTROLLER!=r&&SerialMode.RFID!=r&&SerialMode.VEHICLE_DETECTOR_U!=r&&SerialMode.TRAFFICLIGHT_U!=r&&SerialMode.TRAFFICLIGHT_Y!=r&&SerialMode.RADAR_W!=r&&SerialMode.TRAFFICLIGHT_Q!=r&&SerialMode.SWITCHVALUE_TO_485!=r&&SerialMode.RADAR_AD!=r&&SerialMode.TRAFFICLIGHT_B!=r&&SerialMode.RADAR_A2!=r&&SerialMode.TRAFFICLIGHT_CONTROLLER!=r&&SerialMode.WEIGHING_XK!=r&&SerialMode.WEIGHING_DS!=r&&SerialMode.RADAR_LD!=r&&SerialMode.VEHICLE_DETECTOR_X!=r&&SerialMode.TRAFFICLIGHT_NET!=r&&SerialMode.RADAR_S!=r&&SerialMode.VEHICLE_DETECTOR_H2!=r&&SerialMode.FS_CAPTURE!=r&&SerialMode.WEIGHING_DS1!=r&&SerialMode.SOUNDPICKUP!=r&&SerialMode.RADAR_DH!=r&&SerialMode.RADAR_JZ!=r&&SerialMode.WEIGHING_YH!=r&&SerialMode.RADAR_H2S!=r&&SerialMode.VEHICLE_DETECTOR_D!=r&&SerialMode.TRAFFICLIGHT_DW!=r||(s.prop("disabled",!0),p.prop("disabled",!0),C.prop("disabled",!0),g.prop("disabled",!0),e.prop("disabled",!0),SerialMode.VEHICLE_DETECTOR_S==r||SerialMode.CASEALARM==r||SerialMode.VEHICLE_DETECTOR_U==r||SerialMode.VEHICLE_DETECTOR_D==r?s.val(19200):SerialMode.RADAR_C==r||SerialMode.RADAR_A==r||SerialMode.RADAR_H==r||SerialMode.RADAR_H2==r||SerialMode.RADAR_Z==r||SerialMode.RADAR_C_CONTROLLER==r||SerialMode.TRAFFICLIGHT==r||SerialMode.TRAFFICLIGHT_U==r||SerialMode.RADAR_W==r||SerialMode.SWITCHVALUE_TO_485==r||SerialMode.RADAR_AD==r||SerialMode.RADAR_A2==r||SerialMode.TRAFFICLIGHT_CONTROLLER==r||SerialMode.VEHICLE_DETECTOR_X==r||SerialMode.TRAFFICLIGHT_NET==r||SerialMode.RADAR_S==r||SerialMode.VEHICLE_DETECTOR_H2==r||SerialMode.FS_CAPTURE==r||SerialMode.RADAR_DH==r||SerialMode.RADAR_JZ==r||SerialMode.WEIGHING_YH==r||SerialMode.RADAR_H2S==r?s.val(9600):SerialMode.VEHICLE_DETECTOR_Q==r||SerialMode.TRAFFICLIGHT_Q==r||SerialMode.TRAFFICLIGHT_Y==r||SerialMode.TRAFFICLIGHT_B==r||SerialMode.RFID==r||SerialMode.TRAFFICLIGHT_DW==r?s.val(38400):SerialMode.WEIGHING_XK==r||SerialMode.WEIGHING_DS==r||SerialMode.WEIGHING_DS1==r?s.val(4800):SerialMode.RADAR_LD==r?s.val(57600):s.val(115200),SerialMode.SOUNDPICKUP!=r&&SerialMode.WEIGHING_YH!=r||(P("#"+a+"DataBit").val(8),P("#"+a+"StopBit").val(1),P("#"+a+"Flowcontrol").val(0)),SerialMode.WEIGHING_YH==r?(P("#"+a+"DataBit").val(8),P("#"+a+"StopBit").val(1),P("#"+a+"Parity").val(2),P("#"+a+"Flowcontrol").val(0)):P("#"+a+"Parity").val(0));S.val(R[a+"PtzAddressCode"]),T.form()}Capinfo.isSupportNoPtzMode&&P("#Serial1ptzModeTR").addClass("hidden"),Capinfo.isSupportCapture||this.changeSerialEnable(a)},changeTransMode:function(e){var a=e.replace("TransMode",""),e=P("#"+e+" option:selected").text();"TCP"==e?(P("#"+a+"LocalAddr").parent().addClass("hidden"),P("#"+a+"LocalPort").parent().addClass("hidden")):"UDP"==e&&(P("#"+a+"LocalAddr").parent().removeClass("hidden"),P("#"+a+"LocalPort").parent().removeClass("hidden"))},validateSerialMode:function(){for(var e=0,a=0;a<g;a++){var r=P("#Serial"+(a+1)+"SerialMode").val();10!=r&&19!=r&&25!=r&&23!=r&&34!=r&&35!=r||e++}return!(1<e)||(alert(P.lang.tip.tipSerialModeSameErr),!1)},changeSerialEnable:function(e){var a=P("#"+e+"Enable");2==P("#"+e+"SerialMode").val()?a.prop("disabled",!1):(P("#"+e+"Table").addClass("hidden"),a.prop("checked",!1),a.prop("disabled",!0))},submitSerialPtzCfg:function(){Utils.LAPI_FormToCfg("frmSetup",o,r,S),Utils.LAPI_FormToCfg("frmSetup",f,R,u);var e=!Utils.isObjectEquals(o,t),a=!Utils.isObjectEquals(f,I);if(e||a){if(!Utils.LAPI_SetCfgData(LAPI_URL.SerialCfg,o))return!1;if(t=Utils.objectClone(o),Capinfo.isSupportPTZ){if(!Utils.LAPI_SetCfgData(LAPI_URL.LAPI_PTZCfg,f))return!1;I=Utils.objectClone(f)}}return!0}}))}(jQuery),Frame.currentNameSpace=Config.OperatePtz;