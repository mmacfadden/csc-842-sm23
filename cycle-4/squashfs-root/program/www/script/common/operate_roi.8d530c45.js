Config.OperateRoi=function(n){var o,s=[],i=0,l={},r={},d={},c=LAPI_URL.ROI,h=["CC66FF","FF6633","0099FF","339933","CC0033","6666CC","FFFF66","99CC00"],a=null,u=DrawType.RECT;return new(Class.extend({init:function(){Utils.beforeDataLoad(),Utils.initLang(),this.initPage(),this.initEvent(),this.initData(),Utils.initVideo("recordManager_div_activeX",StreamType.LIVE,RunMode.CONFIG,null,Capinfo.isSupportPTZ,this.initVideo_callback),Utils.afterDataLoad()},initPage:function(){n("#add").attr("title",n.lang.pub.add),Utils.resetVideoSize(StreamID.MAIN_VIDEO,"recordManager_div_activeX"),Capinfo.isSupport4KFishEye&&(PlayPtzMode.PLAYER_FISH_LEFT_4PTZ==Variables.PlayMode?(n("#FishEyeVideoModeDiv").removeClass("hidden"),n(".areaList").addClass("marginTop"),n("#FishEyePanoramaModeDiv").remove()):LensPlayMode.PLAYER_PANORAMA==Variables.PlayMode&&(n("#FishEyeVideoModeDiv").remove(),n(".areaList").addClass("marginTop"),n("#FishEyePanoramaModeDiv").removeClass("hidden")))},initData:function(){var e,t=parseInt(n("#FishEyeVideoMode").val()),a={};for(r={},Capinfo.isSupport4KFishEye&&LensPlayMode.PLAYER_ORIGINAL!=Variables.PlayMode&&(i=t),c=LAPI_URL.ROI+"/"+i,Utils.LAPI_GetCfgData(c,r)||(Utils.disableAll(),Frame.showMsg(!1,n.lang.tip.tipGetCfgFail)),d=Utils.objectClone(r),o=Capinfo.RoiAreaNum,s=r.AreaInfos,e=0;e<o;e++)this.changeDataMap(s[e].Area,a,0),this.correctPos(a,100,"left","topX","right","bottom"),this.changeDataMap(s[e].Area,a,1);this.initAreaList()},initEvent:function(){var e=this;n("#add").bind("click",function(){e.addArea(),this.blur()}),n("#FishEyeVideoMode").bind("change",function(){return e.changeROIChannel()})},submitF:function(){var e;return r.AreaInfos=s,!Utils.isObjectEquals(r,d)?(e=Utils.LAPI_SetCfgData(c,r))&&(d=Utils.objectClone(r)):Frame.showMsg(!0,n.lang.tip.tipAnyChangeInfo,0),e},release:function(){Utils.EnableDrawFun(StreamType.LIVE,0),Frame.hiddenVideo(),Frame.currentNameSpace="",delete Config.OperateRoi},changeROIChannel:function(){var e=n("#FishEyeVideoMode").val();this.initData(),Video.stopVideo(StreamType.LIVE,0),Video.getCurVideoFormat(e),isOldPlugin?Video.startVideo(StreamType.LIVE,e):Video.startVideo(e),Video.setRenderScale(StreamType.LIVE,0),Utils.EnableDrawFun(StreamType.LIVE,1),this.initRoiDrawObjData()},showArea:function(){for(var e=0,t=0;t<o;t++)e=0,1==s[t].Enable&&(e=1),Utils.showHiddenArea(u,t,e)},correctPos:function(e,t,a,i,r,o){var n=Video.videoWidth,s=Video.videoHeight,l=0,d=!0;return e[a]=e[a]<0?0:e[a],e[r]=e[r]<0?0:e[r],e[i]=e[i]>t?0:e[i],e[o]=e[o]>t?0:e[o],n*(Number(e[i])-Number(e[a]))/t<16&&(t<(l=Math.ceil(Number(e[a])+16*t/n))?e[a]=Math.floor(Number(e[i])-16*t/n):e[i]=l,d=!1),s*(Number(e[o])-Number(e[r]))/t<16&&(t<(l=Math.ceil(Number(e[r])+16*t/s))?e[r]=Math.floor(Number(e[o])-16*t/s):e[o]=l,d=!1),d},eventDrawObjParam:function(e,t,a){var i,r={},o=l[e][t];for(i in isOldPlugin&&!Capinfo.isMac?Utils.sdkAddCfg(r,a):r=n.parseJSON(a),this.correctPos(r,1e4,"Left","Right","Top","Bottom")||(l[DrawType.RECT][t].Left=r.Left,l[DrawType.RECT][t].Top=r.Top,l[DrawType.RECT][t].Right=r.Right,l[DrawType.RECT][t].Bottom=r.Bottom,isOldPlugin&&!Capinfo.isMac?Utils.setDrawObj(DrawType.RECT,0,l):Utils.ModifyDrawObj(DrawType.RECT,0,l)),r)o[i]=Number(r[i]);s[t].Area.TopLeft.X=Math.round(o.Left/100),s[t].Area.TopLeft.Y=Math.round(o.Top/100),s[t].Area.BotRight.X=Math.round(o.Right/100),s[t].Area.BotRight.Y=Math.round(o.Bottom/100),this.submitF()},eventSelDrawObj:function(e,t){this.selectArea(t)},initRoiDrawObjData:function(){var e,t,a={},i=n.lang.pub.area,r=this;for((l={})[DrawType.RECT]=[],e=0;e<o;e++)t=h[e],(a={}).Text=i+(e+1),a.Left=100*Number(s[e].Area.TopLeft.X),a.Top=100*Number(s[e].Area.TopLeft.Y),a.Right=100*Number(s[e].Area.BotRight.X),a.Bottom=100*Number(s[e].Area.BotRight.Y),a.LineColor=Utils.getDrawObjColor(t),a.LineWidth=2,l[DrawType.RECT].push(a);Utils.initDrawObj(l,function(){r.showArea()})},initVideo_callback:function(e){Utils.EnableDrawFun(e,1),Config.OperateRoi.initRoiDrawObjData()},selectArea:function(e){null!=a&&(n("#areaTR"+a).removeClass("selectedTR"),n("#selectDiv"+a).removeClass("selectedDiv")),n("#areaTR"+(a=e)).addClass("selectedTR"),n("#selectDiv"+a).addClass("selectedDiv"),Utils.selectDrawObj(u,a)},addArea:function(){for(var e={},t=0;t<o&&!n("#areaTR"+t).is(":hidden");t++);t!=o?(s[t].Enable=1,this.submitF()&&((e=l[u][t]).Left=100*Number(s[t].Area.TopLeft.X),e.Top=100*Number(s[t].Area.TopLeft.Y),e.Right=100*Number(s[t].Area.BotRight.X),e.Bottom=100*Number(s[t].Area.BotRight.Y),Utils.setDrawObj(u,t,l),Utils.showHiddenArea(u,t,1),n("#areaTR"+t).removeClass("hidden"),this.selectArea(t))):Frame.showMsg(!0,n.lang.pub.tipUpperROIAreaInfo,0)},removeArea:function(e){if(s[e].Enable=0,this.submitF()){if(e==a&&null!=a){a=null;for(var t=0;t<o;t++)if(1==s[t].Enable){this.selectArea(t);break}}n("#areaTR"+e).addClass("hidden"),Utils.showHiddenArea(u,e,0)}},initAreaList:function(){n("#areaTbl").empty();for(var e=0;e<o;e++){var t=n.lang.pub.area,t="<tr id='areaTR"+e+"' class='"+(1==s[e].Enable?"":"hidden")+"'><td onclick='Config.OperateRoi.selectArea("+e+");' ><div id='selectDiv"+e+"' class='unselectDiv'><div class='colorDiv' style='background-color: #"+h[e]+"'></div></div></td><td onclick='Config.OperateRoi.selectArea("+e+");' >"+t+(e+1)+"</td><td align='right'><a class='icon black-del' onclick='Config.OperateRoi.removeArea("+e+");this.blur();' title='"+n.lang.pub.del+"'></a></td></tr>";n("#areaTbl").append(t)}},changeDataMap:function(e,t,a){0==a?(t.left=e.TopLeft.X,t.right=e.TopLeft.Y,t.topX=e.BotRight.X,t.bottom=e.BotRight.Y):(e.TopLeft.X=t.left,e.TopLeft.Y=t.right,e.BotRight.X=t.topX,e.BotRight.Y=t.bottom)}}))}(jQuery),Frame.currentNameSpace=Config.OperateRoi;