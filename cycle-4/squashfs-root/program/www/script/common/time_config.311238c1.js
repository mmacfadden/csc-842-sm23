Config.time_config=function(l){var o={},n=null,a=null,r=0,d=!1,s={},f={},c={},m={},p={},T={},u={},y={NTPIPAddr:["NTPServerInfos",0,"IPAddress"],AddressType:["NTPServerInfos",0,"AddressType"],NTPport:["NTPServerInfos",0,"Port"],NTPSyncInterval:["NTPServerInfos",0,"SynchronizeInterval"]},g={},P={},h={SyncType:["Mode"]},v={},I={},N={holiday:["FeastDay"],offday:["ChangeDay"]},S=null,b=null,A={},e=[{fieldId:"rowNum",fieldType:"RowNum"},{fieldId:"holiday"},{fieldId:"option",fieldType:"option",option:"<a href='#' class='icon black-del' rowNum=rowNum onclick='Config.time_config.delHoliday($(this).attr(\"rowNum\"));' title='"+l.lang.pub.del+"'></a>"}],t=[{fieldId:"rowNum",fieldType:"RowNum"},{fieldId:"offday"},{fieldId:"option",fieldType:"option",option:"<a href='#' class='icon black-del' rowNum=rowNum onclick='Config.time_config.delOffday($(this).attr(\"rowNum\"));' title='"+l.lang.pub.del+"'></a>"}];return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),Utils.initLang(),this.initValidator(),this.initEvent(),this.initData(),Utils.afterDataLoad()},initPage:function(){var e="<option value='1' data-lang='SDKSynTime'></option>";Capinfo.isSupportJPEG&&(e+="<option value='2' data-lang='TMSSynTime'></option>"),Capinfo.isSupportNTP&&(e+="<option value='3' data-lang='NTPSynTime'></option>"),Capinfo.isSupportVM&&(e+="<option value='4' data-lang='PlatformSynTime'></option>"),e+="<option value='5' data-lang='ONVIFSynTime'></option><option value='0' data-lang='DefaultSynTime'></option>",l("#SyncType").html(e),Capinfo.isSupportOffday&&(l("#HolidayDiv").removeClass("hidden"),l("#OffdayDiv").removeClass("hidden"))},initData:function(){if(g={},p={},Utils.LAPI_GetCfgData(LAPI_URL.SystemTime,o)){if(Capinfo.isSupportNTP){if(!Utils.LAPI_GetCfgData(LAPI_URL.NTPServer,T))return void Utils.disableAll();u=Utils.objectClone(T),2==T.NTPServerInfos[0].AddressType&&(y.NTPIPAddr=["NTPServerInfos",0,"DomainName"]),Utils.LAPI_CfgToForm("frmSetup",T,m,y)}if(Utils.LAPI_GetCfgData(LAPI_URL.SyncTime,g)){if(P=Utils.objectClone(g),Utils.LAPI_CfgToForm("frmSetup",g,p,h),Capinfo.isSupportCapture){if(!Utils.LAPI_GetCfgData(LAPI_URL.FeastChangeDay,v))return void Utils.disableAll();I=Utils.objectClone(v),Utils.LAPI_CfgToForm("frmSetup",v,o,N),this.changeDateMapToList(),f=Utils.objectClone(s),(S=new TableView("Holidataview_tbody",this.getHolidayMapList,e,20)).createDataView(),(b=new TableView("Offdataview_tbody",this.getOffdayMapList,t,20)).createDataView()}Utils.LAPI_CfgToForm("frmSetup",o),A=Utils.objectClone(o),l("#NowTime").val(this.formatDataTime(o.LocalTime.Year,o.LocalTime.Month,o.LocalTime.MonthDay,o.LocalTime.Hour,o.LocalTime.Minute,o.LocalTime.Second)),r=15<=(r=Number(l("#TimeZone").val()))||r<=-15?r/100:r,Number(l("#SynTime").val()),this.NTPAddressEnable()}else Utils.disableAll()}else Utils.disableAll()},initEvent:function(){var e=this;l("#SyncType").change(function(){e.disablesyncPCTime()}),l("#syncPCTime").bind("click",function(){e.syncPCTime()}),l("#TimeZone").change(function(){e.TimeZone_change()}),l("#SynTime").change(function(){e.SynTimeWay_change()}),l("#NTPIPAddr").change(function(){var e=l("#AddressType"),t=l("#NTPIPAddr"),i=t.val().split("."),a=/^(\d|[1-9](\d)?|1\d{2}|2[0-4]\d|25[0-5])$/;rule=n.settings.rules,4==i.length?(rule.NTPIPAddr={},/^[0-9]{1,4}$/.test(i[0])&&a.test(i[1])&&a.test(i[2])&&a.test(i[3])?(e.val(0),rule.NTPIPAddr={checkIP1To223OrEmpty:""}):(e.val(2),rule.NTPIPAddr={},rule.NTPIPAddr={checkIPAddrOrEmpty:""})):(e.val(2),rule.NTPIPAddr={},rule.NTPIPAddr={checkIPAddrOrEmpty:""}),""==t.val()&&t.val("0.0.0.0")}),l("#addHoliday").bind("click",function(){WdatePicker({el:"d12",skin:"whyGreen",dateFmt:"yyyy-MM-dd",lang:top.wdateLang,readOnly:!0,onpicked:function(e){for(var t=s.holiday,i=e.cal.getDateStr(),a=0;a<t.length;a++)if(i==t[a].holiday)return;t.push({holiday:i}),S.refresh()}})}),l("#addOffday").bind("click",function(){WdatePicker({el:"d12",skin:"whyGreen",dateFmt:"yyyy-MM-dd",lang:top.wdateLang,readOnly:!0,onpicked:function(e){for(var t=s.offday,i=e.cal.getDateStr(),a=0;a<t.length;a++)if(i==t[a].offday)return;t.push({offday:i}),b.refresh()}})}),l("#NowTime").bind("focus",function(){e.pickerDataTime()}),l(".button_green").bind("click",function(){e.submitF()})},submitF:function(){var e=l("#NowTime").val();if(n.form()&&""!=e){Utils.LAPI_FormToCfg("frmSetup",g,p,h);var t,i=!Utils.isObjectEquals(g,P);Capinfo.isSupportNTP&&(2!=Number(l("#AddressType").val())?y.NTPIPAddr=["NTPServerInfos",0,"IPAddress"]:y.NTPIPAddr=["NTPServerInfos",0,"DomainName"],Utils.LAPI_FormToCfg("frmSetup",T,m,y),t=!Utils.isObjectEquals(T,u),2!=T.NTPServerInfos[0].AddressType?T.NTPServerInfos[0].DomainName="":T.NTPServerInfos[0].IPAddress="");var a=e.split(" "),e=a[0].split("-"),a=a[1].split(":");o.LocalTime.Year=parseInt(e[0],10),o.LocalTime.Month=parseInt(e[1],10),o.LocalTime.MonthDay=parseInt(e[2],10),o.LocalTime.Hour=parseInt(a[0],10),o.LocalTime.Minute=parseInt(a[1],10),o.LocalTime.Second=parseInt(a[2],10),Utils.LAPI_FormToCfg("frmSetup",o);e=!Utils.isObjectEquals(o,A);if(i||t||e||!Utils.isObjectEquals(s,f)||!Utils.isObjectEquals(f,s)){a=l("#NTPIPAddr");if(""==a.val()&&a.val("0.0.0.0"),Capinfo.isSupportNTP&&t){if(!Utils.LAPI_SetCfgData(LAPI_URL.NTPServer,T))return;u=Utils.objectClone(T)}if(i){if(!Utils.LAPI_SetCfgData(LAPI_URL.SyncTime,g))return;P=Utils.objectClone(g)}if(e){if(!Utils.LAPI_SetCfgData(LAPI_URL.SystemTime,o))return;A=Utils.objectClone(o)}Capinfo.isSupportCapture&&(i=this.changeTimeDataMapToString(),(e={}).holiday=i.split("&")[0].split("=")[1],e.offday=i.split("&")[1].split("=")[1],Utils.LAPI_FormToCfg("frmSetup",v,e,N),Utils.isObjectEquals(v,I)||Utils.LAPI_SetCfgData(LAPI_URL.FeastChangeDay,v)&&(I=Utils.objectClone(v)))}else l.lang.tip.tipAnyChangeInfo}},release:function(){clearInterval(a),delete Config.time_config},initValidator:function(){l("#NTPIPAddr").attr("tip",l.lang.validate.valUrl),l("#NTPSyncInterval").attr("tip",l.validator.format(l.lang.tip.tipIntRange,30,3600)),l("#NTPport").attr("tip",l.validator.format(l.lang.tip.tipIntRange,1,65535)),l.validator.addMethod("checkIPAddrOrEmpty",function(e){return Config.time_config.checkIPAddrOrEmpty(e)},l.lang.validate.valUrl),l.validator.addMethod("checkIP1To223OrEmpty",function(e){return Utils.checkIP1To223OrEmpty(e)},l.lang.tip.tipIPRangeErr),(n=l("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(e,t){Utils.showJqueryErr(e,t,"div")},success:function(e){},rules:{NTPSyncInterval:{integer:!0,required:!0,range:[30,3600]},NTPport:{integer:!0,required:!0,range:[1,65535]}}})).init()},delHoliday:function(e){s.holiday.splice(e,1),S.refresh()},delOffday:function(e){s.offday.splice(e,1),b.refresh()},BMAddressEnable:function(){var e=document.getElementById("BMClose").checked;(document.getElementById("BMIPAddr").disabled=e)&&((e=l("#BMIPAddr")).val(o.BMIPAddr),n.element(e))},changeTimeDataMapToString:function(){var e,t,i,a="";for(t in s){for(a+=t+"=",i=s[t],e=0;e<i.length;e++)a+=i[e][t]+",";0!=i.length&&(a=a.substring(0,a.length-1)),a+="&"}return a=a.substring(0,a.length-1)},NTPAddressEnable:function(){var e=3==l("#SyncType").val(),t=l("#NTPIPAddr"),i=l("#NTPSyncInterval");e?(l("#NTPfieldset").removeClass("hidden"),n.element(t),n.element(i)):(l("#NTPfieldset").addClass("hidden"),t.val(m.NTPIPAddr),i.val(m.NTPSyncInterval)),this.disableClientTime()},formatDataTime:function(e,t,i,a,n,o){var l="";return l+=e+"-",1==t.toString().length&&(l+="0"),l+=t+"-",1==i.toString().length&&(l+="0"),l+=i+" ",1==a.toString().length&&(l+="0"),l+=a+":",1==n.toString().length&&(l+="0"),l+=n+":",1==o.toString().length&&(l+="0"),l+=o},pickerDataTime:function(){var e="2000-01-01 00:00:00",t="2029-12-31 00:00:00",i=Utils.getEvent();-1<(i.srcElement||i.target).id.indexOf("End")&&(e="2000-01-01 23:59:59",t="2029-12-31 23:59:59");var i=Utils.GetTopWindow();WdatePicker({skin:"whyGreen",dateFmt:"yyyy-MM-dd HH:mm:ss",minDate:e,maxDate:t,lang:i.wdateLang,readOnly:!0}),""==(t=l("#NowTime").val())?l("#NowTime").click():(t=(i=t.split(" "))[0].split("-"),i=i[1].split(":"),2029<Number(t[0])&&(t[0]="2029"),12<Number(t[1])&&(t[1]="12"),23<Number(i[0])&&(i[0]="23"),59<Number(i[1])&&(i[1]="59"),59<Number(i[2])&&(i[2]="59"),l("#NowTime").val(t[0]+"-"+t[1]+"-"+t[2]+" "+i[0]+":"+i[1]+":"+i[2]))},updateTime:function(e){var t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),n=e.getHours(),o=e.getMinutes(),e=e.getSeconds();l("#NowTime").val(this.formatDataTime(t,i,a,n,o,e))},syncPCTime:function(){(d=!d)?l("#syncPCTime").val(l.lang.pub.noSyncPCTime):l("#syncPCTime").val(l.lang.pub.syncPCTime);var e,t=d,i=l("#TimeZone");i.prop("disabled",t),l("#NowTime").prop("disabled",t),l("#SynTime").prop("disabled",t),t?(e=new Date(2015,0,1),t=new Date(2015,6,1),t=Math.min(-e.getTimezoneOffset(),-t.getTimezoneOffset())/60,0<(r=t)-Math.floor(t)&&(t*=100),i.val(t),this.updateTime(new Date),a=setInterval("Config.time_config.updateTime(new Date())",1e3)):clearInterval(a)},TimeZone_change:function(){var e=l("#NowTime").val().split(" "),t=e[0].split("-"),t=Date.parse(t[1]+"/"+t[2]+"/"+t[0]+" "+e[1]),e=Number(l("#TimeZone").val());t+=36e5*((e=15<=e||e<=-15?e/100:e)-r);t=new Date(t);this.updateTime(t),r=e},SynTimeWay_change:function(){Number(l("#SynTime").val())},disableClientTime:function(){var e=l("#SyncType"),e=0!=e.val()&&1!=e.val();l("#syncPCTime").prop("disabled",e),l("#TimeZone").prop("disabled",d),l("#SynTime").prop("disabled",d),l("#Year").prop("disabled",e||d),l("#Month").prop("disabled",e||d),l("#Day").prop("disabled",e||d),l("#NowTime").prop("disabled",e||d),e&&l("#NowTime").val(this.formatDataTime(o.LocalTime.Year,o.LocalTime.Month,o.LocalTime.MonthDay,o.LocalTime.Hour,o.LocalTime.Minute,o.LocalTime.Second))},disablesyncPCTime:function(){d&&this.syncPCTime(),this.NTPAddressEnable()},changeDateMapToList:function(){for(var e,t={},i=[],a=[],n=0;n<parseInt(o.holiday.length/10);n++)c["holiday"+(n+1)]=o.holiday.split(",")[n];for(n=0;n<parseInt(o.offday.length/10);n++)c["offday"+(n+1)]=o.offday.split(",")[n];for(e=0;e<20&&c["holiday"+(e+1)];e++)(t={}).holiday=c["holiday"+(e+1)],i.push(t);for(e=0;e<20&&c["offday"+(e+1)];e++)(t={}).offday=c["offday"+(e+1)],a.push(t);s.holiday=i,s.offday=a},getHolidayMapList:function(){return s.holiday},getOffdayMapList:function(){return s.offday},checkIPAddrOrEmpty:function(e){return new RegExp("^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?((\\d|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])(.(\\d|[1-9](\\d)?|1\\d{2}|2[0-4]\\d|25[0-5])){3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$").test(e)}}))}(jQuery),Frame.currentNameSpace=Config.time_config;