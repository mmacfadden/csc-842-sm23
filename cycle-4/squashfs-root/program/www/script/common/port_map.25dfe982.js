Config.port_map=function(e){var r={},n={},a={},p=["portMapFail","portMapSuccess"],o={PortMapEnable:["Enable"],PortMapType:["MapAuto"],OutPort0:["UpnpPortMap",0,"NatOutAddr","Port"],OutIPAddress0:["UpnpPortMap",0,"NatOutAddr","IPAddr"],PortMapStatus0:["UpnpPortMap",0,"PortMapStatus"],OutPort2:["UpnpPortMap",2,"NatOutAddr","Port"],OutIPAddress2:["UpnpPortMap",2,"NatOutAddr","IPAddr"],PortMapStatus2:["UpnpPortMap",2,"PortMapStatus"],OutPort1:["UpnpPortMap",1,"NatOutAddr","Port"],OutIPAddress1:["UpnpPortMap",1,"NatOutAddr","IPAddr"],PortMapStatus1:["UpnpPortMap",1,"PortMapStatus"],OutPort3:["UpnpPortMap",3,"NatOutAddr","Port"],OutIPAddress3:["UpnpPortMap",3,"NatOutAddr","IPAddr"],PortMapStatus3:["UpnpPortMap",3,"PortMapStatus"]};return new(Class.extend({init:function(){Utils.beforeDataLoad(),this.initPage(),this.initData(),this.initValidator(),this.initEvent(),Utils.initLang(),Utils.afterDataLoad()},initPage:function(){},initData:function(){if(Utils.LAPI_GetCfgData(LAPI_URL.PortMap,n)){for(var t=0;t<n.MapNum;t++)""==n.UpnpPortMap[t].NatOutAddr.IPAddr&&(n.UpnpPortMap[t].NatOutAddr.IPAddr="0.0.0.0");this.initPortMapTable(),this.changeStatusText(),Utils.LAPI_CfgToForm("frmSetup",n,r,o),a=Utils.objectClone(n),Utils.setLabelValue(r),this.changePortMapType()}else Utils.disableAll()},initEvent:function(){var t=this;e("#PortMapType").bind("change",function(){t.changePortMapType()})},submitF:function(){Utils.LAPI_FormToCfg("frmSetup",n,r,o),validator.form()&&(Utils.isObjectEquals(n,a)?parent.status=e.lang.tip.tipAnyChangeInfo:Utils.LAPI_SetCfgData(LAPI_URL.PortMap,n)&&(a=Utils.objectClone(n)))},release:function(){delete Config.port_map},initValidator:function(){var t,a,r,p=this;for(e.validator.addMethod("portNotSame",function(t){return p.validatePortNotSame(t)},e.lang.tip.tipPortExist),validator=e("#frmSetup").validate({focusInvalid:!1,errorElement:"span",errorPlacement:function(t,a){Utils.showJqueryErr(t,a,"td")},success:function(t){},rules:{}}),a=validator.settings.rules,t=0;t<n.MapNum;t++)e("#"+(r="OutPort"+t)).attr("tip",e.validator.format(e.lang.tip.tipIntRange,1,65535)),a[r]={integer:!0,required:!0,range:[1,65535],portNotSame:""};validator.init()},eventUPNPStatus:function(){if(Utils.LAPI_GetCfgData(LAPI_URL.PortMap,n)){for(var t=0;t<n.MapNum;t++)""==n.UpnpPortMap[t].NatOutAddr.IPAddr&&(n.UpnpPortMap[t].NatOutAddr.IPAddr="0.0.0.0"),n.Enable=1,r["OutIPAddress"+t]=n.UpnpPortMap[t].NatOutAddr.IPAddr;this.changeStatusText(),Utils.setLabelValue(r)}else Utils.disableAll()},validatePortNotSame:function(t){for(var a,r=[],p=0,o=0;o<n.MapNum;o++)1==(a=o)?a=2:2==o&&(a=1),r.push(e("#OutPort"+a).val());for(o=0;o<r.length;o++)t==r[o]&&p++;return p<=1},changeStatusText:function(){for(var t,a=0;a<n.MapNum;a++)t=Number(n.UpnpPortMap[a].PortMapSuccess),t=e.lang.pub[p[t]],n.UpnpPortMap[a].PortMapStatus=t,r["PortMapStatus"+a]=t},changePortMapType:function(){for(var t=1==e("#PortMapType").val(),a=0;a<n.MapNum;a++)e("#OutPort"+a).prop("disabled",t)},initPortMapTable:function(){for(var t="",a=0;a<n.MapNum;a++){var r=a;1==a?r=2:2==a&&(r=1),t+="<tr><td><label><lang name='portMap"+r+"'></lang></label></td><td><input class='shortInput' type='text' name='OutPort"+r+"' id='OutPort"+r+"'/></td><td><label id='OutIPAddress"+r+"'></label></td><td><label id='PortMapStatus"+r+"'></label></td></tr>"}e("#portTable").empty().append(t)}}))}(jQuery),Frame.currentNameSpace=Config.port_map;