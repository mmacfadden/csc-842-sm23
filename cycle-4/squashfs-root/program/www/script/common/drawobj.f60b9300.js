var MOUSE_POSITION={NONE:0,DRAWOBJ:1,ANCHOR:2},DrawMode={CONFIG:0,OPRATE:1},MAX_POLYGON_POINTNUM=6,MIN_WIDTH=10,Line=function(t,i){this.num=t,this.type=DrawType.LINE,this.isShow=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={PointX0:i.PointX0,PointY0:i.PointY0,PointX1:i.PointX1,PointY1:i.PointY1}};Line.prototype={createDrawObj:function(t){this.isShow&&(t.save(),t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,t.moveTo(this.map.PointX0,this.map.PointY0),t.lineTo(this.map.PointX1,this.map.PointY1),t.stroke(),t.closePath(),""!=this.Text&&(t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,(this.map.PointX0+this.map.PointX1)/2,(this.map.PointY0+this.map.PointY1)/2-4)))},isDrawObjSel:function(t,i,e){var o=(this.map.PointX1+this.map.PointX0)/2,n=(this.map.PointY1+this.map.PointY0)/2,s=Math.atan((this.map.PointY1-this.map.PointY0)/(this.map.PointX1-this.map.PointX0)),h=Math.sqrt(Math.pow(this.map.PointX1-this.map.PointX0,2)+Math.pow(this.map.PointY1-this.map.PointY0,2));if(this.isShow)return t.save(),t.beginPath(),t.translate(o,n),t.rotate(s),t.strokeStyle="rgba(255,255,255,0)",t.rect(-h/2-5,-5,h+10,10),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),t.restore(),e}};var arrowLine=function(t,i){this.num=t,this.type=DrawType.LINE_ARROW,this.isShow=!1,this.Direction="undefined"==typeof i.Direction||isNaN(i.Direction)?0:Number(i.Direction),this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={PointX0:i.PointX0,PointY0:i.PointY0,PointX1:i.PointX1,PointY1:i.PointY1}};arrowLine.prototype={createDrawObj:function(t){var i=(this.map.PointX1+this.map.PointX0)/2,e=(this.map.PointY1+this.map.PointY0)/2,o=Math.atan((this.map.PointY1-this.map.PointY0)/(this.map.PointX1-this.map.PointX0));this.isShow&&(t.beginPath(),t.lineWidth=this.LineWidth,t.strokeStyle=this.LineColor,t.moveTo(this.map.PointX0,this.map.PointY0),t.lineTo(this.map.PointX1,this.map.PointY1),t.stroke(),t.save(),t.beginPath(),t.translate(i,e),this.map.PointX1>=this.map.PointX0&&this.map.PointY1<=this.map.PointY0||this.map.PointX1>=this.map.PointX0&&this.map.PointY1>=this.map.PointY0?t.rotate(o):(this.map.PointX1<=this.map.PointX0&&this.map.PointY1>=this.map.PointY0||this.map.PointX1<=this.map.PointX0&&this.map.PointY1<=this.map.PointY0)&&t.rotate(o+Math.PI),0==this.Direction?(t.moveTo(0,0),t.lineTo(0,20),t.lineTo(-8,12),t.lineTo(0,20),t.lineTo(8,12),t.lineTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)):1==this.Direction?(t.moveTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)):2==this.Direction&&(t.moveTo(0,-20),t.lineTo(0,20),t.lineTo(-8,12),t.lineTo(0,20),t.lineTo(8,12),t.lineTo(0,20)),t.stroke(),t.closePath(),t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText("B",0,20),t.fillText("A",0,-20),t.restore(),""!=this.Text&&(t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,(this.map.PointX0+this.map.PointX1)/2,(this.map.PointY0+this.map.PointY1)/2-4)))},isDrawObjSel:function(t,i,e){var o=(this.map.PointX1+this.map.PointX0)/2,n=(this.map.PointY1+this.map.PointY0)/2,s=Math.atan((this.map.PointY1-this.map.PointY0)/(this.map.PointX1-this.map.PointX0)),h=Math.sqrt(Math.pow(this.map.PointX1-this.map.PointX0,2)+Math.pow(this.map.PointY1-this.map.PointY0,2));if(this.isShow)return t.save(),t.beginPath(),t.translate(o,n),t.rotate(s),t.strokeStyle="rgba(255,255,255,0)",t.rect(-h/2-5,-5,h+10,10),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),t.restore(),e}};var CEZRect=function(t,i){this.num=t,this.type=DrawType.RECT,this.isShow=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={Left:i.Left,Top:i.Top,Right:i.Right,Bottom:i.Bottom}};CEZRect.prototype={createDrawObj:function(t){this.isShow&&(t.save(),t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,t.rect(this.map.Left,this.map.Top,this.map.Right-this.map.Left,this.map.Bottom-this.map.Top),t.stroke(),t.closePath(),""!=this.Text&&(t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",this.map.Left>this.map.Right?t.fillText(this.Text,this.map.Right,this.map.Bottom-4):t.fillText(this.Text,this.map.Left,this.map.Top-4)))},isDrawObjSel:function(t,i,e){if(this.isShow)return t.save(),t.beginPath(),t.strokeStyle="rgba(255,0,0,0)",t.lineWidth=this.LineWidth,t.rect(this.map.Left,this.map.Top,this.map.Right-this.map.Left,this.map.Bottom-this.map.Top),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),e}};var gridArea=function(t,i,e,o){this.num=t,this.type=DrawType.RECT_DIAMOND,this.isShow=!1,this.lenW=i.DiamondLengthNum,this.lenH=i.DiamondHeightNum,this.width=e,this.height=o,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map=i.Diamond,this.area=[],this.chooseRect={startX:0,startY:0,width:0,height:0}};gridArea.prototype={createDrawObj:function(t){if(this.isShow){for(var i="",e=0;e<this.map.length;e++)i+=function(t){"string"!=typeof t&&(t=t.toString());for(var i="",e=0;e<8-t.length;e++)i+="0";return i+t}(this.map[e].toString(2));for(e=this.area.length=0;e<this.lenH;e++)for(var o=0;o<this.lenW;o++){var n={x:o,y:e,show:Number(i[e*this.lenW+o])};this.area.push(n)}var s=this.width,h=this.height;this.disX=s/this.lenW,this.disY=h/this.lenH,t.clearRect(0,0,s,h),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth;for(var a,e=0;a=this.area[e];e++)a.show&&(t.beginPath(),t.moveTo(a.x*this.disX+.5,a.y*this.disY+.5),t.lineTo((a.x+1)*this.disX+.5,a.y*this.disY+.5),t.lineTo((a.x+1)*this.disX+.5,(a.y+1)*this.disY+.5),t.lineTo(a.x*this.disX+.5,(a.y+1)*this.disY+.5),t.closePath(),t.stroke());t.strokeStyle="#fff",t.lineWidth=2,t.strokeRect(this.chooseRect.startX,this.chooseRect.startY,this.chooseRect.width,this.chooseRect.height)}},isDrawObjSel:function(t,i,e){}};var arrowRect=function(t,i){this.type=DrawType.RECT_ARROW,this.num=t,this.isShow=!1,this.Direction="undefined"==typeof i.Direction||isNaN(i.Direction)?0:Number(i.Direction),this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={Left:i.Left,Top:i.Top,Right:i.Right,Bottom:i.Bottom}};arrowRect.prototype={createDrawObj:function(t){var i,e=(this.map.Left+this.map.Right)/2;this.isShow&&(i=this.map.Top>this.map.Bottom?this.map.Bottom:this.map.Top,t.save(),t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,t.rect(this.map.Left,this.map.Top,this.map.Right-this.map.Left,this.map.Bottom-this.map.Top),t.stroke(),t.save(),t.beginPath(),t.translate(e,i),1==this.Direction&&(t.moveTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)),2==this.Direction&&(t.moveTo(0,-20),t.lineTo(0,20),t.lineTo(-8,12),t.lineTo(0,20),t.lineTo(8,12),t.lineTo(0,20)),t.stroke(),t.closePath(),t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText("B",0,20),t.fillText("A",0,-20),t.restore(),""!=this.Text&&(t.fillStyle="black",t.font=this.FontSize+"px sans-serif",this.map.Left>this.map.Right?t.fillText(this.Text,this.map.Right+20,this.map.Bottom+20):t.fillText(this.Text,this.map.Left+20,this.map.Top+20)))},isDrawObjSel:function(t,i,e){if(this.isShow)return t.beginPath(),t.strokeStyle="rgba(255,0,0,0)",t.lineWidth=this.LineWidth,t.rect(this.map.Left,this.map.Top,this.map.Right-this.map.Left,this.map.Bottom-this.map.Top),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),e}};var polygon=function(t,i){this.type=DrawType.POLYGON,this.num=t,this.isShow=!1,this.isDrawing=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={};for(var e=0;e<MAX_POLYGON_POINTNUM&&"undefined"!=typeof i["PointX"+e]&&"undefined"!=typeof i["PointY"+e];e++)this.map["PointX"+e]=i["PointX"+e],this.map["PointY"+e]=i["PointY"+e];this.coordinateNum=e};polygon.prototype={createDrawObj:function(t){var i;if(this.isShow){for(t.save(),t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,t.moveTo(this.map.PointX0,this.map.PointY0),i=1;i<=this.coordinateNum;i++)t.lineTo(this.map["PointX"+i],this.map["PointY"+i]);this.isDrawing||t.lineTo(this.map.PointX0,this.map.PointY0),t.stroke(),t.closePath(),this.isDrawing||""==this.Text||(t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,this.map.PointX0,this.map.PointY0))}},isDrawObjSel:function(t,i,e){var o;if(this.isShow){for(t.save(),t.beginPath(),t.strokeStyle="rgba(255,0,0,0)",t.lineWidth=this.LineWidth,t.moveTo(this.map.PointX0,this.map.PointY0),o=1;o<=this.coordinateNum;o++)t.lineTo(this.map["PointX"+o],this.map["PointY"+o]);return t.lineTo(this.map.PointX0,this.map.PointY0),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),e}}};var arrowPolygon=function(t,i){this.type=DrawType.POLYGON_ARROW,this.num=t,this.isShow=!1,this.isDrawing=!1,this.Direction="undefined"==typeof i.Direction||isNaN(i.Direction)?0:Number(i.Direction),this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={};for(var e=0;e<MAX_POLYGON_POINTNUM&&"undefined"!=typeof i["PointX"+e]&&"undefined"!=typeof i["PointY"+e];e++)this.map["PointX"+e]=i["PointX"+e],this.map["PointY"+e]=i["PointY"+e];this.coordinateNum=e};arrowPolygon.prototype={createDrawObj:function(t){var i,e,o,n,s;if(this.isShow){for(t.save(),t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,t.moveTo(this.map.PointX0,this.map.PointY0),i=1;i<=this.coordinateNum;i++)t.lineTo(this.map["PointX"+i],this.map["PointY"+i]);this.isDrawing||t.lineTo(this.map.PointX0,this.map.PointY0),t.stroke(),this.isDrawing||(e=(this.map.PointX1+this.map.PointX0)/2,o=(this.map.PointY1+this.map.PointY0)/2,n=this.isArrowDirection(t,e,o),s=Math.atan((this.map.PointY1-this.map.PointY0)/(this.map.PointX1-this.map.PointX0)),t.save(),t.beginPath(),t.translate(e,o),t.rotate(s),n&&4==this.Direction?(t.moveTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)):!n&&4==this.Direction||n&&3==this.Direction?(t.moveTo(0,-20),t.lineTo(0,20),t.lineTo(-8,12),t.lineTo(0,20),t.lineTo(8,12),t.lineTo(0,20)):n||3!=this.Direction||(t.moveTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)),t.stroke(),t.closePath(),t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText("B",0,20),t.fillText("A",0,-20),t.restore()),t.closePath(),this.isDrawing||""==this.Text||(t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,this.map.PointX0,this.map.PointY0))}},isDrawObjSel:function(t,i,e){var o;if(this.isShow){for(t.save(),t.beginPath(),t.strokeStyle="rgba(255,0,0,0)",t.lineWidth=this.LineWidth,t.moveTo(this.map.PointX0,this.map.PointY0),o=1;o<=this.coordinateNum;o++)t.lineTo(this.map["PointX"+o],this.map["PointY"+o]);return t.lineTo(this.map.PointX0,this.map.PointY0),e=t.isPointInPath(i,e),t.stroke(),e}},isArrowDirection:function(t,i,e){var o=i,i=e+2,e=!1;t.save(),t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,t.moveTo(this.map.PointX0,this.map.PointY0);for(var n=1;n<this.coordinateNum;n++)t.lineTo(this.map["PointX"+n],this.map["PointY"+n]);return t.lineTo(this.map.PointX0,this.map.PointY0),t.isPointInPath(o,i)&&(e=!0),t.stroke(),e}};var concentricRect=function(t,i){this.type=DrawType.CONCENTRIC,this.num=t,this.isShow=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColorOut="undefined"!=typeof i.LineColorOut?Utils.setDrawObjColor(i.LineColorOut):"",this.LineColorIn="undefined"!=typeof i.LineColorIn?Utils.setDrawObjColor(i.LineColorIn):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={LeftOut:i.LeftOut,TopOut:i.TopOut,RightOut:i.RightOut,BottomOut:i.BottomOut,LeftIn:i.LeftIn,TopIn:i.TopIn,RightIn:i.RightIn,BottomIn:i.BottomIn}};concentricRect.prototype={createDrawObj:function(t){this.isShow&&(t.beginPath(),t.strokeStyle=this.LineColorOut,t.lineWidth=this.LineWidth,t.rect(this.map.LeftOut,this.map.TopOut,this.map.RightOut-this.map.LeftOut,this.map.BottomOut-this.map.TopOut),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle=this.LineColorIn,t.lineWidth=this.LineWidth,t.rect(this.map.LeftIn,this.map.TopIn,this.map.RightIn-this.map.LeftIn,this.map.BottomIn-this.map.TopIn),t.stroke(),t.closePath(),""!=this.Text&&(t.fillStyle="black",t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,this.map.Left,this.map.Top)))},isDrawObjSel:function(t,i,e){if(this.isShow)return t.beginPath(),t.strokeStyle="rgba(255,0,0,0)",t.lineWidth=this.LineWidth,t.rect(this.map.LeftOut,this.map.TopOut,this.map.RightOut-this.map.LeftOut,this.map.BottomOut-this.map.TopOut),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),e}};var point=function(t,i){this.type=DrawType.POINT,this.num=t,this.isShow=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?1:Number(i.LineWidth),this.map={PointX:i.PointX,PointY:i.PointY}};point.prototype={createDrawObj:function(t){this.isShow&&(t.beginPath(),t.strokeStyle=this.LineColor,t.moveTo(this.map.PointX,this.map.PointY),t.lineTo(this.map.PointX-5,this.map.PointY-8),t.lineTo(this.map.PointX+5,this.map.PointY-8),t.lineTo(this.map.PointX,this.map.PointY),t.stroke(),t.closePath(),""!=this.Text&&(t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,this.map.PointX,this.map.PointY-8)))}};var title=function(t,i){this.type=DrawType.TITLE,this.num=t,this.isShow=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.Fill="undefined"==typeof i.Fill||isNaN(i.Fill)?"":i.Fill,this.FillColor="undefined"!=typeof i.FillColor?Utils.setDrawObjColor(i.FillColor):"",this.map={Left:i.Left,Top:i.Top,Right:i.Left+35,Bottom:i.Top+20}};title.prototype={createDrawObj:function(t){this.isShow&&(t.beginPath(),t.strokeStyle=this.LineColor,t.lineWidth=this.LineWidth,""!=this.FillColor&&(t.fillStyle=this.FillColor),t.rect(this.map.Left,this.map.Top,this.map.Right-this.map.Left,this.map.Bottom-this.map.Top),t.stroke(),""!=this.FillColor&&t.fill(),t.closePath(),""!=this.Text&&(t.fillStyle="black",t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,this.map.Left+3,this.map.Top+12)))},isDrawObjSel:function(t,i,e){if(this.isShow)return t.save(),t.beginPath(),t.strokeStyle="rgba(255,0,0,0)",t.lineWidth=this.LineWidth,t.rect(this.map.Left,this.map.Top,this.map.Right-this.map.Left,this.map.Bottom-this.map.Top),e=t.isPointInPath(i,e),t.stroke(),t.closePath(),e}};var lineArrowVernier=function(t,i){this.type=DrawType.EN_DRAW_LINE_ARROW_VERNIER,this.num=t,this.isShow=!1,this.bSelVernier=!1,this.vernierNum=0,this.ShowVernier="undefined"==typeof i.ShowVernier||isNaN(i.ShowVernier)?0:Number(i.ShowVernier),this.Direction="undefined"==typeof i.Direction||isNaN(i.Direction)?0:Number(i.Direction),this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.VernierColor="undefined"!=typeof i.VernierColor?Utils.setDrawObjColor(i.VernierColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={};for(var e=0;e<4&&"undefined"!=typeof i["PointX"+e]&&"undefined"!=typeof i["PointY"+e];e++)this.map["PointX"+e]=i["PointX"+e],this.map["PointY"+e]=i["PointY"+e]};lineArrowVernier.prototype={createDrawObj:function(t){var i=(this.map.PointX1+this.map.PointX0)/2,e=(this.map.PointY1+this.map.PointY0)/2,o=Math.atan((this.map.PointY1-this.map.PointY0)/(this.map.PointX1-this.map.PointX0));this.isShow&&(t.beginPath(),t.lineWidth=this.LineWidth,t.strokeStyle=this.LineColor,t.moveTo(this.map.PointX0,this.map.PointY0),t.lineTo(this.map.PointX1,this.map.PointY1),t.stroke(),t.save(),t.beginPath(),t.translate(i,e),this.map.PointX1>=this.map.PointX0&&this.map.PointY1<=this.map.PointY0||this.map.PointX1>=this.map.PointX0&&this.map.PointY1>=this.map.PointY0?t.rotate(o):(this.map.PointX1<=this.map.PointX0&&this.map.PointY1>=this.map.PointY0||this.map.PointX1<=this.map.PointX0&&this.map.PointY1<=this.map.PointY0)&&t.rotate(o+Math.PI),0==this.Direction?(t.moveTo(0,0),t.lineTo(0,20),t.lineTo(-8,12),t.lineTo(0,20),t.lineTo(8,12),t.lineTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)):1==this.Direction?(t.moveTo(0,20),t.lineTo(0,-20),t.lineTo(-8,-12),t.lineTo(0,-20),t.lineTo(8,-12),t.lineTo(0,-20)):2==this.Direction&&(t.moveTo(0,-20),t.lineTo(0,20),t.lineTo(-8,12),t.lineTo(0,20),t.lineTo(8,12),t.lineTo(0,20)),t.stroke(),t.closePath(),t.fillStyle=this.LineColor,t.font=this.FontSize+"px sans-serif",t.fillText("B",0,20),t.fillText("A",0,-20),t.restore(),1==this.ShowVernier&&(t.beginPath(),t.save(),t.translate(this.map.PointX2,this.map.PointY2),t.rotate(o),t.strokeStyle=this.VernierColor,t.lineWidth=this.LineWidth,t.moveTo(0,-20),t.lineTo(0,20),t.stroke(),t.restore(),t.save(),t.translate(this.map.PointX3,this.map.PointY3),t.rotate(o),t.strokeStyle=this.VernierColor,t.lineWidth=this.LineWidth,t.moveTo(0,-20),t.lineTo(0,20),t.stroke(),t.restore(),t.closePath()),""!=this.Text&&(t.fillStyle="black",t.font=this.FontSize+"px sans-serif",t.fillText(this.Text,this.map.PointX0,this.map.PointY0)))},isDrawObjSel:function(t,i,e){var o=(this.map.PointX1+this.map.PointX0)/2,n=(this.map.PointY1+this.map.PointY0)/2,s=Math.atan((this.map.PointY1-this.map.PointY0)/(this.map.PointX1-this.map.PointX0)),h=Math.sqrt(Math.pow(this.map.PointX1-this.map.PointX0,2)+Math.pow(this.map.PointY1-this.map.PointY0,2));if(this.isShow)return t.save(),t.beginPath(),t.translate(o,n),t.rotate(s),t.strokeStyle="rgba(255,255,255,0)",t.rect(-h/2-5,-5,h+10,10),n=t.isPointInPath(i,e),t.stroke(),t.closePath(),t.restore(),n||1!=this.ShowVernier||(t.beginPath(),t.save(),t.translate(this.map.PointX2,this.map.PointY2),t.rotate(s),t.strokeStyle="rgba(255,255,255,0)",t.rect(-5,-25,10,50),(h=t.isPointInPath(i,e))&&(this.bSelVernier=!0,this.vernierNum=2),t.stroke(),t.restore(),t.closePath(),h||(t.beginPath(),t.save(),t.translate(this.map.PointX3,this.map.PointY3),t.rotate(s),t.strokeStyle="rgba(255,255,255,0)",t.rect(-5,-25,10,50),t.isPointInPath(i,e)&&(this.bSelVernier=!0,this.vernierNum=3),t.stroke(),t.restore(),t.closePath())),n}};var rectZoom=function(t,i){this.num=t,this.type=DrawType.RECT_ZOOM,this.isShow=!1,this.FontSize="undefined"==typeof i.FontSize||isNaN(i.FontSize)?12:Number(i.FontSize),this.Text="undefined"!=typeof i.Text?i.Text:"",this.LineColor="undefined"!=typeof i.LineColor?Utils.setDrawObjColor(i.LineColor):"",this.LineWidth="undefined"==typeof i.LineWidth||isNaN(i.LineWidth)?2:Number(i.LineWidth),this.map={Left:i.Left,Top:i.Top,Right:i.Right,Bottom:i.Bottom}};rectZoom.prototype={createDrawObj:function(t,i){this.isShow&&(t.beginPath(),t.strokeStyle=i.LineColor,t.lineWidth=i.LineWidth,t.rect(i.Left,i.Top,i.Right-i.Left,i.Bottom-i.Top),t.stroke(),t.closePath())}};var DrawObj=function(t,i){this.videoID=t,this.drawMode=i||DrawMode.CONFIG,this.canvas=null,this.ctx=null,this.drawMap={},this.anchorList=[],this.currentC=null,this.tempCurrentC=null,this.mousePosition=MOUSE_POSITION.NONE,this.isMouseDown=!1,this.mouseDownX,this.mouseDownY,this.changex,this.changey,this.isReport=!1,this.width=null,this.height=null,this.setCanvas();var e=this;setInterval(function(){e.reDraw(e)},40),DrawMode.OPRATE==this.drawMode&&(this.SetDrawObj(DrawType.RECT,0,{Left:0,Top:0,Right:0,Bottom:0,LineWidth:1,LineColor:"ffffff"}),this.SelDrawObj(DrawType.RECT,0)),$("#activeX_obj").bind("dblclick",function(t){var i=this;Utils.requestFullScreen($("#activeX_obj")[0]),setTimeout(function(){Video.isFullscreen()&&(e.updateCoordinate({width:e.canvas.width,height:e.canvas.height},{width:$(i).width(),height:$(i).height()}),e.canvas.width=$(i).width(),e.canvas.height=$(i).height())},100)})};DrawObj.prototype={initCoordinate:function(t,i){var e=Utils.objectClone(i);switch(Number(t)){case 0:case 1:"undefined"==typeof i.PointX0||isNaN(i.PointX0)||"undefined"==typeof i.PointY0||isNaN(i.PointY0)||"undefined"==typeof i.PointX1||isNaN(i.PointX1)||"undefined"==typeof i.PointY1||isNaN(i.PointY1)?(e.PointX0=0,e.PointY0=0,e.PointX1=100,e.PointY1=100):(e.PointX0=Number(i.PointX0)/1e4*this.canvas.width,e.PointY0=Number(i.PointY0)/1e4*this.canvas.height,e.PointX1=Number(i.PointX1)/1e4*this.canvas.width,e.PointY1=Number(i.PointY1)/1e4*this.canvas.height);break;case 2:case 3:case 9:"undefined"==typeof i.Left||isNaN(i.Left)||"undefined"==typeof i.Top||isNaN(i.Top)||"undefined"==typeof i.Right||isNaN(i.Right)||"undefined"==typeof i.Bottom||isNaN(i.Bottom)?(e.Left=0,e.Top=0,e.Right=100,e.Bottom=100):(e.Left=Number(i.Left)/1e4*this.canvas.width,e.Top=Number(i.Top)/1e4*this.canvas.height,e.Right=Number(i.Right)/1e4*this.canvas.width,e.Bottom=Number(i.Bottom)/1e4*this.canvas.height);break;case 4:case 5:for(var o=!0,n=0;n<MAX_POLYGON_POINTNUM&&"undefined"!=typeof i["PointX"+n]&&"undefined"!=typeof i["PointY"+n];n++)(isNaN(i["PointX"+n])||isNaN(i["PointY"+n]))&&(o=!1);for(n=0;n<MAX_POLYGON_POINTNUM&&"undefined"!=typeof i["PointX"+n]&&"undefined"!=typeof i["PointY"+n];n++)o?(e["PointX"+n]=Number(i["PointX"+n])/1e4*this.canvas.width,e["PointY"+n]=Number(i["PointY"+n])/1e4*this.canvas.height):(e["PointX"+n]=0,e["PointY"+n]=0);break;case 6:"undefined"==typeof i.LeftOut||isNaN(i.LeftOut)||"undefined"==typeof i.TopOut||isNaN(i.TopOut)||"undefined"==typeof i.RightOut||isNaN(i.RightOut)||"undefined"==typeof i.BottomOut||isNaN(i.BottomOut)||"undefined"==typeof i.LeftIn||isNaN(i.LeftIn)||"undefined"==typeof i.TopIn||isNaN(i.TopIn)||"undefined"==typeof i.RightIn||isNaN(i.RightIn)||"undefined"==typeof i.BottomIn||isNaN(i.BottomIn)?(e.LeftOut=0,e.TopOut=0,e.RightOut=100,e.BottomOut=100,e.LeftIn=20,e.TopIn=20,e.RightIn=80,e.BottomIn=80):(e.LeftOut=Number(i.LeftOut)/1e4*this.canvas.width,e.TopOut=Number(i.TopOut)/1e4*this.canvas.height,e.RightOut=Number(i.RightOut)/1e4*this.canvas.width,e.BottomOut=Number(i.BottomOut)/1e4*this.canvas.height,e.LeftIn=Number(i.LeftIn)/1e4*this.canvas.width,e.TopIn=Number(i.TopIn)/1e4*this.canvas.height,e.RightIn=Number(i.RightIn)/1e4*this.canvas.width,e.BottomIn=Number(i.BottomIn)/1e4*this.canvas.height);break;case 7:"undefined"==typeof i.PointX||isNaN(i.PointX)||"undefined"==typeof i.PointY||isNaN(i.PointY)?(e.PointX=100,e.PointY=100):(e.PointX=Number(i.PointX)/1e4*this.canvas.width,e.PointY=Number(i.PointY)/1e4*this.canvas.height);break;case 8:"undefined"==typeof i.Left||isNaN(i.Left)||"undefined"==typeof i.Top||isNaN(i.Top)?(e.Left=0,e.Top=0,e.Right=35,e.Bottom=20):(e.Left=Number(i.Left)/1e4*this.canvas.width,e.Top=Number(i.Top)/1e4*this.canvas.height,e.Right=i.Left+35,e.Bottom=i.Top+20);break;case 10:for(n=0;n<4&&"undefined"!=typeof i["PointX"+n]&&"undefined"!=typeof i["PointY"+n];n++)(isNaN(i["PointX"+n])||isNaN(i["PointY"+n]))&&(o=!1);for(n=0;n<4&&"undefined"!=typeof i["PointX"+n]&&"undefined"!=typeof i["PointY"+n];n++)e["PointX"+n]=Number(i["PointX"+n])/1e4*this.canvas.width,e["PointY"+n]=Number(i["PointY"+n])/1e4*this.canvas.height;break;case 11:break;default:throw new Error("unknow drawObjType("+t+")")}return e},setCanvas:function(){var t,i="<canvas id='canvas_"+this.videoID+"' width='0' height='0' style='position:absolute;left: 0;top: 0;'></canvas>",e=$("#"+this.videoID);$("#activeX_obj").append(i),i=$("#canvas_"+this.videoID),this.canvas=i.get(0),this.ctx=this.canvas.getContext("2d"),this.canvas.onselectstart=function(){return!1},t=this,i.mousemove(function(){t.doMousemove(t)}),i.mousedown(function(){t.doMousedown(t)}),i.mouseup(function(){t.doMouseup(t)}),i.dblclick(function(){t.doDblclick(t)}),e.bind("resize",function(){t.changeCanvasSize(t)}),this.changeCanvasSize()},changeCanvasSize:function(t){var i=t||this,e=$(i.canvas),t={width:i.canvas.width,height:i.canvas.height};e.css("left",Video.videoPosStartX),e.css("top",Video.videoPosStartY),i.canvas.width=Video.videoPosEndX-Video.videoPosStartX,i.canvas.height=Video.videoPosEndY-Video.videoPosStartY,e={width:i.canvas.width,height:i.canvas.height},i.updateCoordinate(t,e)},updateCoordinate:function(t,i){var e,o,n,s,h;if(i.width!=t.width||i.height!=i.height)for(e in this.drawMap)if(this.drawMap.hasOwnProperty(e))for(o=0,n=(h=this.drawMap[e]).length;o<n;o++)switch(s=h[o],Number(e)){case 0:case 1:s.map.PointX0=s.map.PointX0/t.width*i.width,s.map.PointY0=s.map.PointY0/t.height*i.height,s.map.PointX1=s.map.PointX1/t.width*i.width,s.map.PointY1=s.map.PointY1/t.height*i.height;break;case 2:case 3:case 8:case 9:s.map.Left=s.map.Left/t.width*i.width,s.map.Top=s.map.Top/t.height*i.height,s.map.Right=s.map.Right/t.width*i.width,s.map.Bottom=s.map.Bottom/t.height*i.height;break;case 4:case 5:for(a=0;a<MAX_POLYGON_POINTNUM&&"undefined"!=typeof s.map["PointX"+a]&&"undefined"!=typeof s.map["PointY"+a];a++)s.map["PointX"+a]=s.map["PointX"+a]/t.width*i.width,s.map["PointY"+a]=s.map["PointY"+a]/t.height*i.height;break;case 6:s.map.LeftOut=s.map.LeftOut/t.width*i.width,s.map.TopOut=s.map.TopOut/t.height*i.height,s.map.RightOut=s.map.RightOut/t.width*i.width,s.map.BottomOut=s.map.BottomOut/t.height*i.height,s.map.LeftIn=s.map.LeftIn/t.width*i.width,s.map.TopIn=s.map.TopIn/t.height*i.height,s.map.RightIn=s.map.RightIn/t.width*i.width,s.map.BottomIn=s.map.BottomIn/t.height*i.height;break;case 7:s.map.PointX=s.map.PointX/t.width*i.width,s.map.PointY=s.map.PointY/t.height*i.height;break;case 10:for(var a=0;a<4&&"undefined"!=typeof s["PointX"+a]&&"undefined"!=typeof s["PointY"+a];a++)s.map["PointX"+a]=s.map["PointX"+a]/t.width*i.width,s.map["PointY"+a]=s.map["PointY"+a]/t.height*i.height;break;case 11:s.width=i.width,s.height=i.height;break;default:throw new Error("unknow drawObjType("+e+")")}},drawAnchor:function(){var t,i,e,o;if((!this.currentC||this.currentC.isShow)&&"undefined"!=typeof this.currentC)for(t=0,i=this.anchorList.length;t<i;t++)e=Number(this.anchorList[t].PointX),o=Number(this.anchorList[t].PointY),this.ctx.beginPath(),this.ctx.strokeStyle="white",this.ctx.lineWidth=2,this.ctx.rect(e-4,o-4,8,8),this.ctx.stroke(),this.ctx.closePath()},updateAnchor:function(){if(null!=this.currentC){var t,i,e=this.currentC.map;switch(this.anchorList=[],this.width=e.Right-e.Left,this.height=e.Bottom-e.Top,Number(this.currentC.type)){case 0:case 1:for(i=0;i<2;i++)(t={}).PointX=e["PointX"+i],t.PointY=e["PointY"+i],t.refPointKey=["PointX"+i,"PointY"+i],this.anchorList.push(t);break;case 2:if("undefined"!=typeof e.Sizable&&!e.Sizable)break;case 3:case 9:(t={}).PointX=e.Left,t.PointY=e.Top,t.refPointKey=["Left","Top"],this.anchorList.push(t),(t={}).PointX=e.Right,t.PointY=e.Top,t.refPointKey=["Right","Top"],this.anchorList.push(t),(t={}).PointX=e.Left,t.PointY=e.Bottom,t.refPointKey=["Left","Bottom"],this.anchorList.push(t),(t={}).PointX=e.Right,t.PointY=e.Bottom,t.refPointKey=["Right","Bottom"],this.anchorList.push(t);break;case 4:case 5:for(i=0;i<this.currentC.coordinateNum;i++)(t={}).PointX=e["PointX"+i],t.PointY=e["PointY"+i],t.refPointKey=["PointX"+i,"PointY"+i],this.anchorList.push(t);break;case 6:(t={}).PointX=e.LeftIn,t.PointY=e.TopIn,t.refPointKey=["LeftIn","TopIn"],this.anchorList.push(t),(t={}).PointX=e.RightIn,t.PointY=e.TopIn,t.refPointKey=["RightIn","TopIn"],this.anchorList.push(t),(t={}).PointX=e.LeftIn,t.PointY=e.BottomIn,t.refPointKey=["LeftIn","BottomIn"],this.anchorList.push(t),(t={}).PointX=e.RightIn,t.PointY=e.BottomIn,t.refPointKey=["RightIn","BottomIn"],this.anchorList.push(t),(t={}).PointX=e.LeftOut,t.PointY=e.TopOut,t.refPointKey=["LeftOut","TopOut"],this.anchorList.push(t),(t={}).PointX=e.RightOut,t.PointY=e.TopOut,t.refPointKey=["RightOut","TopOut"],this.anchorList.push(t),(t={}).PointX=e.LeftOut,t.PointY=e.BottomOut,t.refPointKey=["LeftOut","BottomOut"],this.anchorList.push(t),(t={}).PointX=e.RightOut,t.PointY=e.BottomOut,t.refPointKey=["RightOut","BottomOut"],this.anchorList.push(t);break;case 7:(t={}).PointX=e.PointX,t.PointY=e.PointY,t.refPointKey=["PointX","PointY"],this.anchorList.push(t);break;case 8:break;case 10:(t={}).PointX=e.PointX0,t.PointY=e.PointY0,t.refPointKey=["PointX0","PointY0"],this.anchorList.push(t),(t={}).PointX=e.PointX1,t.PointY=e.PointY1,t.refPointKey=["PointX1","PointY1"],this.anchorList.push(t);break;case 11:break;default:throw new Error("unknow drawObjType("+this.currentC.type+")")}}},reDraw:function(t){var i,e,o,n;for(i in t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawMap)if(t.drawMap.hasOwnProperty(i))for(o=0,n=(e=t.drawMap[i]).length;o<n;o++)e[o].createDrawObj(t.ctx);DrawMode.OPRATE!==this.drawMode&&(t.updateAnchor(),t.drawAnchor())},moveDrawObj:function(t,i){if(null!=this.currentC){var e,o=t-this.mouseDownX,n=i-this.mouseDownY,s=this.currentC.map;switch(this.currentC.type){case 0:case 1:if(s.PointX0+o>this.canvas.width||s.PointX0+o<0||s.PointY0+o>this.canvas.height||s.PointY0+o<0||s.PointX1+o>this.canvas.width||s.PointX1+o<0||s.PointY1+o>this.canvas.height||s.PointY1+o<0)return;s.PointX0+=o,s.PointY0+=n,s.PointX1+=o,s.PointY1+=n;break;case 2:case 3:case 8:s.Left+o<0||s.Top+o<0||s.Right+o>this.canvas.width||s.Bottom+o>this.canvas.height?(s.Left+o<0&&(s.Left=3,s.Right=this.width+3),s.Top+o<0&&(s.Top=3,s.Bottom=this.height+3),s.Right+o>this.canvas.width&&(s.Right=this.canvas.width-3,s.Left=this.canvas.width-this.width-3),s.Bottom+o>this.canvas.height&&(s.Bottom=this.canvas.height-3,s.Top=this.canvas.height-this.height-3)):(s.Left+=o,s.Top+=n,s.Right+=o,s.Bottom+=n);break;case 4:case 5:for(e=0;e<this.currentC.coordinateNum;e++)if(s["PointX"+e]+o>this.canvas.width||s["PointX"+e]+n<0||s["PointY"+e]+n>this.canvas.height||s["PointY"+e]+n<0)return;for(e=0;e<this.currentC.coordinateNum;e++)s["PointX"+e]+=o,s["PointY"+e]+=n;break;case 6:if(s.LeftOut+o<0||s.TopOut+o<0||s.RightOut+o>this.canvas.width||s.BottomOut+o>this.canvas.height)return;s.LeftIn+=o,s.TopIn+=n,s.RightIn+=o,s.BottomIn+=n,s.LeftOut+=o,s.TopOut+=n,s.RightOut+=o,s.BottomOut+=n;break;case 7:case 9:break;case 10:if(s.PointX0+o>this.canvas.width||s.PointX0+o<0||s.PointY0+o>this.canvas.height||s.PointY0+o<0||s.PointX1+o>this.canvas.width||s.PointX1+o<0||s.PointY1+o>this.canvas.height||s.PointY1+o<0)return;s.PointX0+=o,s.PointY0+=n,s.PointX1+=o,s.PointY1+=n,s.PointX2+=o,s.PointY2+=n,s.PointX3+=o,s.PointY3+=n}this.mouseDownX=t,this.mouseDownY=i}},draw:function(t,i){var e,o;if(this.currentC&&(e=this.currentC.map,o=this.currentC.coordinateNum,!("undefined"==typeof this.currentC.isDrawing&&Math.pow(Math.abs(t-this.mouseDownX),2)+Math.pow(Math.abs(i-this.mouseDownY),2)<Math.pow(MIN_WIDTH,2))))switch(this.currentC.type){case 0:case 1:e.PointX0=this.mouseDownX,e.PointY0=this.mouseDownY,e.PointX1=t,e.PointY1=i;break;case 2:case 3:e.Left=this.mouseDownX,e.Top=this.mouseDownY,e.Right=t,e.Bottom=i;break;case 4:case 5:e["PointX"+o]=t,e["PointY"+o]=i;break;case 6:e.LeftOut=this.mouseDownX,e.TopOut=this.mouseDownY,e.RightOut=t,e.BottomOut=i,s=(e.RightOut-e.LeftOut)/4,h=(e.BottomOut-e.TopOut)/4,e.LeftIn=e.LeftOut+s,e.RightIn=e.RightOut-s,e.TopIn=e.TopOut+h,e.BottomIn=e.BottomOut-h;break;case 7:case 8:case 9:break;case 10:this.currentC.bSelVernier?(r=(e.PointX0+e.PointX1)/2,a=(e.PointY0+e.PointY1)/2,2==this.currentC.vernierNum?r>e.PointX0&&r<t||r<=e.PointX0&&t<r?(e.PointX2=r,e.PointY2=a,e.PointX3=r,e.PointY3=a):r>e.PointX0&&t<e.PointX0||r<=e.PointX0&&t>e.PointX0?(e.PointX2=e.PointX0,e.PointY2=e.PointY0,e.PointX3=e.PointX1,e.PointY3=e.PointY1):(e.PointX2=t,p=(e.PointX2-e.PointX0)/(e.PointX1-e.PointX0),e.PointY2=e.PointY0+p*(e.PointY1-e.PointY0),e.PointX3=e.PointX1-p*(e.PointX1-e.PointX0),e.PointY3=e.PointY1-p*(e.PointY1-e.PointY0)):3==this.currentC.vernierNum&&(r>e.PointX1&&r<t||r<=e.PointX1&&t<r?(e.PointX2=r,e.PointY2=a,e.PointX3=r,e.PointY3=a):r>e.PointX1&&t<e.PointX1||r<=e.PointX1&&t>e.PointX1?(e.PointX2=e.PointX0,e.PointY2=e.PointY0,e.PointX3=e.PointX1,e.PointY3=e.PointY1):(e.PointX3=t,p=(e.PointX3-e.PointX1)/(e.PointX0-e.PointX1),e.PointY3=e.PointY1+p*(e.PointY0-e.PointY1),e.PointX2=e.PointX0-p*(e.PointX0-e.PointX1),e.PointY2=e.PointY0-p*(e.PointY0-e.PointY1)))):(p=e.PointX1==e.PointX0?(e.PointY2-e.PointY0)/(e.PointY1-e.PointY0):(e.PointX2-e.PointX0)/(e.PointX1-e.PointX0),e.PointX0=this.mouseDownX,e.PointY0=this.mouseDownY,e.PointX1=t,e.PointY1=i,e.PointX2=e.PointX0+p*(e.PointX1-e.PointX0),e.PointY2=e.PointY0+p*(e.PointY1-e.PointY0),e.PointX3=e.PointX1-p*(e.PointX1-e.PointX0),e.PointY3=e.PointY1-p*(e.PointY1-e.PointY0));break;case 11:var n=~~(this.mouseDownX/this.currentC.disX),s=~~(this.mouseDownY/this.currentC.disY),h=~~(t/this.currentC.disX),a=~~(i/this.currentC.disY),r=n<=h?n:h,p=s<=a?s:a;this.currentC.chooseRect={startX:r*this.currentC.disX,startY:p*this.currentC.disY,width:((h<=n?n:h)-r+1)*this.currentC.disX,height:((a<=s?s:a)-p+1)*this.currentC.disY}}},changeSize:function(t,i){var e,o,n,s=this.currentC.map;DrawType.EN_DRAW_LINE_ARROW_VERNIER==this.currentC.type&&(n=s.PointX1==s.PointX0?(s.PointY2-s.PointY0)/(s.PointY1-s.PointY0):(s.PointX2-s.PointX0)/(s.PointX1-s.PointX0)),s[this.changex]=t,s[this.changey]=i,DrawType.CONCENTRIC==this.currentC.type?("LeftOut"==this.changex?(e=s.LeftIn-s.LeftOut)<=4?(s.LeftOut=s.LeftIn-4,s.RightOut=s.RightIn+4):s.RightOut=s.RightIn+e:"RightOut"==this.changex&&((e=s.RightOut-s.RightIn)<=4?(s.LeftOut=s.LeftIn-4,s.RightOut=s.RightIn+4):s.LeftOut=s.LeftIn-e),"TopOut"==this.changey?(o=s.TopIn-s.TopOut)<=4?(s.TopOut=s.TopIn-4,s.BottomOut=s.BottomIn+4):s.BottomOut=s.BottomIn+o:"BottomOut"==this.changey&&((o=s.BottomOut-s.BottomIn)<=4?(s.TopOut=s.TopIn-4,s.BottomOut=s.BottomIn+4):s.TopOut=s.TopIn-o),"LeftIn"==this.changex?(e=s.LeftIn-s.LeftOut)<=4?(s.LeftIn=s.LeftOut+4,s.RightIn=s.RightOut-4):s.LeftIn>=(s.LeftOut+s.RightOut)/2-4?(s.LeftIn=(s.LeftOut+s.RightOut)/2-4,s.RightIn=s.LeftIn+8):s.RightIn=s.RightOut-e:"RightIn"==this.changex&&((e=s.RightOut-s.RightIn)<=4?(s.LeftIn=s.LeftOut+4,s.RightIn=s.RightOut-4):s.RightIn<=(s.LeftOut+s.RightOut)/2+4?(s.RightIn=(s.LeftOut+s.RightOut)/2+4,s.LeftIn=s.RightIn-8):s.LeftIn=s.LeftOut+e),"TopIn"==this.changey?(o=s.TopIn-s.TopOut)<=4?(s.TopIn=s.TopOut+4,s.BottomIn=s.BottomOut-4):s.TopIn>=(s.TopOut+s.BottomOut)/2-4?(s.TopIn=(s.TopOut+s.BottomOut)/2-4,s.BottomIn=s.TopIn+8):s.BottomIn=s.BottomOut-o:"BottomIn"==this.changey&&((o=s.BottomOut-s.BottomIn)<=4?(s.TopIn=s.TopOut+4,s.BottomIn=s.BottomOut-4):s.BottomIn<=(s.TopOut+s.BottomOut)/2+4?(s.BottomIn=(s.TopOut+s.BottomOut)/2+4,s.TopIn=s.BottomIn-8):s.TopIn=s.TopOut+o)):DrawType.EN_DRAW_LINE_ARROW_VERNIER==this.currentC.type&&(s.PointX2=s.PointX0+n*(s.PointX1-s.PointX0),s.PointY2=s.PointY0+n*(s.PointY1-s.PointY0),s.PointX3=s.PointX1-n*(s.PointX1-s.PointX0),s.PointY3=s.PointY1-n*(s.PointY1-s.PointY0))},getMousePosition:function(t,i){var e,o,n,s,h,a,r;if(this.mousePosition=MOUSE_POSITION.NONE,this.currentC&&this.currentC.isShow)for(s=0,h=this.anchorList.length;s<h&&(a=Number(this.anchorList[s].PointX),r=Number(this.anchorList[s].PointY),this.ctx.beginPath(),this.ctx.strokeStyle="'rgba(255,0,0,0)'",this.ctx.lineWidth=2,this.ctx.rect(a-4,r-4,8,8),t&&i&&this.ctx.isPointInPath(t,i)&&(this.mousePosition=MOUSE_POSITION.ANCHOR,this.changex=this.anchorList[s].refPointKey[0],this.changey=this.anchorList[s].refPointKey[1]),this.ctx.stroke(),this.ctx.closePath(),this.mousePosition!=MOUSE_POSITION.ANCHOR);s++);if(this.mousePosition==MOUSE_POSITION.NONE)for(e in this.drawMap)if(this.drawMap.hasOwnProperty(e)){for(s=(h=(o=this.drawMap[e]).length)-1;0<=s;s--)if((n=o[s]).type!=DrawType.POINT&&n.isDrawObjSel(this.ctx,t,i)){this.mousePosition=MOUSE_POSITION.DRAWOBJ,this.tempCurrentC=n;break}if(this.mousePosition==MOUSE_POSITION.DRAWOBJ)break}},setMouseStyle:function(t,i){var e;switch(this.currentC&&DrawType.EN_DRAW_LINE_ARROW_VERNIER==this.currentC.type&&this.currentC.bSelVernier&&(this.currentC.bSelVernier=!1),this.getMousePosition(t,i),this.mousePosition){case MOUSE_POSITION.DRAWOBJ:e=this.tempCurrentC!=this.currentC?"default":"all-scroll";break;case MOUSE_POSITION.ANCHOR:e="crosshair";break;default:e=this.currentC&&10==this.currentC.type&&this.currentC.bSelVernier?"crosshair":"default"}$(this.canvas).css("cursor",e)},doMousemove:function(t){var i=Utils.getEvent(),e=i.clientX-t.canvas.getBoundingClientRect().left,o=i.clientY-t.canvas.getBoundingClientRect().top;if(t.isMouseDown){switch(t.mousePosition){case MOUSE_POSITION.DRAWOBJ:this.tempCurrentC!=this.currentC?t.mousePosition=MOUSE_POSITION.NONE:t.moveDrawObj(e,o);break;case MOUSE_POSITION.ANCHOR:t.changeSize(e,o);break;default:t.draw(e,o)}t.currentC&&!t.currentC.isDrawing&&(t.isReport=!0),t.currentC.type==DrawType.RECT_DIAMOND&&(t.isReport=!0),this.updateAnchor()}else t.currentC&&t.currentC.isDrawing?(t.draw(e,o),this.updateAnchor()):t.setMouseStyle(e,o)},doMousedown:function(t){var i=Utils.getEvent();if(t.isMouseDown=!0,t.mouseDownX=i.clientX-t.canvas.getBoundingClientRect().left,t.mouseDownY=i.clientY-t.canvas.getBoundingClientRect().top,!t.currentC||!t.currentC.isDrawing){if(t.getMousePosition(t.mouseDownX,t.mouseDownY),t.mousePosition==MOUSE_POSITION.DRAWOBJ)Video.dealEventSelDrawObj&&Video.dealEventSelDrawObj(this.tempCurrentC.type,this.tempCurrentC.num);else if(MOUSE_POSITION.NONE==t.mousePosition&&t.currentC&&"undefined"!=typeof t.currentC.isDrawing&&!t.currentC.isDrawing){for(var e=0;e<MAX_POLYGON_POINTNUM;e++)t.currentC.map["PointX"+e]&&(delete t.currentC.map["PointX"+e],delete t.currentC.map["PointY"+e]);t.currentC.map.PointX0=t.mouseDownX,t.currentC.map.PointY0=t.mouseDownY,t.currentC.coordinateNum=1,t.currentC.isDrawing=!0}DrawMode.OPRATE==t.drawMode&&(t.currentC.isShow=!0)}},doMouseup:function(t){var i,e,o,n,s=Utils.getEvent();if(t.isMouseDown=!1,i=s.clientX-t.canvas.getBoundingClientRect().left,e=s.clientY-t.canvas.getBoundingClientRect().top,t.currentC){if("undefined"!=typeof t.currentC.isDrawing&&t.currentC.isDrawing)if(o=t.currentC.map,2<(n=t.currentC.coordinateNum)&&o.PointX0-5<i&&o.PointX0+5>i&&o.PointY0-5<e&&o.PointY0+5>e)t.currentC.isDrawing=!1,t.isReport=!0,delete t.currentC.map["PointX"+n],delete t.currentC.map["PointY"+n];else if(n<MAX_POLYGON_POINTNUM){for(f=0;f<n;f++)if(o["PointX"+f]-5<i&&o["PointX"+f]+5>i&&o["PointY"+f]-5<e&&o["PointY"+f]+5>e)return;t.currentC.coordinateNum=++n}if(DrawType.POINT==t.currentC.type?(t.currentC.map.PointX=i,t.currentC.map.PointY=e):DrawType.RECT==t.currentC.type||DrawType.RECT_ARROW==t.currentC.type||DrawType.RECT_ZOOM==t.currentC.type?(a=t.currentC.map.Left,r=t.currentC.map.Top,t.currentC.map.Left=Math.min(a,t.currentC.map.Right),t.currentC.map.Top=Math.min(r,t.currentC.map.Bottom),t.currentC.map.Right=Math.max(a,t.currentC.map.Right),t.currentC.map.Bottom=Math.max(r,t.currentC.map.Bottom)):DrawType.CONCENTRIC==t.currentC.type&&(a=t.currentC.map.LeftOut,r=t.currentC.map.TopOut,t.currentC.map.LeftOut=Math.min(a,t.currentC.map.RightOut),t.currentC.map.TopOut=Math.min(r,t.currentC.map.BottomOut),t.currentC.map.RightOut=Math.max(a,t.currentC.map.RightOut),t.currentC.map.BottomOut=Math.max(r,t.currentC.map.BottomOut),a=t.currentC.map.LeftIn,r=t.currentC.map.TopIn,t.currentC.map.LeftIn=Math.min(a,t.currentC.map.RightIn),t.currentC.map.TopIn=Math.min(r,t.currentC.map.BottomIn),t.currentC.map.RightIn=Math.max(a,t.currentC.map.RightIn),t.currentC.map.BottomIn=Math.max(r,t.currentC.map.BottomIn)),DrawMode.OPRATE==t.drawMode&&t.mouseDownX==i&&t.mouseDownY==e&&(t.currentC.map.Left=i,t.currentC.map.Top=e,t.currentC.map.Right=i,t.currentC.map.Bottom=e,t.isReport=!0),DrawType.RECT_DIAMOND==t.currentC.type){var h=~~(t.mouseDownX/t.currentC.disX),s=~~(t.mouseDownY/t.currentC.disY),a=~~(i/t.currentC.disX),r=~~(e/t.currentC.disY),p=h<=a?h:a,u=s<=r?s:r,P=a<=h?h:a,m=r<=s?s:r;var c=function(t,i,e){for(var o,n=0;o=e[n];n++)if(o.x==t&&o.y==i&&o.show)return 1}(h,s,t.currentC.area)?0:1;t.currentC.area.forEach(function(t){for(f=p;f<1+P;f++)for(var i=u;i<1+m;i++)t.x==f&&t.y==i&&(t.show=c)}),str="",t.currentC.area.forEach(function(t){str+=parseInt(t.show.toString(),2)}),str+="0000",t.currentC.map=[];for(var f=0;f<str.length/8;f++)t.currentC.map.push(parseInt(str.substr(8*f,8),2));t.currentC.chooseRect={startX:0,startY:0,width:0,height:0}}t.ReportDrawOjbParam()}},doDblclick:function(t){t.currentC&&"undefined"!=typeof t.currentC.isDrawing&&(t.currentC.isDrawing=!1,t.isReport=!0,t.ReportDrawOjbParam(),delete t.currentC.map["PointX"+t.currentC.coordinateNum],delete t.currentC.map["PointY"+t.currentC.coordinateNum],t.updateAnchor())},reductionCoordinate:function(){var t={},i=this.currentC.map;switch(Number(this.currentC.type)){case 0:case 1:t.PointX0=i.PointX0/this.canvas.width*1e4,t.PointY0=i.PointY0/this.canvas.height*1e4,t.PointX1=i.PointX1/this.canvas.width*1e4,t.PointY1=i.PointY1/this.canvas.height*1e4;break;case 2:case 3:case 8:case 9:t.Left=i.Left/this.canvas.width*1e4,t.Top=i.Top/this.canvas.height*1e4,t.Right=i.Right/this.canvas.width*1e4,t.Bottom=i.Bottom/this.canvas.height*1e4;break;case 4:case 5:for(e=0;e<MAX_POLYGON_POINTNUM&&"undefined"!=typeof i["PointX"+e]&&"undefined"!=typeof i["PointY"+e];e++)t["PointX"+e]=i["PointX"+e]/this.canvas.width*1e4,t["PointY"+e]=i["PointY"+e]/this.canvas.height*1e4;break;case 6:t.LeftOut=i.LeftOut/this.canvas.width*1e4,t.TopOut=i.TopOut/this.canvas.height*1e4,t.RightOut=i.RightOut/this.canvas.width*1e4,t.BottomOut=i.BottomOut/this.canvas.height*1e4,t.LeftIn=i.LeftIn/this.canvas.width*1e4,t.TopIn=i.TopIn/this.canvas.height*1e4,t.RightIn=i.RightIn/this.canvas.width*1e4,t.BottomIn=i.BottomIn/this.canvas.height*1e4;break;case 7:t.PointX=i.PointX/this.canvas.width*1e4,t.PointY=i.PointY/this.canvas.height*1e4;break;case 10:for(var e=0;e<4&&"undefined"!=typeof i["PointX"+e]&&"undefined"!=typeof i["PointY"+e];e++)t["PointX"+e]=i["PointX"+e]/this.canvas.width*1e4,t["PointY"+e]=i["PointY"+e]/this.canvas.height*1e4;break;case 11:t.Diamond=i;break;default:throw new Error("unknow drawObjType("+this.currentC.type+")")}return t},ReportDrawOjbParam:function(){var t,i,e="";if(this.isReport||DrawType.POINT==this.currentC.type){if(Video.dealEventDrawObjParamCanvas){for(i in t=this.reductionCoordinate())t.hasOwnProperty(i)&&(e+='"'+i+'":"'+t[i]+'",');e="{"+e.substring(0,e.length-1)+"}",DrawType.RECT_DIAMOND==this.currentC.type&&(e=t),Video.dealEventDrawObjParamCanvas(this.currentC.type,this.currentC.num,e),DrawMode.OPRATE==this.drawMode&&(this.currentC.isShow=!1,this.currentC.map.Left=0,this.currentC.map.Top=0,this.currentC.map.Right=0,this.currentC.map.Bottom=0)}this.isReport=!1}},SelDrawObj:function(t,i){this.currentC=this.drawMap[t][i],this.updateAnchor()},ShowDrawObj:function(t,i,e){this.drawMap[t][i].isShow=1==e||e},SetDrawObj:function(t,i,e){var o,n=this.initCoordinate(t,e);switch("undefined"==typeof this.drawMap[t]&&(this.drawMap[t]=[]),Number(t)){case 0:o=new Line(i,n);break;case 1:o=new arrowLine(i,n);break;case 2:o=new CEZRect(i,n);break;case 3:o=new arrowRect(i,n);break;case 4:o=new polygon(i,n);break;case 5:o=new arrowPolygon(i,n);break;case 6:o=new concentricRect(i,n);break;case 7:o=new point(i,n);break;case 8:o=new title(i,n);break;case 9:o=new rectZoom(i,n);break;case 10:o=new lineArrowVernier(i,n);break;case 11:o=new gridArea(i,n,this.canvas.width,this.canvas.height);break;default:throw new Error("unknow drawObjType("+t+")")}this.currentC===this.drawMap[t][i]&&(this.currentC=o),this.drawMap[t][i]=o},Distroy:function(){$(this.canvas).remove()}};